[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Project aim: Characterize LEC subtypes in skin and fat tissue from different patients.\nProject lead: Aline Bauer\nAnalysis lead: Salvatore Daniele Bianco"
  },
  {
    "objectID": "code/valve_04_flow.html",
    "href": "code/valve_04_flow.html",
    "title": "valve_0_4_flow",
    "section": "",
    "text": "library(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(DESeq2)\nlibrary(edgeR)\nlibrary(VennDiagram)\nlibrary(clustifyr)\nlibrary(RColorBrewer)\nlibrary(ComplexHeatmap)\nlibrary(scater)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\n\nsce_val &lt;- sce[,sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res %in% c(\"8\", \"9\")]\nsce_val$val_cluster &lt;- sce_val$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res |&gt; \n  droplevels() \n\nlevels(sce_val$val_cluster) &lt;- c(\"valve1\", \"valve2\")\n\n\n\n\nplotReducedDim(sce, dimred=\"umap\", \n                     colour_by=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\", \n                     point_size = 0.8)\n\n\n\n\n\n\n\n\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"counts\")\n\npb_val &lt;- pb_val[,pb_val$ncells &gt;= 10]\nprint(table(pb_val$val_cluster))\n\n\nvalve1 valve2 \n     7      7 \n\n# de\ndesign &lt;- model.matrix(~ donor + val_cluster, as.data.frame(colData(pb_val)))\ndgl &lt;- DGEList(counts(pb_val))\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"val_clustervalve2\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\n\n\n\n\n\nfc_files &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=TRUE)\nfc_name &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=FALSE)\nfc_name &lt;- gsub(\".txt\", \"\", fc_name)\nfc_list &lt;- lapply(fc_files, read.table, header = TRUE)\nnames(fc_list) &lt;- fc_name\n\nfc_list &lt;- lapply(names(fc_list), function(fc_nam){\n  fc &lt;- fc_list[[fc_nam]]\n  fc[,fc_nam] &lt;- fc$matchCounts\n  fc &lt;- fc |&gt; select(-matchCounts)\n  fc\n})\n\nfc_tab &lt;- fc_list |&gt; purrr::reduce(full_join, by = \"Identifier\")\nrownames(fc_tab) &lt;- fc_tab$Identifier\nfc_tab &lt;- fc_tab |&gt; select(-Identifier)\n\nmeta &lt;- data_frame(\"cond\" = gsub(\".*dyn_\", \"\", colnames(fc_tab)),\n                   \"sample\" = gsub(\"_[0-9]{1,2}dyn.*\", \"\", colnames(fc_tab)),\n                   \"strength\" = gsub(\"^.*_[0-9]_|_[a-z].*$\", \"\", colnames(fc_tab)))\n\nWarning: `data_frame()` was deprecated in tibble 1.1.0.\nℹ Please use `tibble()` instead.\n\nrownames(meta) &lt;- colnames(fc_tab)\n\nWarning: Setting row names on a tibble is deprecated.\n\n# to get rowData\nbulk_expr &lt;- read.csv(file.path(\"..\", \"data\", \"4Donors_FPKM_Laminar_4-over-Oscillatory_4.csv\"))\nbulk_expr &lt;- bulk_expr[-1,]\ncount_nam &lt;- grep(\".*FPKM\",colnames(bulk_expr), value = T)\nrow_dat_nam &lt;- colnames(bulk_expr)[!colnames(bulk_expr) %in% c(\"X\", \"Cluster\", count_nam)]\nrow_dat &lt;- bulk_expr[,c(\"gene_id\", \"gene_name\")]\nrownames(row_dat) &lt;- row_dat$gene_id\nrow_dat &lt;- row_dat[rownames(fc_tab),]\n\n# Generate summarized experiment\nbulk &lt;- SummarizedExperiment(assays=list(counts=as.matrix(fc_tab)), \n                             colData=meta, rowData = row_dat)\n\ndim(bulk)\n\n[1] 21493    24\n\nrownames(bulk) &lt;- paste0(rowData(bulk)$gene_id, \".\", rowData(bulk)$gene_name)\n\n#Filter genes\nbulk &lt;- bulk[rowSums(assay(bulk, \"counts\")) &gt; 5, ]\ndim(bulk)\n\n[1] 16779    24\n\n#Filter sample\nbulk &lt;- bulk[, !bulk$strength %in% \"4dyn\"]\nbulk &lt;- bulk[, !bulk$sample %in% \"440z009_2\"]\n\n#DESEQ2 dataset\ndds &lt;- DESeq2::DESeqDataSet(bulk, design = ~ sample + cond)\n\nWarning in DESeq2::DESeqDataSet(bulk, design = ~sample + cond): some variables\nin design formula are characters, converting to factors\n\ndds &lt;- estimateSizeFactors(dds)\nvsd &lt;- DESeq2::vst(dds, blind = TRUE)\n\n#DE bulk\ndds &lt;- DESeq(dds)\n\nusing pre-existing size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates\n\n\nfitting model and testing\n\ncont &lt;- c(0,0,0,1,1)\nres_de &lt;- results(dds, contrast = cont)\nres_de &lt;- res_de[order(res_de$padj), ]\n\n\n\n\n\n\noverlap &lt;- intersect(rownames(sce_val), rownames(vsd))\nsce_val &lt;- sce_val[overlap,]\nvsd &lt;- vsd[overlap,]\n\ntt_overlap &lt;- tt[overlap,]\ntop_ordered &lt;- tt_overlap[order(tt_overlap$FDR),]\ntop &lt;- rownames(top_ordered)[1:100]\n\nres &lt;- clustify(\n  input = as.matrix(logcounts(sce_val)),\n  metadata = data.frame(colData(sce_val)),\n  cluster_col = \"val_cluster\", \n  ref_mat = assay(vsd),\n  query_genes = top \n)\n\nusing # of genes: 100\n\n\nsimilarity computation completed, matrix of 2 x 9, preparing output\n\np &lt;- plot_cor_heatmap(cor_mat = res, col = rev(hcl.colors(51, \"Reds\")))\np\n\n\n\n\n\n\n\n\n# | label: pb mds\n\n#pseudo_bulk\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"logcounts\")\ncolnames(pb_val) &lt;- paste0(pb_val$val_cluster, \"_\", pb_val$donor)\n\npb_val_sel &lt;- pb_val[top,]\nvsd_sel &lt;- vsd[top,]\ncom &lt;- cbind(assay(vsd_sel), logcounts(pb_val_sel))\n\nd &lt;- DGEList(com, remove.zeros = TRUE)\nmds &lt;- plotMDS.DGEList(d, top = 100)\n\n\n\ndist_mat &lt;- dist(t(com))\nhclust_avg &lt;- hclust(dist_mat, method = 'ward.D2')\nplot(hclust_avg)\n\n\n\n\n\n\n\n\ntop &lt;- rownames(top_ordered)[1:100]\ntop &lt;- top[!top %in% \"ENSG00000139329.LUM\"]\nvsd_sel &lt;- vsd[top,]\ncd &lt;- data.frame(\"cond\" = vsd_sel$cond)\nrownames(cd) &lt;- colnames(vsd_sel)\n\nhm &lt;- pheatmap(assay(vsd_sel), \n        main = \"Top DE genes valve2 vs valve1\", fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\n\nres_sel &lt;- res_de[which(res_de$padj &lt; 0.01),]\nres_down &lt;- res_sel[order(res_sel$stat),]\nres_up &lt;- res_sel[order(res_sel$stat, decreasing = T),]\n\ntop_bulk &lt;- c(rownames(res_up)[1:200], rownames(res_down)[1:200])\ntop_bulk &lt;- top_bulk[top_bulk %in% rownames(pb_val)]\n\nsub &lt;- logcounts(pb_val)[top_bulk,]\nsub &lt;- sub[rowSums(sub) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val$val_cluster,\n                 \"donor\" = pb_val$donor)\nrownames(cd) &lt;- colnames(pb_val)\n\n# Specify colors\nann_colors = list(\n    cond = c(\"valve1\" = \"#849db1\", \"valve2\" = \"#ef6f6a\"),\n    donor = c(\"1.0\" = \"#4E79A7\", \"2.0\" = \"#F28E2B\",\n              \"3.0\" = \"#E15759\", \"4.0\" = \"#76B7B2\",\n              \"5.0\" = \"#59A14F\", \"6.0\" = \"#EDC948\",\n              \"7.0\" = \"#B07AA1\")\n)\n\n\nhm &lt;- pheatmap(as.matrix(sub), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        cluster_rows = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\npb_val1 &lt;- pb_val[,pb_val$donor %in% c(\"6.0\", \"5.0\", \"7.0\")]\nsub1 &lt;- logcounts(pb_val1)[top_bulk,]\nsub1 &lt;- sub1[rowSums(sub1) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val1$val_cluster,\n                 \"donor\" = pb_val1$donor)\nrownames(cd) &lt;- colnames(pb_val1)\n\nhm &lt;- pheatmap(as.matrix(sub1), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\npb_val2 &lt;- pb_val[,pb_val$donor %in% c(\"2.0\", \"4.0\")]\nsub2 &lt;- logcounts(pb_val2)[top_bulk,]\nsub2 &lt;- sub2[rowSums(sub2) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val2$val_cluster,\n                 \"donor\" = pb_val2$donor)\nrownames(cd) &lt;- colnames(pb_val2)\n\nhm &lt;- pheatmap(as.matrix(sub2), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\nbulk &lt;- res_de[overlap,]\nbulk &lt;- bulk[which(bulk$padj &lt; 0.01),]\nsc &lt;- tt_overlap[tt_overlap$FDR &lt; 0.01,]\n\nmyCol &lt;- brewer.pal(3, \"Pastel2\")\n\n# Chart\nvenn.diagram(\n        x = list(bulk = rownames(bulk), sc = rownames(sc)),\n        category.names = c(\"Flow\" , \"valve1/valve2\"),\n        filename = '../out/plots/venn_bulk_sc.png',\n        output=T,\n        \n        # Output features\n        imagetype=\"png\" ,\n        height = 480 , \n        width = 480 , \n        resolution = 300,\n        compression = \"lzw\",\n\n        \n        # Circles\n        lwd = 2,\n        lty = 'blank',\n        fill = myCol[1:2],\n        \n        # Numbers\n        cex = .6,\n        fontface = \"bold\",\n        fontfamily = \"sans\",\n        \n        # Set names\n        cat.cex = 0.6,\n        cat.fontface = \"bold\",\n        cat.default.pos = \"outer\",\n        cat.pos = c(-15, 5),\n        cat.fontfamily = \"sans\",\n        #rotation = 1\n)\n\n[1] 1\n\n\n\n\n\n\nsce_val &lt;- runPCA(sce_val, subset_row = top_bulk)\nplotReducedDim(sce_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\npb_val &lt;- runPCA(pb_val, subset_row = top_bulk)\n\nWarning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more\nsingular values/vectors requested than available\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =\nTRUE, : You're computing too large a percentage of total singular values, use a\nstandard svd instead.\n\nplotReducedDim(pb_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\n\n\n\n\n\ngene_list &lt;- c(\"ALCAM\",\"CD24\",\"ITGA9\",\"CD9\",\"CAV1\",\"SNCG\",\"NEO1\",\"ADAMTS6\",\n               \"ADAMTS1\",\"SEMA3D\",\"GJA1\",\"CLDN11\",\"ANGPT2\",\"CLDN5\",\"ADM\",\n               \"GJA4\",\"SAT1\",\"ID3\",\"SCG3\",\"NR2F1\",\"APOD\")\n\nrowData(sce_val)$gene_short &lt;- rowData(sce_val)$Symbol\ndup &lt;- which(duplicated(rowData(sce_val)$gene_short))\nrowData(sce_val)$gene_short[dup] &lt;- rownames(sce_val)[dup]\nrownames(sce_val) &lt;- rowData(sce_val)$gene_short\n\ndim_list &lt;- lapply(gene_list, function(gene_nam){\n  p &lt;- plotReducedDim(sce_val, dimred=\"umap\", colour_by=gene_nam, \n                      point_size = 0.8) +\n  ggtitle(gene_nam)\n})\n\nwrap_plots(dim_list, ncol = 3) \n\n\n\n\n\n\n\n\nplotExpression(sce_val, features=gene_list, \n    x=\"val_cluster\", colour_by=\"val_cluster\", ncol = 3)"
  },
  {
    "objectID": "code/valve_04_flow.html#valve-subgroup-comparison-with-mild-flow",
    "href": "code/valve_04_flow.html#valve-subgroup-comparison-with-mild-flow",
    "title": "valve_0_4_flow",
    "section": "",
    "text": "library(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(DESeq2)\nlibrary(edgeR)\nlibrary(VennDiagram)\nlibrary(clustifyr)\nlibrary(RColorBrewer)\nlibrary(ComplexHeatmap)\nlibrary(scater)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\n\nsce_val &lt;- sce[,sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res %in% c(\"8\", \"9\")]\nsce_val$val_cluster &lt;- sce_val$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res |&gt; \n  droplevels() \n\nlevels(sce_val$val_cluster) &lt;- c(\"valve1\", \"valve2\")\n\n\n\n\nplotReducedDim(sce, dimred=\"umap\", \n                     colour_by=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\", \n                     point_size = 0.8)\n\n\n\n\n\n\n\n\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"counts\")\n\npb_val &lt;- pb_val[,pb_val$ncells &gt;= 10]\nprint(table(pb_val$val_cluster))\n\n\nvalve1 valve2 \n     7      7 \n\n# de\ndesign &lt;- model.matrix(~ donor + val_cluster, as.data.frame(colData(pb_val)))\ndgl &lt;- DGEList(counts(pb_val))\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"val_clustervalve2\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\n\n\n\n\n\nfc_files &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=TRUE)\nfc_name &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=FALSE)\nfc_name &lt;- gsub(\".txt\", \"\", fc_name)\nfc_list &lt;- lapply(fc_files, read.table, header = TRUE)\nnames(fc_list) &lt;- fc_name\n\nfc_list &lt;- lapply(names(fc_list), function(fc_nam){\n  fc &lt;- fc_list[[fc_nam]]\n  fc[,fc_nam] &lt;- fc$matchCounts\n  fc &lt;- fc |&gt; select(-matchCounts)\n  fc\n})\n\nfc_tab &lt;- fc_list |&gt; purrr::reduce(full_join, by = \"Identifier\")\nrownames(fc_tab) &lt;- fc_tab$Identifier\nfc_tab &lt;- fc_tab |&gt; select(-Identifier)\n\nmeta &lt;- data_frame(\"cond\" = gsub(\".*dyn_\", \"\", colnames(fc_tab)),\n                   \"sample\" = gsub(\"_[0-9]{1,2}dyn.*\", \"\", colnames(fc_tab)),\n                   \"strength\" = gsub(\"^.*_[0-9]_|_[a-z].*$\", \"\", colnames(fc_tab)))\n\nWarning: `data_frame()` was deprecated in tibble 1.1.0.\nℹ Please use `tibble()` instead.\n\nrownames(meta) &lt;- colnames(fc_tab)\n\nWarning: Setting row names on a tibble is deprecated.\n\n# to get rowData\nbulk_expr &lt;- read.csv(file.path(\"..\", \"data\", \"4Donors_FPKM_Laminar_4-over-Oscillatory_4.csv\"))\nbulk_expr &lt;- bulk_expr[-1,]\ncount_nam &lt;- grep(\".*FPKM\",colnames(bulk_expr), value = T)\nrow_dat_nam &lt;- colnames(bulk_expr)[!colnames(bulk_expr) %in% c(\"X\", \"Cluster\", count_nam)]\nrow_dat &lt;- bulk_expr[,c(\"gene_id\", \"gene_name\")]\nrownames(row_dat) &lt;- row_dat$gene_id\nrow_dat &lt;- row_dat[rownames(fc_tab),]\n\n# Generate summarized experiment\nbulk &lt;- SummarizedExperiment(assays=list(counts=as.matrix(fc_tab)), \n                             colData=meta, rowData = row_dat)\n\ndim(bulk)\n\n[1] 21493    24\n\nrownames(bulk) &lt;- paste0(rowData(bulk)$gene_id, \".\", rowData(bulk)$gene_name)\n\n#Filter genes\nbulk &lt;- bulk[rowSums(assay(bulk, \"counts\")) &gt; 5, ]\ndim(bulk)\n\n[1] 16779    24\n\n#Filter sample\nbulk &lt;- bulk[, !bulk$strength %in% \"4dyn\"]\nbulk &lt;- bulk[, !bulk$sample %in% \"440z009_2\"]\n\n#DESEQ2 dataset\ndds &lt;- DESeq2::DESeqDataSet(bulk, design = ~ sample + cond)\n\nWarning in DESeq2::DESeqDataSet(bulk, design = ~sample + cond): some variables\nin design formula are characters, converting to factors\n\ndds &lt;- estimateSizeFactors(dds)\nvsd &lt;- DESeq2::vst(dds, blind = TRUE)\n\n#DE bulk\ndds &lt;- DESeq(dds)\n\nusing pre-existing size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates\n\n\nfitting model and testing\n\ncont &lt;- c(0,0,0,1,1)\nres_de &lt;- results(dds, contrast = cont)\nres_de &lt;- res_de[order(res_de$padj), ]\n\n\n\n\n\n\noverlap &lt;- intersect(rownames(sce_val), rownames(vsd))\nsce_val &lt;- sce_val[overlap,]\nvsd &lt;- vsd[overlap,]\n\ntt_overlap &lt;- tt[overlap,]\ntop_ordered &lt;- tt_overlap[order(tt_overlap$FDR),]\ntop &lt;- rownames(top_ordered)[1:100]\n\nres &lt;- clustify(\n  input = as.matrix(logcounts(sce_val)),\n  metadata = data.frame(colData(sce_val)),\n  cluster_col = \"val_cluster\", \n  ref_mat = assay(vsd),\n  query_genes = top \n)\n\nusing # of genes: 100\n\n\nsimilarity computation completed, matrix of 2 x 9, preparing output\n\np &lt;- plot_cor_heatmap(cor_mat = res, col = rev(hcl.colors(51, \"Reds\")))\np\n\n\n\n\n\n\n\n\n# | label: pb mds\n\n#pseudo_bulk\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"logcounts\")\ncolnames(pb_val) &lt;- paste0(pb_val$val_cluster, \"_\", pb_val$donor)\n\npb_val_sel &lt;- pb_val[top,]\nvsd_sel &lt;- vsd[top,]\ncom &lt;- cbind(assay(vsd_sel), logcounts(pb_val_sel))\n\nd &lt;- DGEList(com, remove.zeros = TRUE)\nmds &lt;- plotMDS.DGEList(d, top = 100)\n\n\n\ndist_mat &lt;- dist(t(com))\nhclust_avg &lt;- hclust(dist_mat, method = 'ward.D2')\nplot(hclust_avg)\n\n\n\n\n\n\n\n\ntop &lt;- rownames(top_ordered)[1:100]\ntop &lt;- top[!top %in% \"ENSG00000139329.LUM\"]\nvsd_sel &lt;- vsd[top,]\ncd &lt;- data.frame(\"cond\" = vsd_sel$cond)\nrownames(cd) &lt;- colnames(vsd_sel)\n\nhm &lt;- pheatmap(assay(vsd_sel), \n        main = \"Top DE genes valve2 vs valve1\", fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\n\nres_sel &lt;- res_de[which(res_de$padj &lt; 0.01),]\nres_down &lt;- res_sel[order(res_sel$stat),]\nres_up &lt;- res_sel[order(res_sel$stat, decreasing = T),]\n\ntop_bulk &lt;- c(rownames(res_up)[1:200], rownames(res_down)[1:200])\ntop_bulk &lt;- top_bulk[top_bulk %in% rownames(pb_val)]\n\nsub &lt;- logcounts(pb_val)[top_bulk,]\nsub &lt;- sub[rowSums(sub) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val$val_cluster,\n                 \"donor\" = pb_val$donor)\nrownames(cd) &lt;- colnames(pb_val)\n\n# Specify colors\nann_colors = list(\n    cond = c(\"valve1\" = \"#849db1\", \"valve2\" = \"#ef6f6a\"),\n    donor = c(\"1.0\" = \"#4E79A7\", \"2.0\" = \"#F28E2B\",\n              \"3.0\" = \"#E15759\", \"4.0\" = \"#76B7B2\",\n              \"5.0\" = \"#59A14F\", \"6.0\" = \"#EDC948\",\n              \"7.0\" = \"#B07AA1\")\n)\n\n\nhm &lt;- pheatmap(as.matrix(sub), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        cluster_rows = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\npb_val1 &lt;- pb_val[,pb_val$donor %in% c(\"6.0\", \"5.0\", \"7.0\")]\nsub1 &lt;- logcounts(pb_val1)[top_bulk,]\nsub1 &lt;- sub1[rowSums(sub1) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val1$val_cluster,\n                 \"donor\" = pb_val1$donor)\nrownames(cd) &lt;- colnames(pb_val1)\n\nhm &lt;- pheatmap(as.matrix(sub1), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\npb_val2 &lt;- pb_val[,pb_val$donor %in% c(\"2.0\", \"4.0\")]\nsub2 &lt;- logcounts(pb_val2)[top_bulk,]\nsub2 &lt;- sub2[rowSums(sub2) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val2$val_cluster,\n                 \"donor\" = pb_val2$donor)\nrownames(cd) &lt;- colnames(pb_val2)\n\nhm &lt;- pheatmap(as.matrix(sub2), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\nbulk &lt;- res_de[overlap,]\nbulk &lt;- bulk[which(bulk$padj &lt; 0.01),]\nsc &lt;- tt_overlap[tt_overlap$FDR &lt; 0.01,]\n\nmyCol &lt;- brewer.pal(3, \"Pastel2\")\n\n# Chart\nvenn.diagram(\n        x = list(bulk = rownames(bulk), sc = rownames(sc)),\n        category.names = c(\"Flow\" , \"valve1/valve2\"),\n        filename = '../out/plots/venn_bulk_sc.png',\n        output=T,\n        \n        # Output features\n        imagetype=\"png\" ,\n        height = 480 , \n        width = 480 , \n        resolution = 300,\n        compression = \"lzw\",\n\n        \n        # Circles\n        lwd = 2,\n        lty = 'blank',\n        fill = myCol[1:2],\n        \n        # Numbers\n        cex = .6,\n        fontface = \"bold\",\n        fontfamily = \"sans\",\n        \n        # Set names\n        cat.cex = 0.6,\n        cat.fontface = \"bold\",\n        cat.default.pos = \"outer\",\n        cat.pos = c(-15, 5),\n        cat.fontfamily = \"sans\",\n        #rotation = 1\n)\n\n[1] 1\n\n\n\n\n\n\nsce_val &lt;- runPCA(sce_val, subset_row = top_bulk)\nplotReducedDim(sce_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\npb_val &lt;- runPCA(pb_val, subset_row = top_bulk)\n\nWarning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more\nsingular values/vectors requested than available\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =\nTRUE, : You're computing too large a percentage of total singular values, use a\nstandard svd instead.\n\nplotReducedDim(pb_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\n\n\n\n\n\ngene_list &lt;- c(\"ALCAM\",\"CD24\",\"ITGA9\",\"CD9\",\"CAV1\",\"SNCG\",\"NEO1\",\"ADAMTS6\",\n               \"ADAMTS1\",\"SEMA3D\",\"GJA1\",\"CLDN11\",\"ANGPT2\",\"CLDN5\",\"ADM\",\n               \"GJA4\",\"SAT1\",\"ID3\",\"SCG3\",\"NR2F1\",\"APOD\")\n\nrowData(sce_val)$gene_short &lt;- rowData(sce_val)$Symbol\ndup &lt;- which(duplicated(rowData(sce_val)$gene_short))\nrowData(sce_val)$gene_short[dup] &lt;- rownames(sce_val)[dup]\nrownames(sce_val) &lt;- rowData(sce_val)$gene_short\n\ndim_list &lt;- lapply(gene_list, function(gene_nam){\n  p &lt;- plotReducedDim(sce_val, dimred=\"umap\", colour_by=gene_nam, \n                      point_size = 0.8) +\n  ggtitle(gene_nam)\n})\n\nwrap_plots(dim_list, ncol = 3) \n\n\n\n\n\n\n\n\nplotExpression(sce_val, features=gene_list, \n    x=\"val_cluster\", colour_by=\"val_cluster\", ncol = 3)"
  },
  {
    "objectID": "code/data_viz.html",
    "href": "code/data_viz.html",
    "title": "data_viz",
    "section": "",
    "text": "Different ways to look at the preprocessed dataset\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(scater)\nlibrary(DT)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nmeta_dat &lt;- read.csv(file.path(\"..\", \"data\", \"metadata.csv\"),\n                     sep = \"\\t\", row.names = 1)\n\n# major celltypes\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n\n#colours to correspond to shinycell\ncList = list(\"cell_type_name\" = c(\"#A6CEE3\",\"#99CD91\",\"#B89B74\",\n                                  \"#F06C45\",\"#ED8F47\",\"#825D99\",\"#B15928\"),\n             \"tissue\" = c(\"#A6CEE3\",\"#F06C45\",\"#B15928\"),\n             \"donor\" = c(\"#A6CEE3\",\"#99CD91\",\"#B89B74\",\n                         \"#F06C45\",\"#ED8F47\",\"#825D99\",\"#B15928\"))\nnames(cList[[\"cell_type_name\"]]) &lt;- c(\"1 capillary1\",\"2 capillary2\",\"3 precollector1\",\"4 precollector2\",\"5 collector\",\"6 valve\",\"7 proliferative\")\nnames(cList[[\"tissue\"]]) &lt;- c(\"fat\",\"mixed\",\"skin\")\nnames(cList[[\"donor\"]]) &lt;- c(\"1.0\",\"2.0\",\"3.0\",\"4.0\",\"5.0\",\"6.0\",\"7.0\")\n\n\n\n\ntable(sce$tissue)\n\n\n  fat mixed  skin \n 7300  4705  9369 \n\ntable(sce$donor)\n\n\n 1.0  2.0  3.0  4.0  5.0  6.0  7.0 \n3902 2773 1247  631 4705 3647 4469 \n\ntable(sce$cell_type_name)\n\n\n   1 capillary1    2 capillary2 3 precollector1 4 precollector2     5 collector \n           6023            1156            5407            6041            1105 \n        6 valve 7 proliferative \n           1555              87 \n\ntable(sce$ct_broad)\n\n\n     capillary   precollector      collector          valve prolieferative \n          7179          11448           1105           1555             87 \n\ntable(sce$ct_broad, sce$tissue)\n\n                \n                  fat mixed skin\n  capillary      2206  1412 3561\n  precollector   3999  2663 4786\n  collector       613   249  243\n  valve           449   371  735\n  prolieferative   33    10   44\n\ntable(sce$cell_type_name, sce$tissue)\n\n                 \n                   fat mixed skin\n  1 capillary1    1748  1167 3108\n  2 capillary2     458   245  453\n  3 precollector1 1750  1163 2494\n  4 precollector2 2249  1500 2292\n  5 collector      613   249  243\n  6 valve          449   371  735\n  7 proliferative   33    10   44\n\n\n\n\n\n\n\n\n\nsce_fat &lt;- sce[,sce$tissue %in% \"fat\"]\nsce_skin &lt;- sce[,sce$tissue %in% \"skin\"]\nsce_mixed &lt;- sce[,sce$tissue %in% \"mixed\"]\n\np1 &lt;- plotReducedDim(sce_fat, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"fat\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce_skin, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"skin\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np3 &lt;- plotReducedDim(sce_mixed, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"mixed\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"skin\" = p2,\n                \"mixed\" = p3,\n                \"fat\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\nno_int &lt;- calculateUMAP(reducedDims(sce)[[\"logcounts.scaled.pca\"]],transposed = T)\nreducedDims(sce)[[\"logcounts.scaled.umap\"]] &lt;- no_int\n\n\np1 &lt;- plotReducedDim(sce, dimred=\"umap\", colour_by=\"donor\", point_size = 0.8) +\n  ggtitle(\"after\") +\n  scale_color_manual(values = cList[[\"donor\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce, dimred=\"logcounts.scaled.umap\", colour_by=\"donor\", point_size = 0.8) +\n  ggtitle(\"before\") +\n  scale_color_manual(values = cList[[\"donor\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"before\" = p2,\n                \"after\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\np1 &lt;- plotReducedDim(sce, dimred=\"umap\", colour_by=\"tissue\", point_size = 0.8) +\n  ggtitle(\"after\") +\n  scale_color_manual(values = cList[[\"tissue\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce, dimred=\"logcounts.scaled.umap\", colour_by=\"tissue\", point_size = 0.8) +\n  ggtitle(\"before\") +\n  scale_color_manual(values = cList[[\"tissue\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"before\" = p2,\n                \"after\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\n\n1 capillary12 capillary23 precollector14 precollector25 collector6 valve7 proliferative"
  },
  {
    "objectID": "code/data_viz.html#data-viz",
    "href": "code/data_viz.html#data-viz",
    "title": "data_viz",
    "section": "",
    "text": "Different ways to look at the preprocessed dataset\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(scater)\nlibrary(DT)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nmeta_dat &lt;- read.csv(file.path(\"..\", \"data\", \"metadata.csv\"),\n                     sep = \"\\t\", row.names = 1)\n\n# major celltypes\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n\n#colours to correspond to shinycell\ncList = list(\"cell_type_name\" = c(\"#A6CEE3\",\"#99CD91\",\"#B89B74\",\n                                  \"#F06C45\",\"#ED8F47\",\"#825D99\",\"#B15928\"),\n             \"tissue\" = c(\"#A6CEE3\",\"#F06C45\",\"#B15928\"),\n             \"donor\" = c(\"#A6CEE3\",\"#99CD91\",\"#B89B74\",\n                         \"#F06C45\",\"#ED8F47\",\"#825D99\",\"#B15928\"))\nnames(cList[[\"cell_type_name\"]]) &lt;- c(\"1 capillary1\",\"2 capillary2\",\"3 precollector1\",\"4 precollector2\",\"5 collector\",\"6 valve\",\"7 proliferative\")\nnames(cList[[\"tissue\"]]) &lt;- c(\"fat\",\"mixed\",\"skin\")\nnames(cList[[\"donor\"]]) &lt;- c(\"1.0\",\"2.0\",\"3.0\",\"4.0\",\"5.0\",\"6.0\",\"7.0\")\n\n\n\n\ntable(sce$tissue)\n\n\n  fat mixed  skin \n 7300  4705  9369 \n\ntable(sce$donor)\n\n\n 1.0  2.0  3.0  4.0  5.0  6.0  7.0 \n3902 2773 1247  631 4705 3647 4469 \n\ntable(sce$cell_type_name)\n\n\n   1 capillary1    2 capillary2 3 precollector1 4 precollector2     5 collector \n           6023            1156            5407            6041            1105 \n        6 valve 7 proliferative \n           1555              87 \n\ntable(sce$ct_broad)\n\n\n     capillary   precollector      collector          valve prolieferative \n          7179          11448           1105           1555             87 \n\ntable(sce$ct_broad, sce$tissue)\n\n                \n                  fat mixed skin\n  capillary      2206  1412 3561\n  precollector   3999  2663 4786\n  collector       613   249  243\n  valve           449   371  735\n  prolieferative   33    10   44\n\ntable(sce$cell_type_name, sce$tissue)\n\n                 \n                   fat mixed skin\n  1 capillary1    1748  1167 3108\n  2 capillary2     458   245  453\n  3 precollector1 1750  1163 2494\n  4 precollector2 2249  1500 2292\n  5 collector      613   249  243\n  6 valve          449   371  735\n  7 proliferative   33    10   44\n\n\n\n\n\n\n\n\n\nsce_fat &lt;- sce[,sce$tissue %in% \"fat\"]\nsce_skin &lt;- sce[,sce$tissue %in% \"skin\"]\nsce_mixed &lt;- sce[,sce$tissue %in% \"mixed\"]\n\np1 &lt;- plotReducedDim(sce_fat, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"fat\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce_skin, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"skin\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np3 &lt;- plotReducedDim(sce_mixed, dimred=\"umap\", \n                     colour_by=\"cell_type_name\", \n                     point_size = 0.8) +\n  ggtitle(\"mixed\") +\n  scale_color_manual(values = cList[[\"cell_type_name\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"skin\" = p2,\n                \"mixed\" = p3,\n                \"fat\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\nno_int &lt;- calculateUMAP(reducedDims(sce)[[\"logcounts.scaled.pca\"]],transposed = T)\nreducedDims(sce)[[\"logcounts.scaled.umap\"]] &lt;- no_int\n\n\np1 &lt;- plotReducedDim(sce, dimred=\"umap\", colour_by=\"donor\", point_size = 0.8) +\n  ggtitle(\"after\") +\n  scale_color_manual(values = cList[[\"donor\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce, dimred=\"logcounts.scaled.umap\", colour_by=\"donor\", point_size = 0.8) +\n  ggtitle(\"before\") +\n  scale_color_manual(values = cList[[\"donor\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"before\" = p2,\n                \"after\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\np1 &lt;- plotReducedDim(sce, dimred=\"umap\", colour_by=\"tissue\", point_size = 0.8) +\n  ggtitle(\"after\") +\n  scale_color_manual(values = cList[[\"tissue\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\np2 &lt;- plotReducedDim(sce, dimred=\"logcounts.scaled.umap\", colour_by=\"tissue\", point_size = 0.8) +\n  ggtitle(\"before\") +\n  scale_color_manual(values = cList[[\"tissue\"]])\n\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n\nwrap_plots(list(\"before\" = p2,\n                \"after\" = p1), nrow = 1) + \n  plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\")\n\n\n\n\n\n\n\n\n\n\n1 capillary12 capillary23 precollector14 precollector25 collector6 valve7 proliferative"
  },
  {
    "objectID": "code/valve_sub.html",
    "href": "code/valve_sub.html",
    "title": "valve subgroups",
    "section": "",
    "text": "Explore expression pattern of valve sub types\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(DESeq2)\nlibrary(edgeR)\nlibrary(VennDiagram)\nlibrary(clustifyr)\nlibrary(RColorBrewer)\nlibrary(ComplexHeatmap)\nlibrary(scater)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\n\nsce_val &lt;- sce[,sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res %in% c(\"8\", \"9\")]\nsce_val$val_cluster &lt;- sce_val$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res |&gt; \n  droplevels() \n\nlevels(sce_val$val_cluster) &lt;- c(\"valve1\", \"valve2\")\n\n\n\n\nplotReducedDim(sce, dimred=\"umap\", \n                     colour_by=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\", \n                     point_size = 0.8)\n\n\n\n\n\n\n\n\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"counts\")\n\npb_val &lt;- pb_val[,pb_val$ncells &gt;= 10]\nprint(table(pb_val$val_cluster))\n\n\nvalve1 valve2 \n     7      7 \n\n# de\ndesign &lt;- model.matrix(~ donor + val_cluster, as.data.frame(colData(pb_val)))\ndgl &lt;- DGEList(counts(pb_val))\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"val_clustervalve2\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\nsaveRDS(tt, file.path(\"..\", \"out\", \"de\", \"valve2_vs_1.rds\"))\nwrite.csv(tt, file.path(\"..\", \"out\", \"de\", \"valve2_vs_1.csv\"))\n\n\n\n\n\n\nfc_files &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=TRUE)\nfc_name &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=FALSE)\nfc_name &lt;- gsub(\".txt\", \"\", fc_name)\nfc_list &lt;- lapply(fc_files, read.table, header = TRUE)\nnames(fc_list) &lt;- fc_name\n\nfc_list &lt;- lapply(names(fc_list), function(fc_nam){\n  fc &lt;- fc_list[[fc_nam]]\n  fc[,fc_nam] &lt;- fc$matchCounts\n  fc &lt;- fc |&gt; select(-matchCounts)\n  fc\n})\n\nfc_tab &lt;- fc_list |&gt; purrr::reduce(full_join, by = \"Identifier\")\nrownames(fc_tab) &lt;- fc_tab$Identifier\nfc_tab &lt;- fc_tab |&gt; select(-Identifier)\n\nmeta &lt;- data_frame(\"cond\" = gsub(\".*dyn_\", \"\", colnames(fc_tab)),\n                   \"sample\" = gsub(\"_[0-9]{1,2}dyn.*\", \"\", colnames(fc_tab)),\n                   \"strength\" = gsub(\"^.*_[0-9]_|_[a-z].*$\", \"\", colnames(fc_tab)))\n\nWarning: `data_frame()` was deprecated in tibble 1.1.0.\nℹ Please use `tibble()` instead.\n\nrownames(meta) &lt;- colnames(fc_tab)\n\nWarning: Setting row names on a tibble is deprecated.\n\n# to get rowData\nbulk_expr &lt;- read.csv(file.path(\"..\", \"data\", \"4Donors_FPKM_Laminar_4-over-Oscillatory_4.csv\"))\nbulk_expr &lt;- bulk_expr[-1,]\ncount_nam &lt;- grep(\".*FPKM\",colnames(bulk_expr), value = T)\nrow_dat_nam &lt;- colnames(bulk_expr)[!colnames(bulk_expr) %in% c(\"X\", \"Cluster\", count_nam)]\nrow_dat &lt;- bulk_expr[,c(\"gene_id\", \"gene_name\")]\nrownames(row_dat) &lt;- row_dat$gene_id\nrow_dat &lt;- row_dat[rownames(fc_tab),]\n\n# Generate summarized experiment\nbulk &lt;- SummarizedExperiment(assays=list(counts=as.matrix(fc_tab)), \n                             colData=meta, rowData = row_dat)\n\ndim(bulk)\n\n[1] 21493    24\n\nrownames(bulk) &lt;- paste0(rowData(bulk)$gene_id, \".\", rowData(bulk)$gene_name)\n\n#Filter genes\nbulk &lt;- bulk[rowSums(assay(bulk, \"counts\")) &gt; 5, ]\ndim(bulk)\n\n[1] 16779    24\n\n#Filter sample\nbulk &lt;- bulk[, !bulk$sample %in% \"440z009_2\"]\nbulk &lt;- bulk[, !bulk$strength %in% \"04dyn\"]\n\n\n#DESEQ2 dataset\ndds &lt;- DESeq2::DESeqDataSet(bulk, design = ~ sample + cond)\n\nWarning in DESeq2::DESeqDataSet(bulk, design = ~sample + cond): some variables\nin design formula are characters, converting to factors\n\ndds &lt;- estimateSizeFactors(dds)\nvsd &lt;- DESeq2::vst(dds, blind = TRUE)\n\n#DE bulk\nDE_bulk &lt;- read.csv(file.path(\"..\", \"data\",\"result--Laminar_4--over--Static_4.csv\"))\ndds &lt;- DESeq(dds)\n\nusing pre-existing size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates\n\n\nfitting model and testing\n\ncont &lt;- c(0,0,0,1,1)\nres_de &lt;- results(dds, contrast = cont)\nres_de &lt;- res_de[order(res_de$padj), ]\n\n\n\n\n\n\noverlap &lt;- intersect(rownames(sce_val), rownames(vsd))\nsce_val &lt;- sce_val[overlap,]\nvsd &lt;- vsd[overlap,]\n\ntt_overlap &lt;- tt[overlap,]\ntop_ordered &lt;- tt_overlap[order(tt_overlap$FDR),]\ntop &lt;- rownames(top_ordered)[1:100]\n\nres &lt;- clustify(\n  input = as.matrix(logcounts(sce_val)),\n  metadata = data.frame(colData(sce_val)),\n  cluster_col = \"val_cluster\", \n  ref_mat = assay(vsd),\n  query_genes = top \n)\n\nusing # of genes: 100\n\n\nsimilarity computation completed, matrix of 2 x 9, preparing output\n\np &lt;- plot_cor_heatmap(cor_mat = res, col = rev(hcl.colors(51, \"Reds\")))\np\n\n\n\n\n\n\n\n\n# | label: pb mds\n\n#pseudo_bulk\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"logcounts\")\ncolnames(pb_val) &lt;- paste0(pb_val$val_cluster, \"_\", pb_val$donor)\n\npb_val_sel &lt;- pb_val[top,]\nvsd_sel &lt;- vsd[top,]\ncom &lt;- cbind(assay(vsd_sel), logcounts(pb_val_sel))\n\nd &lt;- DGEList(com, remove.zeros = TRUE)\nmds &lt;- plotMDS.DGEList(d, top = 100)\n\n\n\ndist_mat &lt;- dist(t(com))\nhclust_avg &lt;- hclust(dist_mat, method = 'ward.D2')\nplot(hclust_avg)\n\n\n\n\n\n\n\n\ntop &lt;- rownames(top_ordered)[1:100]\ntop &lt;- top[!top %in% \"ENSG00000139329.LUM\"]\nvsd_sel &lt;- vsd[top,]\ncd &lt;- data.frame(\"cond\" = vsd_sel$cond)\nrownames(cd) &lt;- colnames(vsd_sel)\n\nhm &lt;- pheatmap(assay(vsd_sel), \n        main = \"Top DE genes valve2 vs valve1\", fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\n\nres_sel &lt;- res_de[which(res_de$padj &lt; 0.01),]\nres_down &lt;- res_sel[order(res_sel$stat),]\nres_up &lt;- res_sel[order(res_sel$stat, decreasing = T),]\n\ntop_bulk &lt;- c(rownames(res_up)[1:200], rownames(res_down)[1:200])\ntop_bulk &lt;- top_bulk[top_bulk %in% rownames(pb_val)]\n\nsub &lt;- logcounts(pb_val)[top_bulk,]\nsub &lt;- sub[rowSums(sub) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val$val_cluster,\n                 \"donor\" = pb_val$donor)\nrownames(cd) &lt;- colnames(pb_val)\n\n# Specify colors\nann_colors = list(\n    cond = c(\"valve1\" = \"#849db1\", \"valve2\" = \"#ef6f6a\"),\n    donor = c(\"1.0\" = \"#4E79A7\", \"2.0\" = \"#F28E2B\",\n              \"3.0\" = \"#E15759\", \"4.0\" = \"#76B7B2\",\n              \"5.0\" = \"#59A14F\", \"6.0\" = \"#EDC948\",\n              \"7.0\" = \"#B07AA1\")\n)\n\n\nhm &lt;- pheatmap(as.matrix(sub), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        cluster_rows = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\npb_val1 &lt;- pb_val[,pb_val$donor %in% c(\"6.0\", \"5.0\", \"7.0\")]\nsub1 &lt;- logcounts(pb_val1)[top_bulk,]\nsub1 &lt;- sub1[rowSums(sub1) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val1$val_cluster,\n                 \"donor\" = pb_val1$donor)\nrownames(cd) &lt;- colnames(pb_val1)\n\nhm &lt;- pheatmap(as.matrix(sub1), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\npb_val2 &lt;- pb_val[,pb_val$donor %in% c(\"2.0\", \"4.0\")]\nsub2 &lt;- logcounts(pb_val2)[top_bulk,]\nsub2 &lt;- sub2[rowSums(sub2) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val2$val_cluster,\n                 \"donor\" = pb_val2$donor)\nrownames(cd) &lt;- colnames(pb_val2)\n\nhm &lt;- pheatmap(as.matrix(sub2), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\nbulk &lt;- res_de[overlap,]\nbulk &lt;- bulk[which(bulk$padj &lt; 0.01),]\nsc &lt;- tt_overlap[tt_overlap$FDR &lt; 0.01,]\n\nmyCol &lt;- brewer.pal(3, \"Pastel2\")\n\n# Chart\nvenn.diagram(\n        x = list(bulk = rownames(bulk), sc = rownames(sc)),\n        category.names = c(\"Flow\" , \"valve1/valve2\"),\n        filename = '../out/plots/venn_bulk_sc.png',\n        output=T,\n        \n        # Output features\n        imagetype=\"png\" ,\n        height = 480 , \n        width = 480 , \n        resolution = 300,\n        compression = \"lzw\",\n\n        \n        # Circles\n        lwd = 2,\n        lty = 'blank',\n        fill = myCol[1:2],\n        \n        # Numbers\n        cex = .6,\n        fontface = \"bold\",\n        fontfamily = \"sans\",\n        \n        # Set names\n        cat.cex = 0.6,\n        cat.fontface = \"bold\",\n        cat.default.pos = \"outer\",\n        cat.pos = c(-15, 5),\n        cat.fontfamily = \"sans\",\n        #rotation = 1\n)\n\n[1] 1\n\n\n\n\n\n\nsce_val &lt;- runPCA(sce_val, subset_row = top_bulk)\nplotReducedDim(sce_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\npb_val &lt;- runPCA(pb_val, subset_row = top_bulk)\n\nWarning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more\nsingular values/vectors requested than available\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =\nTRUE, : You're computing too large a percentage of total singular values, use a\nstandard svd instead.\n\nplotReducedDim(pb_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\n\n\n\n\n\ngene_list &lt;- c(\"ALCAM\",\"CD24\",\"ITGA9\",\"CD9\",\"CAV1\",\"SNCG\",\"NEO1\",\"ADAMTS6\",\n               \"ADAMTS1\",\"SEMA3D\",\"GJA1\",\"CLDN11\",\"ANGPT2\",\"CLDN5\",\"ADM\",\n               \"GJA4\",\"SAT1\",\"ID3\",\"SCG3\",\"NR2F1\",\"APOD\")\n\nrowData(sce_val)$gene_short &lt;- rowData(sce_val)$Symbol\ndup &lt;- which(duplicated(rowData(sce_val)$gene_short))\nrowData(sce_val)$gene_short[dup] &lt;- rownames(sce_val)[dup]\nrownames(sce_val) &lt;- rowData(sce_val)$gene_short\n\ndim_list &lt;- lapply(gene_list, function(gene_nam){\n  p &lt;- plotReducedDim(sce_val, dimred=\"umap\", colour_by=gene_nam, \n                      point_size = 0.8) +\n  ggtitle(gene_nam)\n})\n\nwrap_plots(dim_list, ncol = 3) \n\n\n\n\n\n\n\n\nplotExpression(sce_val, features=gene_list, \n    x=\"val_cluster\", colour_by=\"val_cluster\", ncol = 3)"
  },
  {
    "objectID": "code/valve_sub.html#valve-subgroups",
    "href": "code/valve_sub.html#valve-subgroups",
    "title": "valve subgroups",
    "section": "",
    "text": "Explore expression pattern of valve sub types\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(DESeq2)\nlibrary(edgeR)\nlibrary(VennDiagram)\nlibrary(clustifyr)\nlibrary(RColorBrewer)\nlibrary(ComplexHeatmap)\nlibrary(scater)\nlibrary(patchwork)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\n\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\n\nsce_val &lt;- sce[,sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res %in% c(\"8\", \"9\")]\nsce_val$val_cluster &lt;- sce_val$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res |&gt; \n  droplevels() \n\nlevels(sce_val$val_cluster) &lt;- c(\"valve1\", \"valve2\")\n\n\n\n\nplotReducedDim(sce, dimred=\"umap\", \n                     colour_by=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\", \n                     point_size = 0.8)\n\n\n\n\n\n\n\n\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"counts\")\n\npb_val &lt;- pb_val[,pb_val$ncells &gt;= 10]\nprint(table(pb_val$val_cluster))\n\n\nvalve1 valve2 \n     7      7 \n\n# de\ndesign &lt;- model.matrix(~ donor + val_cluster, as.data.frame(colData(pb_val)))\ndgl &lt;- DGEList(counts(pb_val))\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"val_clustervalve2\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\nsaveRDS(tt, file.path(\"..\", \"out\", \"de\", \"valve2_vs_1.rds\"))\nwrite.csv(tt, file.path(\"..\", \"out\", \"de\", \"valve2_vs_1.csv\"))\n\n\n\n\n\n\nfc_files &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=TRUE)\nfc_name &lt;- list.files(\"../data/bulk-data-featurecounts\", pattern=\"*.txt\", full.names=FALSE)\nfc_name &lt;- gsub(\".txt\", \"\", fc_name)\nfc_list &lt;- lapply(fc_files, read.table, header = TRUE)\nnames(fc_list) &lt;- fc_name\n\nfc_list &lt;- lapply(names(fc_list), function(fc_nam){\n  fc &lt;- fc_list[[fc_nam]]\n  fc[,fc_nam] &lt;- fc$matchCounts\n  fc &lt;- fc |&gt; select(-matchCounts)\n  fc\n})\n\nfc_tab &lt;- fc_list |&gt; purrr::reduce(full_join, by = \"Identifier\")\nrownames(fc_tab) &lt;- fc_tab$Identifier\nfc_tab &lt;- fc_tab |&gt; select(-Identifier)\n\nmeta &lt;- data_frame(\"cond\" = gsub(\".*dyn_\", \"\", colnames(fc_tab)),\n                   \"sample\" = gsub(\"_[0-9]{1,2}dyn.*\", \"\", colnames(fc_tab)),\n                   \"strength\" = gsub(\"^.*_[0-9]_|_[a-z].*$\", \"\", colnames(fc_tab)))\n\nWarning: `data_frame()` was deprecated in tibble 1.1.0.\nℹ Please use `tibble()` instead.\n\nrownames(meta) &lt;- colnames(fc_tab)\n\nWarning: Setting row names on a tibble is deprecated.\n\n# to get rowData\nbulk_expr &lt;- read.csv(file.path(\"..\", \"data\", \"4Donors_FPKM_Laminar_4-over-Oscillatory_4.csv\"))\nbulk_expr &lt;- bulk_expr[-1,]\ncount_nam &lt;- grep(\".*FPKM\",colnames(bulk_expr), value = T)\nrow_dat_nam &lt;- colnames(bulk_expr)[!colnames(bulk_expr) %in% c(\"X\", \"Cluster\", count_nam)]\nrow_dat &lt;- bulk_expr[,c(\"gene_id\", \"gene_name\")]\nrownames(row_dat) &lt;- row_dat$gene_id\nrow_dat &lt;- row_dat[rownames(fc_tab),]\n\n# Generate summarized experiment\nbulk &lt;- SummarizedExperiment(assays=list(counts=as.matrix(fc_tab)), \n                             colData=meta, rowData = row_dat)\n\ndim(bulk)\n\n[1] 21493    24\n\nrownames(bulk) &lt;- paste0(rowData(bulk)$gene_id, \".\", rowData(bulk)$gene_name)\n\n#Filter genes\nbulk &lt;- bulk[rowSums(assay(bulk, \"counts\")) &gt; 5, ]\ndim(bulk)\n\n[1] 16779    24\n\n#Filter sample\nbulk &lt;- bulk[, !bulk$sample %in% \"440z009_2\"]\nbulk &lt;- bulk[, !bulk$strength %in% \"04dyn\"]\n\n\n#DESEQ2 dataset\ndds &lt;- DESeq2::DESeqDataSet(bulk, design = ~ sample + cond)\n\nWarning in DESeq2::DESeqDataSet(bulk, design = ~sample + cond): some variables\nin design formula are characters, converting to factors\n\ndds &lt;- estimateSizeFactors(dds)\nvsd &lt;- DESeq2::vst(dds, blind = TRUE)\n\n#DE bulk\nDE_bulk &lt;- read.csv(file.path(\"..\", \"data\",\"result--Laminar_4--over--Static_4.csv\"))\ndds &lt;- DESeq(dds)\n\nusing pre-existing size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates\n\n\nfitting model and testing\n\ncont &lt;- c(0,0,0,1,1)\nres_de &lt;- results(dds, contrast = cont)\nres_de &lt;- res_de[order(res_de$padj), ]\n\n\n\n\n\n\noverlap &lt;- intersect(rownames(sce_val), rownames(vsd))\nsce_val &lt;- sce_val[overlap,]\nvsd &lt;- vsd[overlap,]\n\ntt_overlap &lt;- tt[overlap,]\ntop_ordered &lt;- tt_overlap[order(tt_overlap$FDR),]\ntop &lt;- rownames(top_ordered)[1:100]\n\nres &lt;- clustify(\n  input = as.matrix(logcounts(sce_val)),\n  metadata = data.frame(colData(sce_val)),\n  cluster_col = \"val_cluster\", \n  ref_mat = assay(vsd),\n  query_genes = top \n)\n\nusing # of genes: 100\n\n\nsimilarity computation completed, matrix of 2 x 9, preparing output\n\np &lt;- plot_cor_heatmap(cor_mat = res, col = rev(hcl.colors(51, \"Reds\")))\np\n\n\n\n\n\n\n\n\n# | label: pb mds\n\n#pseudo_bulk\npb_val &lt;-  aggregateAcrossCells(sce_val,\n                               id=colData(sce_val)[,c(\"val_cluster\", \"donor\")],\n                               use.assay.type = \"logcounts\")\ncolnames(pb_val) &lt;- paste0(pb_val$val_cluster, \"_\", pb_val$donor)\n\npb_val_sel &lt;- pb_val[top,]\nvsd_sel &lt;- vsd[top,]\ncom &lt;- cbind(assay(vsd_sel), logcounts(pb_val_sel))\n\nd &lt;- DGEList(com, remove.zeros = TRUE)\nmds &lt;- plotMDS.DGEList(d, top = 100)\n\n\n\ndist_mat &lt;- dist(t(com))\nhclust_avg &lt;- hclust(dist_mat, method = 'ward.D2')\nplot(hclust_avg)\n\n\n\n\n\n\n\n\ntop &lt;- rownames(top_ordered)[1:100]\ntop &lt;- top[!top %in% \"ENSG00000139329.LUM\"]\nvsd_sel &lt;- vsd[top,]\ncd &lt;- data.frame(\"cond\" = vsd_sel$cond)\nrownames(cd) &lt;- colnames(vsd_sel)\n\nhm &lt;- pheatmap(assay(vsd_sel), \n        main = \"Top DE genes valve2 vs valve1\", fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\n\nres_sel &lt;- res_de[which(res_de$padj &lt; 0.01),]\nres_down &lt;- res_sel[order(res_sel$stat),]\nres_up &lt;- res_sel[order(res_sel$stat, decreasing = T),]\n\ntop_bulk &lt;- c(rownames(res_up)[1:200], rownames(res_down)[1:200])\ntop_bulk &lt;- top_bulk[top_bulk %in% rownames(pb_val)]\n\nsub &lt;- logcounts(pb_val)[top_bulk,]\nsub &lt;- sub[rowSums(sub) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val$val_cluster,\n                 \"donor\" = pb_val$donor)\nrownames(cd) &lt;- colnames(pb_val)\n\n# Specify colors\nann_colors = list(\n    cond = c(\"valve1\" = \"#849db1\", \"valve2\" = \"#ef6f6a\"),\n    donor = c(\"1.0\" = \"#4E79A7\", \"2.0\" = \"#F28E2B\",\n              \"3.0\" = \"#E15759\", \"4.0\" = \"#76B7B2\",\n              \"5.0\" = \"#59A14F\", \"6.0\" = \"#EDC948\",\n              \"7.0\" = \"#B07AA1\")\n)\n\n\nhm &lt;- pheatmap(as.matrix(sub), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        cluster_rows = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\n\n\npb_val1 &lt;- pb_val[,pb_val$donor %in% c(\"6.0\", \"5.0\", \"7.0\")]\nsub1 &lt;- logcounts(pb_val1)[top_bulk,]\nsub1 &lt;- sub1[rowSums(sub1) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val1$val_cluster,\n                 \"donor\" = pb_val1$donor)\nrownames(cd) &lt;- colnames(pb_val1)\n\nhm &lt;- pheatmap(as.matrix(sub1), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\npb_val2 &lt;- pb_val[,pb_val$donor %in% c(\"2.0\", \"4.0\")]\nsub2 &lt;- logcounts(pb_val2)[top_bulk,]\nsub2 &lt;- sub2[rowSums(sub2) &gt; 0,]\ncd &lt;- data.frame(\"cond\" = pb_val2$val_cluster,\n                 \"donor\" = pb_val2$donor)\nrownames(cd) &lt;- colnames(pb_val2)\n\nhm &lt;- pheatmap(as.matrix(sub2), \n        main = \"Top flow associated DE genes\", fontsize = 6,\n        col = rev(hcl.colors(50, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        show_rownames = FALSE,\n        cluster_cols = TRUE,\n        annotation_colors = ann_colors,\n        show_row_dend = FALSE,\n        annotation_col = cd)\nhm\n\n\n\n\n\n\n\nbulk &lt;- res_de[overlap,]\nbulk &lt;- bulk[which(bulk$padj &lt; 0.01),]\nsc &lt;- tt_overlap[tt_overlap$FDR &lt; 0.01,]\n\nmyCol &lt;- brewer.pal(3, \"Pastel2\")\n\n# Chart\nvenn.diagram(\n        x = list(bulk = rownames(bulk), sc = rownames(sc)),\n        category.names = c(\"Flow\" , \"valve1/valve2\"),\n        filename = '../out/plots/venn_bulk_sc.png',\n        output=T,\n        \n        # Output features\n        imagetype=\"png\" ,\n        height = 480 , \n        width = 480 , \n        resolution = 300,\n        compression = \"lzw\",\n\n        \n        # Circles\n        lwd = 2,\n        lty = 'blank',\n        fill = myCol[1:2],\n        \n        # Numbers\n        cex = .6,\n        fontface = \"bold\",\n        fontfamily = \"sans\",\n        \n        # Set names\n        cat.cex = 0.6,\n        cat.fontface = \"bold\",\n        cat.default.pos = \"outer\",\n        cat.pos = c(-15, 5),\n        cat.fontfamily = \"sans\",\n        #rotation = 1\n)\n\n[1] 1\n\n\n\n\n\n\nsce_val &lt;- runPCA(sce_val, subset_row = top_bulk)\nplotReducedDim(sce_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\npb_val &lt;- runPCA(pb_val, subset_row = top_bulk)\n\nWarning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more\nsingular values/vectors requested than available\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =\nTRUE, : You're computing too large a percentage of total singular values, use a\nstandard svd instead.\n\nplotReducedDim(pb_val, dimred=\"PCA\", colour_by=\"val_cluster\")\n\n\n\n\n\n\n\n\ngene_list &lt;- c(\"ALCAM\",\"CD24\",\"ITGA9\",\"CD9\",\"CAV1\",\"SNCG\",\"NEO1\",\"ADAMTS6\",\n               \"ADAMTS1\",\"SEMA3D\",\"GJA1\",\"CLDN11\",\"ANGPT2\",\"CLDN5\",\"ADM\",\n               \"GJA4\",\"SAT1\",\"ID3\",\"SCG3\",\"NR2F1\",\"APOD\")\n\nrowData(sce_val)$gene_short &lt;- rowData(sce_val)$Symbol\ndup &lt;- which(duplicated(rowData(sce_val)$gene_short))\nrowData(sce_val)$gene_short[dup] &lt;- rownames(sce_val)[dup]\nrownames(sce_val) &lt;- rowData(sce_val)$gene_short\n\ndim_list &lt;- lapply(gene_list, function(gene_nam){\n  p &lt;- plotReducedDim(sce_val, dimred=\"umap\", colour_by=gene_nam, \n                      point_size = 0.8) +\n  ggtitle(gene_nam)\n})\n\nwrap_plots(dim_list, ncol = 3) \n\n\n\n\n\n\n\n\nplotExpression(sce_val, features=gene_list, \n    x=\"val_cluster\", colour_by=\"val_cluster\", ncol = 3)"
  },
  {
    "objectID": "code/pb_de.html",
    "href": "code/pb_de.html",
    "title": "pb_de",
    "section": "",
    "text": "Pseudobulk DE analysis on major cell types using edgeR\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(edgeR)\nlibrary(stringr)\nlibrary(SingleCellExperiment)\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nmeta_dat &lt;- read.csv(file.path(\"..\", \"data\", \"metadata.csv\"),\n                     sep = \"\\t\", row.names = 1)\n\n# major celltypes\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n# filter sample\nsce &lt;- sce[, !sce$donor %in% c(\"2.0\", \"5.0\")]\nsce$donor &lt;- sce$donor |&gt; droplevels()\nsce$tissue &lt;- sce$tissue |&gt; droplevels()\n\n# mean_expr\nmean_expr_fat &lt;- rowMeans(logcounts(sce[,sce$tissue %in% \"fat\"]))\nmean_expr_skin &lt;- rowMeans(logcounts(sce[,sce$tissue %in% \"skin\"]))\n\n\n\n\n\nsummed &lt;- aggregateAcrossCells(sce,\n                               id=colData(sce)[,c(\"ct_broad\", \"donor\", \"tissue\")])\n# filter min cells\nsummed.filt &lt;- summed[,summed$ncells &gt;= 10]\nprint(table(summed.filt$tissue, summed.filt$ct_broad))\n\n      \n       capillary precollector collector valve prolieferative\n  fat          5            5         3     4              0\n  skin         5            5         4     5              3\n\n# de\ndesign &lt;- model.matrix(~ donor + tissue, as.data.frame(colData(summed.filt)))\nde.results &lt;- pseudoBulkDGE(summed.filt, \n    label=summed.filt$ct_broad,\n    design=~donor + tissue,\n    coef=\"tissueskin\",\n    condition=summed.filt$tissue \n)\n\nis.de &lt;- decideTestsPerLabel(de.results, threshold=0.05)\nsummarizeTestsPerLabel(is.de)\n\n              -1     0   1    NA\ncapillary    292  8851 156  9328\ncollector      0  3565   0 15062\nprecollector  30 10214  45  8338\nvalve         30  6511  28 12058\n\n\n\n\n\n\nsummed_all &lt;- aggregateAcrossCells(sce,\n                               id=colData(sce)[,c(\"donor\", \"tissue\")])\n# filter min cells\nsummed_all.filt &lt;- summed_all[,summed_all$ncells &gt;= 10]\ntable(summed_all.filt$tissue)\n\n\n fat skin \n   5    5 \n\n# de\ndesign &lt;- model.matrix(~ donor + tissue, as.data.frame(colData(summed_all.filt)))\ndgl &lt;- DGEList(counts(summed_all.filt))\nkeep &lt;- filterByExpr(dgl, design)\ndgl &lt;- dgl[keep, , keep.lib.sizes=FALSE]\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"tissueskin\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\n\ntt$meanExpr_fat &lt;- mean_expr_fat[rownames(tt)]\ntt$meanExpr_skin &lt;- mean_expr_skin[rownames(tt)]\n\nsaveRDS(tt, file.path(\"..\", \"out\", \"de\", \"pb_all.rds\"))\nwrite.csv(tt, file.path(\"..\", \"out\", \"de\", \"pb_all.csv\"))"
  },
  {
    "objectID": "code/pb_de.html#differential-expression-analysis",
    "href": "code/pb_de.html#differential-expression-analysis",
    "title": "pb_de",
    "section": "",
    "text": "Pseudobulk DE analysis on major cell types using edgeR\n\n\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(edgeR)\nlibrary(stringr)\nlibrary(SingleCellExperiment)\n\n\n\n\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nmeta_dat &lt;- read.csv(file.path(\"..\", \"data\", \"metadata.csv\"),\n                     sep = \"\\t\", row.names = 1)\n\n# major celltypes\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n# filter sample\nsce &lt;- sce[, !sce$donor %in% c(\"2.0\", \"5.0\")]\nsce$donor &lt;- sce$donor |&gt; droplevels()\nsce$tissue &lt;- sce$tissue |&gt; droplevels()\n\n# mean_expr\nmean_expr_fat &lt;- rowMeans(logcounts(sce[,sce$tissue %in% \"fat\"]))\nmean_expr_skin &lt;- rowMeans(logcounts(sce[,sce$tissue %in% \"skin\"]))\n\n\n\n\n\nsummed &lt;- aggregateAcrossCells(sce,\n                               id=colData(sce)[,c(\"ct_broad\", \"donor\", \"tissue\")])\n# filter min cells\nsummed.filt &lt;- summed[,summed$ncells &gt;= 10]\nprint(table(summed.filt$tissue, summed.filt$ct_broad))\n\n      \n       capillary precollector collector valve prolieferative\n  fat          5            5         3     4              0\n  skin         5            5         4     5              3\n\n# de\ndesign &lt;- model.matrix(~ donor + tissue, as.data.frame(colData(summed.filt)))\nde.results &lt;- pseudoBulkDGE(summed.filt, \n    label=summed.filt$ct_broad,\n    design=~donor + tissue,\n    coef=\"tissueskin\",\n    condition=summed.filt$tissue \n)\n\nis.de &lt;- decideTestsPerLabel(de.results, threshold=0.05)\nsummarizeTestsPerLabel(is.de)\n\n              -1     0   1    NA\ncapillary    292  8851 156  9328\ncollector      0  3565   0 15062\nprecollector  30 10214  45  8338\nvalve         30  6511  28 12058\n\n\n\n\n\n\nsummed_all &lt;- aggregateAcrossCells(sce,\n                               id=colData(sce)[,c(\"donor\", \"tissue\")])\n# filter min cells\nsummed_all.filt &lt;- summed_all[,summed_all$ncells &gt;= 10]\ntable(summed_all.filt$tissue)\n\n\n fat skin \n   5    5 \n\n# de\ndesign &lt;- model.matrix(~ donor + tissue, as.data.frame(colData(summed_all.filt)))\ndgl &lt;- DGEList(counts(summed_all.filt))\nkeep &lt;- filterByExpr(dgl, design)\ndgl &lt;- dgl[keep, , keep.lib.sizes=FALSE]\ndgl &lt;- calcNormFactors(dgl)\ndgl &lt;- estimateDisp(dgl, design)\nfit &lt;- glmQLFit(dgl, design)\nde &lt;- glmQLFTest(fit, coef=\"tissueskin\")\n\ntt &lt;- topTags(de, n = Inf)$table\ntt$full_gene_name &lt;- rownames(tt)\ntt$gene_symbol &lt;- gsub(\"^.*\\\\.\",\"\",rownames(tt))\n\n\ntt$meanExpr_fat &lt;- mean_expr_fat[rownames(tt)]\ntt$meanExpr_skin &lt;- mean_expr_skin[rownames(tt)]\n\nsaveRDS(tt, file.path(\"..\", \"out\", \"de\", \"pb_all.rds\"))\nwrite.csv(tt, file.path(\"..\", \"out\", \"de\", \"pb_all.csv\"))"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "lec_flow_push",
    "section": "",
    "text": "Code and analysis related to the comparison of LEC subtypes from different tissue origins."
  },
  {
    "objectID": "code/preprocessing_n_removal.html",
    "href": "code/preprocessing_n_removal.html",
    "title": "lec_flow_push",
    "section": "",
    "text": "# install.packages(\"dplyr\")\n# install.packages(\"ggplot2\")\n# install.packages(\"SingleCellExperiment\") #failed\n# install.packages(\"scater\") #failed\n# install.packages(\"scran\") #failed\n# install.packages(\"UpSetR\")\n# install.packages(\"googlesheets4\")\n# install.packages(\"cowplot\")\n# install.packages(\"BiocParallel\") #failed\n# install.packages(\"scDblFinder\") #failed\n# install.packages(\"tibble\")\n# install.packages(\"ggpubr\") #failed\n# install.packages(\"reshape2\")\n# install.packages(\"pheatmap\")\n# install.packages(\"RColorBrewer\")\n# install.packages(\"batchelor\") #failed\n\n\n# install.packages('BiocManager')\n\n\n# BiocManager::install(\"SingleCellExperiment\")\n#BiocManager::install(\"scater\")\n# BiocManager::install(\"scran\")\n# BiocManager::install(\"BiocParallel\")\n# BiocManager::install(\"scDblFinder\")\n# BiocManager::install(\"ggpubr\")\n# BiocManager::install(\"batchelor\")\n# BiocManager::install(\"DropletUtils\")\n\n\n# install.packages(\"knitr\")\n\n\nrequire(\"knitr\")\nknitr::opts_chunk$set(fig.width=10, fig.height=12)\n\nCaricamento del pacchetto richiesto: knitr\n\n\n\n\nsuppressPackageStartupMessages({\n    library(dplyr)\n    library(ggplot2)\n    library(SingleCellExperiment)\n    library(scater)\n    library(scran)\n    library(UpSetR)\n    library(googlesheets4)\n    library(cowplot)\n    library(BiocParallel)\n    library(scDblFinder)\n    library(tibble)\n    library(ggpubr)\n    library(reshape2)\n    library(pheatmap)\n    library(RColorBrewer)\n    library(batchelor)\n    library(DropletUtils)\n})\n\nWarning message:\n“il pacchetto ‘UpSetR’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘googlesheets4’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘batchelor’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘DropletUtils’ è stato creato con R versione 4.3.0”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__DummyArrayViewport’ con ‘DelayedArray::.__C__DummyArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::DummyArrayGrid’ con ‘DelayedArray::DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::DummyArrayViewport’ con ‘DelayedArray::DummyArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::write_block’ con ‘DelayedArray::write_block’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::maxlength’ con ‘DelayedArray::maxlength’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::arbind’ con ‘DelayedArray::arbind’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.ArbitraryArrayGrid’ con ‘DelayedArray::aperm.ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::refdim’ con ‘DelayedArray::refdim’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::downsample’ con ‘DelayedArray::downsample’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.character.Array’ con ‘DelayedArray::as.character.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::mapToGrid’ con ‘DelayedArray::mapToGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.complex.Array’ con ‘DelayedArray::as.complex.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::Mindex2Lindex’ con ‘DelayedArray::Mindex2Lindex’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.matrix.Array’ con ‘DelayedArray::as.matrix.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::is_sparse’ con ‘DelayedArray::is_sparse’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__RegularArrayGrid’ con ‘DelayedArray::.__C__RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__SafeArrayViewport’ con ‘DelayedArray::.__C__SafeArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__Array’ con ‘DelayedArray::.__C__Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArrayViewport’ con ‘DelayedArray::.__C__ArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::RegularArrayGrid’ con ‘DelayedArray::RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::makeNindexFromArrayViewport’ con ‘DelayedArray::makeNindexFromArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::extract_array’ con ‘DelayedArray::extract_array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArbitraryArrayGrid’ con ‘DelayedArray::.__C__ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.DummyArrayGrid’ con ‘DelayedArray::aperm.DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.array.Array’ con ‘DelayedArray::as.array.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.integer.Array’ con ‘DelayedArray::as.integer.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::is_sparse&lt;-’ con ‘DelayedArray::is_sparse&lt;-’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.raw.Array’ con ‘DelayedArray::as.raw.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__DummyArrayGrid’ con ‘DelayedArray::.__C__DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::ArbitraryArrayGrid’ con ‘DelayedArray::ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.character.ArrayGrid’ con ‘DelayedArray::as.character.ArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.numeric.Array’ con ‘DelayedArray::as.numeric.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::ArrayViewport’ con ‘DelayedArray::ArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::acbind’ con ‘DelayedArray::acbind’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::t.Array’ con ‘DelayedArray::t.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::read_block’ con ‘DelayedArray::read_block’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::rowsum’ con ‘DelayedArray::rowsum’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArrayGrid’ con ‘DelayedArray::.__C__ArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.RegularArrayGrid’ con ‘DelayedArray::aperm.RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.vector.Array’ con ‘DelayedArray::as.vector.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::Lindex2Mindex’ con ‘DelayedArray::Lindex2Mindex’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::colsum’ con ‘DelayedArray::colsum’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::mapToRef’ con ‘DelayedArray::mapToRef’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.data.frame.Array’ con ‘DelayedArray::as.data.frame.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.logical.Array’ con ‘DelayedArray::as.logical.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“trovate tabelle metodi multiple per ‘extract_array’”\nWarning message:\n“trovate tabelle metodi multiple per ‘is_sparse’”\nWarning message:\n“trovate tabelle metodi multiple per ‘is_sparse&lt;-’”\nWarning message:\n“trovate tabelle metodi multiple per ‘write_block’”\n\n\n\ndatadir &lt;- dir(\"../data\", \"filtered_feature_bc_matrix$\", \n               full.names = TRUE, recursive = TRUE,\n               include.dirs = TRUE)\nnames(datadir) &lt;- sapply(strsplit(datadir, \"/\"), .subset, 3)\ndatadir\n\ndonor1_fat'../data/donor1_fat/count/sample_filtered_feature_bc_matrix'donor1_skin'../data/donor1_skin/count/sample_filtered_feature_bc_matrix'donor2_fat'../data/donor2_fat/count/sample_filtered_feature_bc_matrix'donor3_fat'../data/donor3_fat/count/sample_filtered_feature_bc_matrix'donor3_skin'../data/donor3_skin/count/sample_filtered_feature_bc_matrix'donor4_fat'../data/donor4_fat/count/sample_filtered_feature_bc_matrix'donor4_skin'../data/donor4_skin/count/sample_filtered_feature_bc_matrix'donor5_fat'../data/donor5_fat/count/sample_filtered_feature_bc_matrix'donor5_recovery'../data/donor5_recovery/filtered_feature_bc_matrix'donor5_skin'../data/donor5_skin/count/sample_filtered_feature_bc_matrix'donor6_fat'../data/donor6_fat/count/sample_filtered_feature_bc_matrix'donor6_skin'../data/donor6_skin/count/sample_filtered_feature_bc_matrix'donor7_fat'../data/donor7_fat/count/sample_filtered_feature_bc_matrix'donor7_skin'../data/donor7_skin/count/sample_filtered_feature_bc_matrix'\n\n\n\nstub &lt;- \"https://docs.google.com/spreadsheets/d/\"\nmd_sheet &lt;- paste0(stub, \"1yEqqOHX7TY1A-lmEQu3cPcFY60IconZWR6W349xH2pY\")\nmd_sheet\n\n'https://docs.google.com/spreadsheets/d/1yEqqOHX7TY1A-lmEQu3cPcFY60IconZWR6W349xH2pY'\n\n\n\ngooglesheets4::gs4_deauth()\nmd &lt;- googlesheets4::read_sheet(md_sheet, sheet = \"single-cell\") %&gt;%\n    filter(keep == 1)\nmd\n\n✔ Reading from halin-bauer-hLECs-metadata.\n\n✔ Range ''single-cell''.\n\n\n\n\nA tibble: 12 × 8\n\n\nsample_name\ndonor\ntissue\ntissue_origin\nsequencing_run\nkeep\nsex\nnotes\n\n\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n\n\n\n\ndonor1_fat\n1\nfat\nabdomen\n1\n1\nF\nNA\n\n\ndonor1_skin\n1\nskin\nabdomen\n1\n1\nF\nNA\n\n\ndonor2_fat\n2\nfat\narm\n1\n1\nF\nNA\n\n\ndonor3_fat\n3\nfat\nabdomen\n2\n1\nF\nhas contamination\n\n\ndonor3_skin\n3\nskin\nabdomen\n2\n1\nF\nNA\n\n\ndonor4_fat\n4\nfat\nabdomen\n2\n1\nF\nNA\n\n\ndonor4_skin\n4\nskin\nabdomen\n2\n1\nF\nNA\n\n\ndonor5_recovery\n5\nmixed\nabdomen\n4\n1\n?\nrecovered sample\n\n\ndonor6_fat\n6\nfat\nabdomen\n3\n1\nM\nNA\n\n\ndonor6_skin\n6\nskin\nabdomen\n3\n1\nM\nNA\n\n\ndonor7_fat\n7\nfat\nthigh\n3\n1\n?\nhas contamination\n\n\ndonor7_skin\n7\nskin\nthigh\n3\n1\n?\nNA\n\n\n\n\n\n\ndatadir &lt;- datadir[md$sample_name]\nprint(all(names(datadir)==md$sample_name))\ndatadir\n\n[1] TRUE\n\n\ndonor1_fat'../data/donor1_fat/count/sample_filtered_feature_bc_matrix'donor1_skin'../data/donor1_skin/count/sample_filtered_feature_bc_matrix'donor2_fat'../data/donor2_fat/count/sample_filtered_feature_bc_matrix'donor3_fat'../data/donor3_fat/count/sample_filtered_feature_bc_matrix'donor3_skin'../data/donor3_skin/count/sample_filtered_feature_bc_matrix'donor4_fat'../data/donor4_fat/count/sample_filtered_feature_bc_matrix'donor4_skin'../data/donor4_skin/count/sample_filtered_feature_bc_matrix'donor5_recovery'../data/donor5_recovery/filtered_feature_bc_matrix'donor6_fat'../data/donor6_fat/count/sample_filtered_feature_bc_matrix'donor6_skin'../data/donor6_skin/count/sample_filtered_feature_bc_matrix'donor7_fat'../data/donor7_fat/count/sample_filtered_feature_bc_matrix'donor7_skin'../data/donor7_skin/count/sample_filtered_feature_bc_matrix'\n\n\n\nfs &lt;- split(datadir, md$sequencing_run)\nfs &lt;- lapply(fs, function(u) {\n    rc &lt;- DropletUtils::read10xCounts(u)\n    nr &lt;- nrow(rc)\n    if(any(grep(\"Multiplexing\", rowData(rc)$Type))) {\n        rc &lt;- rc[rowData(rc)$Type != \"Multiplexing Capture\",]\n        removed &lt;- \"barcodes\"\n    }\n    else {\n        rc &lt;- rc[-grep(\"NA.[1-6]\", rownames(rc)),]\n        removed &lt;- \"features\"\n    }\n    cat(sprintf(\n        \"%s: removing %d %s; %d features left.\\n\", paste0(names(u), collapse=\",\"), \n        nr-nrow(rc), removed, nrow(rc)\n    ))\n    return(rc)\n})\n\nfs\n\ndonor1_fat,donor1_skin,donor2_fat: removing 3 barcodes; 21134 features left.\ndonor3_fat,donor3_skin,donor4_fat,donor4_skin: removing 4 barcodes; 21134 features left.\ndonor6_fat,donor6_skin,donor7_fat,donor7_skin: removing 6 barcodes; 21134 features left.\ndonor5_recovery: removing 6 features; 21134 features left.\n\n\n$`1`\nclass: SingleCellExperiment \ndim: 21134 6891 \nmetadata(1): Samples\nassays(1): counts\nrownames(21134): ENSG00000186092 ENSG00000284733 ... ENSG00000278817\n  ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n$`2`\nclass: SingleCellExperiment \ndim: 21134 2759 \nmetadata(1): Samples\nassays(1): counts\nrownames(21134): ENSG00000186092 ENSG00000284733 ... ENSG00000278817\n  ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n$`3`\nclass: SingleCellExperiment \ndim: 21134 8336 \nmetadata(1): Samples\nassays(1): counts\nrownames(21134): ENSG00000186092 ENSG00000284733 ... ENSG00000278817\n  ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n$`4`\nclass: SingleCellExperiment \ndim: 21134 4889 \nmetadata(1): Samples\nassays(1): counts\nrownames(21134): ENSG00000186092 ENSG00000284733 ... ENSG00000278817\n  ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\nsce &lt;- SingleCellExperiment(\n    assays = SimpleList(\n        counts = do.call(\"cbind\", lapply(fs, counts))\n    ),\n    rowData = rowData(fs[[1]]),\n    colData = do.call(\"rbind\", lapply(fs, colData))\n)\ntable(sce$Sample)\n\n\n     donor1_fat     donor1_skin      donor2_fat      donor3_fat     donor3_skin \n            162            3861            2868            1133             620 \n     donor4_fat     donor4_skin donor5_recovery      donor6_fat     donor6_skin \n            131             875            4889            2001            1715 \n     donor7_fat     donor7_skin \n           1713            2907 \n\n\n\ncolData(sce) &lt;- colData(sce) %&gt;% as.data.frame %&gt;%\n                left_join(md %&gt;% select(-keep,-notes), by = c(\"Sample\"=\"sample_name\")) %&gt;% DataFrame\ncolData(sce)\n\nDataFrame with 22875 rows and 7 columns\n               Sample            Barcode     donor      tissue tissue_origin\n          &lt;character&gt;        &lt;character&gt; &lt;numeric&gt; &lt;character&gt;   &lt;character&gt;\n1          donor1_fat AAAGAACCACATACGT-1         1         fat       abdomen\n2          donor1_fat AAAGGTAGTCCGGTCA-1         1         fat       abdomen\n3          donor1_fat AAAGGTATCTCTCTTC-1         1         fat       abdomen\n4          donor1_fat AACCACACAGTGGCTC-1         1         fat       abdomen\n5          donor1_fat AACCCAAGTATGGGAC-1         1         fat       abdomen\n...               ...                ...       ...         ...           ...\n22871 donor5_recovery TTTGGTTTCGACCAAT-1         5       mixed       abdomen\n22872 donor5_recovery TTTGTTGGTCCTACGG-1         5       mixed       abdomen\n22873 donor5_recovery TTTGTTGGTCGCAGTC-1         5       mixed       abdomen\n22874 donor5_recovery TTTGTTGGTGGCGTAA-1         5       mixed       abdomen\n22875 donor5_recovery TTTGTTGTCGGCATTA-1         5       mixed       abdomen\n      sequencing_run         sex\n           &lt;numeric&gt; &lt;character&gt;\n1                  1           F\n2                  1           F\n3                  1           F\n4                  1           F\n5                  1           F\n...              ...         ...\n22871              4           ?\n22872              4           ?\n22873              4           ?\n22874              4           ?\n22875              4           ?\n\n\n\ncolnames(sce) &lt;- paste0(sce$Sample, \".\", sce$Barcode)\nrownames(sce) &lt;- paste0(rowData(sce)$ID, \".\", rowData(sce)$Symbol)\nsce\n\nclass: SingleCellExperiment \ndim: 21134 22875 \nmetadata(0):\nassays(1): counts\nrownames(21134): ENSG00000186092.OR4F5 ENSG00000284733.OR4F29 ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(22875): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(7): Sample Barcode ... sequencing_run sex\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\n# very basic filter\nsce &lt;- sce[rowSums(counts(sce))&gt;0]\nsce\n\nclass: SingleCellExperiment \ndim: 18664 22875 \nmetadata(0):\nassays(1): counts\nrownames(18664): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(22875): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(7): Sample Barcode ... sequencing_run sex\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\nsaveRDS(sce, file=\"../output/0.0-sce-unfiltered.rds\")\n\n\nis.mito &lt;- grepl(\"\\\\.mt-\", rownames(sce), ignore.case = TRUE)\nrownames(sce)[is.mito]\nsum(is.mito)\n\n\n'ENSG00000210049.MT-TF''ENSG00000211459.MT-RNR1''ENSG00000210077.MT-TV''ENSG00000210082.MT-RNR2''ENSG00000209082.MT-TL1''ENSG00000198888.MT-ND1''ENSG00000210100.MT-TI''ENSG00000210107.MT-TQ''ENSG00000210112.MT-TM''ENSG00000198763.MT-ND2''ENSG00000210117.MT-TW''ENSG00000210127.MT-TA''ENSG00000210135.MT-TN''ENSG00000210140.MT-TC''ENSG00000210144.MT-TY''ENSG00000198804.MT-CO1''ENSG00000210151.MT-TS1''ENSG00000210154.MT-TD''ENSG00000198712.MT-CO2''ENSG00000210156.MT-TK''ENSG00000228253.MT-ATP8''ENSG00000198899.MT-ATP6''ENSG00000198938.MT-CO3''ENSG00000210164.MT-TG''ENSG00000198840.MT-ND3''ENSG00000210174.MT-TR''ENSG00000212907.MT-ND4L''ENSG00000198886.MT-ND4''ENSG00000210176.MT-TH''ENSG00000210184.MT-TS2''ENSG00000210191.MT-TL2''ENSG00000198786.MT-ND5''ENSG00000198695.MT-ND6''ENSG00000210194.MT-TE''ENSG00000198727.MT-CYB''ENSG00000210195.MT-TT''ENSG00000210196.MT-TP'\n\n\n37\n\n\n\nsce &lt;- addPerCellQC(sce, subsets=list(Mito=is.mito), percent_top=c(50,100,200,500))\nsce &lt;- sce[!is.mito]\nhead(colData(sce),3)\n\nDataFrame with 3 rows and 17 columns\n                                   Sample            Barcode     donor\n                              &lt;character&gt;        &lt;character&gt; &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1  donor1_fat AAAGAACCACATACGT-1         1\ndonor1_fat.AAAGGTAGTCCGGTCA-1  donor1_fat AAAGGTAGTCCGGTCA-1         1\ndonor1_fat.AAAGGTATCTCTCTTC-1  donor1_fat AAAGGTATCTCTCTTC-1         1\n                                   tissue tissue_origin sequencing_run\n                              &lt;character&gt;   &lt;character&gt;      &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1         fat       abdomen              1\ndonor1_fat.AAAGGTAGTCCGGTCA-1         fat       abdomen              1\ndonor1_fat.AAAGGTATCTCTCTTC-1         fat       abdomen              1\n                                      sex       sum  detected percent.top_50\n                              &lt;character&gt; &lt;numeric&gt; &lt;integer&gt;      &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1           F      4276      1721        33.8868\ndonor1_fat.AAAGGTAGTCCGGTCA-1           F      3023      1084        39.6626\ndonor1_fat.AAAGGTATCTCTCTTC-1           F      3892      1422        34.1213\n                              percent.top_100 percent.top_200 percent.top_500\n                                    &lt;numeric&gt;       &lt;numeric&gt;       &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1         42.7736         52.9935         69.3171\ndonor1_fat.AAAGGTAGTCCGGTCA-1         52.9937         65.0017         80.6814\ndonor1_fat.AAAGGTATCTCTCTTC-1         46.5570         58.3505         75.9250\n                              subsets_Mito_sum subsets_Mito_detected\n                                     &lt;numeric&gt;             &lt;integer&gt;\ndonor1_fat.AAAGAACCACATACGT-1              752                    16\ndonor1_fat.AAAGGTAGTCCGGTCA-1               52                    12\ndonor1_fat.AAAGGTATCTCTCTTC-1               48                    12\n                              subsets_Mito_percent     total\n                                         &lt;numeric&gt; &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1             17.58653      4276\ndonor1_fat.AAAGGTAGTCCGGTCA-1              1.72015      3023\ndonor1_fat.AAAGGTATCTCTCTTC-1              1.23330      3892\n\n\n\ncd_df &lt;- colData(sce) %&gt;% as.data.frame\ncd_df\n\n\nA data.frame: 22875 × 17\n\n\n\nSample\nBarcode\ndonor\ntissue\ntissue_origin\nsequencing_run\nsex\nsum\ndetected\npercent.top_50\npercent.top_100\npercent.top_200\npercent.top_500\nsubsets_Mito_sum\nsubsets_Mito_detected\nsubsets_Mito_percent\ntotal\n\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\nAAAGAACCACATACGT-1\n1\nfat\nabdomen\n1\nF\n4276\n1721\n33.88681\n42.77362\n52.99345\n69.31712\n752\n16\n17.5865295\n4276\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\nAAAGGTAGTCCGGTCA-1\n1\nfat\nabdomen\n1\nF\n3023\n1084\n39.66259\n52.99371\n65.00165\n80.68144\n52\n12\n1.7201456\n3023\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\nAAAGGTATCTCTCTTC-1\n1\nfat\nabdomen\n1\nF\n3892\n1422\n34.12127\n46.55704\n58.35046\n75.92497\n48\n12\n1.2332991\n3892\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\nAACCACACAGTGGCTC-1\n1\nfat\nabdomen\n1\nF\n7722\n2633\n26.89718\n38.12484\n48.67910\n64.12846\n103\n13\n1.3338513\n7722\n\n\ndonor1_fat.AACCCAAGTATGGGAC-1\ndonor1_fat\nAACCCAAGTATGGGAC-1\n1\nfat\nabdomen\n1\nF\n636\n178\n79.87421\n87.73585\n100.00000\n100.00000\n445\n15\n69.9685535\n636\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\nAACGGGATCTGCTGAA-1\n1\nfat\nabdomen\n1\nF\n3256\n1284\n34.33661\n46.80590\n59.06020\n75.92138\n123\n11\n3.7776413\n3256\n\n\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\nAAGAACATCTGTGCAA-1\n1\nfat\nabdomen\n1\nF\n6777\n1989\n32.86115\n47.38085\n60.01180\n74.07407\n224\n14\n3.3052973\n6777\n\n\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\nAAGCATCTCGATCCCT-1\n1\nfat\nabdomen\n1\nF\n1746\n839\n34.07789\n47.53723\n61.45475\n80.58419\n63\n11\n3.6082474\n1746\n\n\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\nAAGCGAGAGTATCCTG-1\n1\nfat\nabdomen\n1\nF\n6750\n2393\n24.08889\n35.12593\n46.69630\n63.71852\n277\n18\n4.1037037\n6750\n\n\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\nAAGTTCGAGGCAGGTT-1\n1\nfat\nabdomen\n1\nF\n5707\n2041\n31.20729\n43.42036\n54.17908\n68.91537\n188\n12\n3.2942001\n5707\n\n\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\nAATCGACCAATTGCAC-1\n1\nfat\nabdomen\n1\nF\n3401\n1534\n26.60982\n37.37136\n49.51485\n68.92091\n107\n15\n3.1461335\n3401\n\n\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\nACAAAGACAATGACCT-1\n1\nfat\nabdomen\n1\nF\n5851\n1802\n32.49017\n45.70159\n58.43446\n74.67100\n106\n16\n1.8116561\n5851\n\n\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\nACAAAGACACTAACGT-1\n1\nfat\nabdomen\n1\nF\n3602\n1004\n43.80900\n59.35591\n72.01555\n86.00777\n60\n11\n1.6657413\n3602\n\n\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\nACAACCAAGGGCTTCC-1\n1\nfat\nabdomen\n1\nF\n10238\n3273\n22.24067\n33.03380\n44.50088\n59.89451\n168\n12\n1.6409455\n10238\n\n\ndonor1_fat.ACAGGGACACACTTAG-1\ndonor1_fat\nACAGGGACACACTTAG-1\n1\nfat\nabdomen\n1\nF\n606\n63\n97.85479\n100.00000\n100.00000\n100.00000\n556\n15\n91.7491749\n606\n\n\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\nACAGGGATCTCATAGG-1\n1\nfat\nabdomen\n1\nF\n5210\n1884\n27.96545\n40.07678\n53.03263\n69.17466\n105\n13\n2.0153551\n5210\n\n\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\nACATTTCCACTCCACT-1\n1\nfat\nabdomen\n1\nF\n3606\n1305\n36.30061\n49.16805\n61.53633\n77.67610\n33\n11\n0.9151414\n3606\n\n\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\nACATTTCTCGATGGAG-1\n1\nfat\nabdomen\n1\nF\n3853\n1491\n34.07734\n47.31378\n58.44796\n74.27978\n68\n13\n1.7648586\n3853\n\n\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\nACCCTTGTCACCATAG-1\n1\nfat\nabdomen\n1\nF\n4627\n1604\n34.92544\n48.32505\n59.39053\n74.82170\n84\n12\n1.8154312\n4627\n\n\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\nACCTACCAGACCTCCG-1\n1\nfat\nabdomen\n1\nF\n1732\n651\n46.76674\n60.56582\n73.78753\n91.28176\n41\n12\n2.3672055\n1732\n\n\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\nACGGAAGCACACCTAA-1\n1\nfat\nabdomen\n1\nF\n5069\n2279\n17.65634\n25.42908\n36.41744\n56.77648\n369\n14\n7.2795423\n5069\n\n\ndonor1_fat.ACGTAACAGTCTAGCT-1\ndonor1_fat\nACGTAACAGTCTAGCT-1\n1\nfat\nabdomen\n1\nF\n1188\n491\n60.43771\n67.08754\n75.50505\n100.00000\n620\n18\n52.1885522\n1188\n\n\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\nACGTAGTTCCCGAAAT-1\n1\nfat\nabdomen\n1\nF\n3897\n1246\n36.23300\n49.73056\n62.63793\n80.70310\n39\n11\n1.0007698\n3897\n\n\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\nACGTTCCAGATGAATC-1\n1\nfat\nabdomen\n1\nF\n1884\n1136\n28.60934\n36.57113\n47.29299\n66.24204\n280\n13\n14.8619958\n1884\n\n\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\nACTCTCGAGCCGTTGC-1\n1\nfat\nabdomen\n1\nF\n1220\n611\n41.96721\n53.77049\n66.31148\n90.90164\n154\n15\n12.6229508\n1220\n\n\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\nACTTCCGTCAGGAACG-1\n1\nfat\nabdomen\n1\nF\n4898\n2364\n17.29277\n24.37730\n34.29971\n53.14414\n367\n16\n7.4928542\n4898\n\n\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\nAGACACTCAGGCGATA-1\n1\nfat\nabdomen\n1\nF\n4601\n1518\n33.51445\n46.70724\n59.70441\n76.26603\n171\n12\n3.7165834\n4601\n\n\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\nAGACCATTCAAAGGTA-1\n1\nfat\nabdomen\n1\nF\n7030\n2375\n27.28307\n38.50640\n50.54054\n66.28734\n27\n10\n0.3840683\n7030\n\n\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\nAGAGAGCCAAGCCCAC-1\n1\nfat\nabdomen\n1\nF\n3437\n1047\n43.26447\n57.81205\n69.53739\n84.08496\n85\n12\n2.4730870\n3437\n\n\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\nAGAGCCCAGTCTAGCT-1\n1\nfat\nabdomen\n1\nF\n4781\n1680\n33.44489\n46.37105\n58.12592\n73.41560\n110\n14\n2.3007739\n4781\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\ndonor5_recovery.TTTCGATAGTGGAATT-1\ndonor5_recovery\nTTTCGATAGTGGAATT-1\n5\nmixed\nabdomen\n4\n?\n3048\n1575\n21.42388\n31.33202\n42.84777\n64.20604\n139\n16\n4.5603675\n3048\n\n\ndonor5_recovery.TTTCGATGTGCTGATT-1\ndonor5_recovery\nTTTCGATGTGCTGATT-1\n5\nmixed\nabdomen\n4\n?\n2238\n1400\n17.20286\n25.24576\n36.90795\n59.78552\n57\n15\n2.5469169\n2238\n\n\ndonor5_recovery.TTTGACTAGATGGGCT-1\ndonor5_recovery\nTTTGACTAGATGGGCT-1\n5\nmixed\nabdomen\n4\n?\n2448\n1208\n27.69608\n39.95098\n53.10458\n71.07843\n95\n16\n3.8807190\n2448\n\n\ndonor5_recovery.TTTGACTAGTGTTCAC-1\ndonor5_recovery\nTTTGACTAGTGTTCAC-1\n5\nmixed\nabdomen\n4\n?\n6499\n2564\n24.23450\n34.06678\n44.72996\n60.70165\n78\n13\n1.2001846\n6499\n\n\ndonor5_recovery.TTTGACTGTCCAAATC-1\ndonor5_recovery\nTTTGACTGTCCAAATC-1\n5\nmixed\nabdomen\n4\n?\n958\n673\n24.32150\n35.80376\n50.62630\n81.94154\n8\n4\n0.8350731\n958\n\n\ndonor5_recovery.TTTGACTGTGATTCTG-1\ndonor5_recovery\nTTTGACTGTGATTCTG-1\n5\nmixed\nabdomen\n4\n?\n1568\n955\n26.97704\n37.75510\n50.70153\n70.98214\n71\n14\n4.5280612\n1568\n\n\ndonor5_recovery.TTTGACTGTTGTCTAG-1\ndonor5_recovery\nTTTGACTGTTGTCTAG-1\n5\nmixed\nabdomen\n4\n?\n936\n593\n29.70085\n42.30769\n58.01282\n90.06410\n38\n11\n4.0598291\n936\n\n\ndonor5_recovery.TTTGATCAGATGACCG-1\ndonor5_recovery\nTTTGATCAGATGACCG-1\n5\nmixed\nabdomen\n4\n?\n956\n596\n30.75314\n43.61925\n58.57741\n89.95816\n25\n8\n2.6150628\n956\n\n\ndonor5_recovery.TTTGATCAGCAATAAC-1\ndonor5_recovery\nTTTGATCAGCAATAAC-1\n5\nmixed\nabdomen\n4\n?\n2148\n939\n34.35754\n48.51024\n61.17318\n79.56238\n71\n14\n3.3054004\n2148\n\n\ndonor5_recovery.TTTGATCAGTTACTCG-1\ndonor5_recovery\nTTTGATCAGTTACTCG-1\n5\nmixed\nabdomen\n4\n?\n3145\n1486\n21.90779\n32.84579\n46.45469\n67.59936\n66\n15\n2.0985692\n3145\n\n\ndonor5_recovery.TTTGATCGTTGGGCCT-1\ndonor5_recovery\nTTTGATCGTTGGGCCT-1\n5\nmixed\nabdomen\n4\n?\n2897\n1316\n30.54884\n42.18157\n54.57370\n71.83293\n182\n17\n6.2823611\n2897\n\n\ndonor5_recovery.TTTGATCTCAAAGGTA-1\ndonor5_recovery\nTTTGATCTCAAAGGTA-1\n5\nmixed\nabdomen\n4\n?\n2155\n1136\n26.07889\n36.98376\n50.06961\n70.48724\n98\n14\n4.5475638\n2155\n\n\ndonor5_recovery.TTTGGAGAGTGCAAAT-1\ndonor5_recovery\nTTTGGAGAGTGCAAAT-1\n5\nmixed\nabdomen\n4\n?\n1054\n601\n34.91461\n48.10247\n61.95446\n90.41746\n43\n14\n4.0796964\n1054\n\n\ndonor5_recovery.TTTGGAGCATAGGTAA-1\ndonor5_recovery\nTTTGGAGCATAGGTAA-1\n5\nmixed\nabdomen\n4\n?\n1846\n1050\n23.34778\n33.91116\n47.50813\n70.20585\n89\n14\n4.8212351\n1846\n\n\ndonor5_recovery.TTTGGAGGTCAGTTTG-1\ndonor5_recovery\nTTTGGAGGTCAGTTTG-1\n5\nmixed\nabdomen\n4\n?\n1222\n769\n26.67758\n38.21604\n53.43699\n77.98691\n51\n13\n4.1734861\n1222\n\n\ndonor5_recovery.TTTGGAGGTCCAAGAG-1\ndonor5_recovery\nTTTGGAGGTCCAAGAG-1\n5\nmixed\nabdomen\n4\n?\n1829\n1058\n27.28267\n37.88956\n49.64461\n69.49153\n28\n12\n1.5308912\n1829\n\n\ndonor5_recovery.TTTGGAGGTCGACTTA-1\ndonor5_recovery\nTTTGGAGGTCGACTTA-1\n5\nmixed\nabdomen\n4\n?\n2389\n1430\n17.91545\n26.28715\n38.21683\n61.07158\n154\n21\n6.4462118\n2389\n\n\ndonor5_recovery.TTTGGAGGTTGAGAGC-1\ndonor5_recovery\nTTTGGAGGTTGAGAGC-1\n5\nmixed\nabdomen\n4\n?\n1618\n993\n21.69345\n32.26205\n46.66255\n69.53028\n38\n11\n2.3485785\n1618\n\n\ndonor5_recovery.TTTGGAGTCCAAGAGG-1\ndonor5_recovery\nTTTGGAGTCCAAGAGG-1\n5\nmixed\nabdomen\n4\n?\n1262\n830\n23.85103\n34.62758\n50.07924\n73.85103\n69\n14\n5.4675119\n1262\n\n\ndonor5_recovery.TTTGGAGTCTCAACCC-1\ndonor5_recovery\nTTTGGAGTCTCAACCC-1\n5\nmixed\nabdomen\n4\n?\n1135\n717\n29.51542\n40.79295\n54.44934\n80.88106\n18\n10\n1.5859031\n1135\n\n\ndonor5_recovery.TTTGGTTAGCCTCTTC-1\ndonor5_recovery\nTTTGGTTAGCCTCTTC-1\n5\nmixed\nabdomen\n4\n?\n763\n584\n24.90170\n36.56619\n49.67235\n88.99083\n24\n8\n3.1454784\n763\n\n\ndonor5_recovery.TTTGGTTCACTCTAGA-1\ndonor5_recovery\nTTTGGTTCACTCTAGA-1\n5\nmixed\nabdomen\n4\n?\n812\n570\n27.58621\n40.14778\n54.43350\n91.37931\n24\n8\n2.9556650\n812\n\n\ndonor5_recovery.TTTGGTTGTACGTGAG-1\ndonor5_recovery\nTTTGGTTGTACGTGAG-1\n5\nmixed\nabdomen\n4\n?\n755\n494\n30.99338\n44.90066\n61.05960\n100.00000\n34\n9\n4.5033113\n755\n\n\ndonor5_recovery.TTTGGTTGTCCTACAA-1\ndonor5_recovery\nTTTGGTTGTCCTACAA-1\n5\nmixed\nabdomen\n4\n?\n835\n625\n24.07186\n36.04790\n49.10180\n85.02994\n27\n6\n3.2335329\n835\n\n\ndonor5_recovery.TTTGGTTGTGACTCTA-1\ndonor5_recovery\nTTTGGTTGTGACTCTA-1\n5\nmixed\nabdomen\n4\n?\n938\n572\n29.63753\n43.39019\n60.34115\n92.32409\n2\n2\n0.2132196\n938\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\nTTTGGTTTCGACCAAT-1\n5\nmixed\nabdomen\n4\n?\n1328\n670\n34.33735\n48.34337\n64.30723\n87.19880\n67\n10\n5.0451807\n1328\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\nTTTGTTGGTCCTACGG-1\n5\nmixed\nabdomen\n4\n?\n795\n552\n28.30189\n41.63522\n55.72327\n93.45912\n44\n12\n5.5345912\n795\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\nTTTGTTGGTCGCAGTC-1\n5\nmixed\nabdomen\n4\n?\n1872\n1250\n16.18590\n24.73291\n37.01923\n59.93590\n66\n14\n3.5256410\n1872\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\nTTTGTTGGTGGCGTAA-1\n5\nmixed\nabdomen\n4\n?\n1928\n931\n33.14315\n46.21369\n58.97303\n77.64523\n51\n13\n2.6452282\n1928\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\nTTTGTTGTCGGCATTA-1\n5\nmixed\nabdomen\n4\n?\n2091\n1206\n21.95122\n32.56815\n45.28934\n66.23625\n53\n14\n2.5346724\n2091\n\n\n\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(cd_df, aes(sum, detected)) +\n    geom_point(size=.5) +\n    scale_x_log10() +\n    scale_y_log10() +\n    geom_density_2d(contour_var = \"ndensity\") +\n    facet_wrap(~Sample)\n\n\n\n\n\noptions(repr.plot.width=12, repr.plot.height=6)\n\nggplot(cd_df, aes(x=sum, color=Sample)) +\n    geom_density(size=4) +\n    scale_x_log10()\n\nWarning message:\n“Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.”\n\n\n\n\n\n\noptions(repr.plot.width=12, repr.plot.height=6)\n\nggplot(cd_df, aes(x=detected, color=Sample)) +\n  geom_density(linewidth=4) +\n  scale_x_log10()\n\n\n\n\n\noptions(repr.plot.width=12, repr.plot.height=12)\n\nggplot(cd_df, aes(x=Sample, y=sum)) +\n    geom_violin() +\n    geom_jitter() +\n    scale_y_log10()\n\n\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(cd_df, aes(sum, percent.top_50)) +\n    geom_point(size=.5) +\n    scale_x_log10() +\n    geom_density_2d(contour_var = \"ndensity\") +\n    facet_wrap(~Sample)\n\n\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(cd_df, aes(sum, subsets_Mito_percent)) +\n    geom_point(size=.5) +\n    scale_x_log10() +\n    scale_y_sqrt() +\n    geom_density_2d(contour_var = \"ndensity\") +\n    facet_wrap(~Sample)\n\n\n\n\n\nmito_cutoff &lt;- 30\ndetected_cutoff &lt;- 200\n\n\nwith(cd_df, table(Sample, detected &lt; detected_cutoff))\nwith(cd_df, table(Sample, subsets_Mito_percent &gt; mito_cutoff))\nwith(cd_df, table(Sample, subsets_Mito_percent &gt; mito_cutoff | detected &lt; detected_cutoff))\n\n                 \nSample            FALSE TRUE\n  donor1_fat        159    3\n  donor1_skin      3844   17\n  donor2_fat       2852   16\n  donor3_fat       1122   11\n  donor3_skin       611    9\n  donor4_fat        123    8\n  donor4_skin       810   65\n  donor5_recovery  4887    2\n  donor6_fat       2000    1\n  donor6_skin      1715    0\n  donor7_fat       1713    0\n  donor7_skin      2907    0\n\n\n                 \nSample            FALSE TRUE\n  donor1_fat        158    4\n  donor1_skin      3804   57\n  donor2_fat       2823   45\n  donor3_fat       1063   70\n  donor3_skin       573   47\n  donor4_fat         89   42\n  donor4_skin       638  237\n  donor5_recovery  4880    9\n  donor6_fat       1994    7\n  donor6_skin      1710    5\n  donor7_fat       1708    5\n  donor7_skin      2898    9\n\n\n                 \nSample            FALSE TRUE\n  donor1_fat        158    4\n  donor1_skin      3804   57\n  donor2_fat       2823   45\n  donor3_fat       1063   70\n  donor3_skin       573   47\n  donor4_fat         89   42\n  donor4_skin       638  237\n  donor5_recovery  4879   10\n  donor6_fat       1994    7\n  donor6_skin      1710    5\n  donor7_fat       1708    5\n  donor7_skin      2898    9\n\n\n\nsce &lt;- sce[, (sce$subsets_Mito_percent &lt; mito_cutoff) & (sce$detected &gt; detected_cutoff)]\nsce\n\nclass: SingleCellExperiment \ndim: 18627 22337 \nmetadata(0):\nassays(1): counts\nrownames(18627): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(22337): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(17): Sample Barcode ... subsets_Mito_percent total\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\ntable(sce$tissue)\n\n\n  fat mixed  skin \n 7835  4879  9623 \n\n\n\ncd_df &lt;- colData(sce) %&gt;% as.data.frame\n\ncd_df &lt;- cd_df %&gt;% mutate(\n    outlier_sum=isOutlier(\n        sum, nmads=4, type=\"both\", log=TRUE, batch=Sample\n    ),\n    outlier_detected=isOutlier(\n        detected, nmads=4, type=\"both\", log=TRUE, batch=Sample\n    )\n)\n\ncd_df\n\n\nA data.frame: 22337 × 19\n\n\n\nSample\nBarcode\ndonor\ntissue\ntissue_origin\nsequencing_run\nsex\nsum\ndetected\npercent.top_50\npercent.top_100\npercent.top_200\npercent.top_500\nsubsets_Mito_sum\nsubsets_Mito_detected\nsubsets_Mito_percent\ntotal\noutlier_sum\noutlier_detected\n\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;otlr.flt&gt;\n&lt;otlr.flt&gt;\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\nAAAGAACCACATACGT-1\n1\nfat\nabdomen\n1\nF\n4276\n1721\n33.88681\n42.77362\n52.99345\n69.31712\n752\n16\n17.5865295\n4276\nFALSE\nFALSE\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\nAAAGGTAGTCCGGTCA-1\n1\nfat\nabdomen\n1\nF\n3023\n1084\n39.66259\n52.99371\n65.00165\n80.68144\n52\n12\n1.7201456\n3023\nFALSE\nFALSE\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\nAAAGGTATCTCTCTTC-1\n1\nfat\nabdomen\n1\nF\n3892\n1422\n34.12127\n46.55704\n58.35046\n75.92497\n48\n12\n1.2332991\n3892\nFALSE\nFALSE\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\nAACCACACAGTGGCTC-1\n1\nfat\nabdomen\n1\nF\n7722\n2633\n26.89718\n38.12484\n48.67910\n64.12846\n103\n13\n1.3338513\n7722\nFALSE\nFALSE\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\nAACGGGATCTGCTGAA-1\n1\nfat\nabdomen\n1\nF\n3256\n1284\n34.33661\n46.80590\n59.06020\n75.92138\n123\n11\n3.7776413\n3256\nFALSE\nFALSE\n\n\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\nAAGAACATCTGTGCAA-1\n1\nfat\nabdomen\n1\nF\n6777\n1989\n32.86115\n47.38085\n60.01180\n74.07407\n224\n14\n3.3052973\n6777\nFALSE\nFALSE\n\n\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\nAAGCATCTCGATCCCT-1\n1\nfat\nabdomen\n1\nF\n1746\n839\n34.07789\n47.53723\n61.45475\n80.58419\n63\n11\n3.6082474\n1746\nFALSE\nFALSE\n\n\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\nAAGCGAGAGTATCCTG-1\n1\nfat\nabdomen\n1\nF\n6750\n2393\n24.08889\n35.12593\n46.69630\n63.71852\n277\n18\n4.1037037\n6750\nFALSE\nFALSE\n\n\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\nAAGTTCGAGGCAGGTT-1\n1\nfat\nabdomen\n1\nF\n5707\n2041\n31.20729\n43.42036\n54.17908\n68.91537\n188\n12\n3.2942001\n5707\nFALSE\nFALSE\n\n\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\nAATCGACCAATTGCAC-1\n1\nfat\nabdomen\n1\nF\n3401\n1534\n26.60982\n37.37136\n49.51485\n68.92091\n107\n15\n3.1461335\n3401\nFALSE\nFALSE\n\n\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\nACAAAGACAATGACCT-1\n1\nfat\nabdomen\n1\nF\n5851\n1802\n32.49017\n45.70159\n58.43446\n74.67100\n106\n16\n1.8116561\n5851\nFALSE\nFALSE\n\n\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\nACAAAGACACTAACGT-1\n1\nfat\nabdomen\n1\nF\n3602\n1004\n43.80900\n59.35591\n72.01555\n86.00777\n60\n11\n1.6657413\n3602\nFALSE\nFALSE\n\n\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\nACAACCAAGGGCTTCC-1\n1\nfat\nabdomen\n1\nF\n10238\n3273\n22.24067\n33.03380\n44.50088\n59.89451\n168\n12\n1.6409455\n10238\nFALSE\nFALSE\n\n\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\nACAGGGATCTCATAGG-1\n1\nfat\nabdomen\n1\nF\n5210\n1884\n27.96545\n40.07678\n53.03263\n69.17466\n105\n13\n2.0153551\n5210\nFALSE\nFALSE\n\n\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\nACATTTCCACTCCACT-1\n1\nfat\nabdomen\n1\nF\n3606\n1305\n36.30061\n49.16805\n61.53633\n77.67610\n33\n11\n0.9151414\n3606\nFALSE\nFALSE\n\n\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\nACATTTCTCGATGGAG-1\n1\nfat\nabdomen\n1\nF\n3853\n1491\n34.07734\n47.31378\n58.44796\n74.27978\n68\n13\n1.7648586\n3853\nFALSE\nFALSE\n\n\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\nACCCTTGTCACCATAG-1\n1\nfat\nabdomen\n1\nF\n4627\n1604\n34.92544\n48.32505\n59.39053\n74.82170\n84\n12\n1.8154312\n4627\nFALSE\nFALSE\n\n\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\nACCTACCAGACCTCCG-1\n1\nfat\nabdomen\n1\nF\n1732\n651\n46.76674\n60.56582\n73.78753\n91.28176\n41\n12\n2.3672055\n1732\nFALSE\nFALSE\n\n\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\nACGGAAGCACACCTAA-1\n1\nfat\nabdomen\n1\nF\n5069\n2279\n17.65634\n25.42908\n36.41744\n56.77648\n369\n14\n7.2795423\n5069\nFALSE\nFALSE\n\n\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\nACGTAGTTCCCGAAAT-1\n1\nfat\nabdomen\n1\nF\n3897\n1246\n36.23300\n49.73056\n62.63793\n80.70310\n39\n11\n1.0007698\n3897\nFALSE\nFALSE\n\n\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\nACGTTCCAGATGAATC-1\n1\nfat\nabdomen\n1\nF\n1884\n1136\n28.60934\n36.57113\n47.29299\n66.24204\n280\n13\n14.8619958\n1884\nFALSE\nFALSE\n\n\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\nACTCTCGAGCCGTTGC-1\n1\nfat\nabdomen\n1\nF\n1220\n611\n41.96721\n53.77049\n66.31148\n90.90164\n154\n15\n12.6229508\n1220\nFALSE\nFALSE\n\n\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\nACTTCCGTCAGGAACG-1\n1\nfat\nabdomen\n1\nF\n4898\n2364\n17.29277\n24.37730\n34.29971\n53.14414\n367\n16\n7.4928542\n4898\nFALSE\nFALSE\n\n\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\nAGACACTCAGGCGATA-1\n1\nfat\nabdomen\n1\nF\n4601\n1518\n33.51445\n46.70724\n59.70441\n76.26603\n171\n12\n3.7165834\n4601\nFALSE\nFALSE\n\n\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\nAGACCATTCAAAGGTA-1\n1\nfat\nabdomen\n1\nF\n7030\n2375\n27.28307\n38.50640\n50.54054\n66.28734\n27\n10\n0.3840683\n7030\nFALSE\nFALSE\n\n\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\nAGAGAGCCAAGCCCAC-1\n1\nfat\nabdomen\n1\nF\n3437\n1047\n43.26447\n57.81205\n69.53739\n84.08496\n85\n12\n2.4730870\n3437\nFALSE\nFALSE\n\n\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\nAGAGCCCAGTCTAGCT-1\n1\nfat\nabdomen\n1\nF\n4781\n1680\n33.44489\n46.37105\n58.12592\n73.41560\n110\n14\n2.3007739\n4781\nFALSE\nFALSE\n\n\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat\nAGATCCAGTGCAGTGA-1\n1\nfat\nabdomen\n1\nF\n3119\n1398\n30.49054\n42.70600\n53.83136\n71.20872\n84\n12\n2.6931709\n3119\nFALSE\nFALSE\n\n\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat\nAGATCGTGTTGCGTAT-1\n1\nfat\nabdomen\n1\nF\n4444\n1616\n32.06571\n45.16202\n56.79568\n73.33483\n7\n5\n0.1575158\n4444\nFALSE\nFALSE\n\n\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat\nAGGAGGTCAATACGAA-1\n1\nfat\nabdomen\n1\nF\n3179\n1211\n36.83548\n49.82699\n61.81189\n77.63448\n108\n12\n3.3972947\n3179\nFALSE\nFALSE\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\ndonor5_recovery.TTTCGATAGTGGAATT-1\ndonor5_recovery\nTTTCGATAGTGGAATT-1\n5\nmixed\nabdomen\n4\n?\n3048\n1575\n21.42388\n31.33202\n42.84777\n64.20604\n139\n16\n4.5603675\n3048\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTCGATGTGCTGATT-1\ndonor5_recovery\nTTTCGATGTGCTGATT-1\n5\nmixed\nabdomen\n4\n?\n2238\n1400\n17.20286\n25.24576\n36.90795\n59.78552\n57\n15\n2.5469169\n2238\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGACTAGATGGGCT-1\ndonor5_recovery\nTTTGACTAGATGGGCT-1\n5\nmixed\nabdomen\n4\n?\n2448\n1208\n27.69608\n39.95098\n53.10458\n71.07843\n95\n16\n3.8807190\n2448\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGACTAGTGTTCAC-1\ndonor5_recovery\nTTTGACTAGTGTTCAC-1\n5\nmixed\nabdomen\n4\n?\n6499\n2564\n24.23450\n34.06678\n44.72996\n60.70165\n78\n13\n1.2001846\n6499\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGACTGTCCAAATC-1\ndonor5_recovery\nTTTGACTGTCCAAATC-1\n5\nmixed\nabdomen\n4\n?\n958\n673\n24.32150\n35.80376\n50.62630\n81.94154\n8\n4\n0.8350731\n958\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGACTGTGATTCTG-1\ndonor5_recovery\nTTTGACTGTGATTCTG-1\n5\nmixed\nabdomen\n4\n?\n1568\n955\n26.97704\n37.75510\n50.70153\n70.98214\n71\n14\n4.5280612\n1568\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGACTGTTGTCTAG-1\ndonor5_recovery\nTTTGACTGTTGTCTAG-1\n5\nmixed\nabdomen\n4\n?\n936\n593\n29.70085\n42.30769\n58.01282\n90.06410\n38\n11\n4.0598291\n936\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGATCAGATGACCG-1\ndonor5_recovery\nTTTGATCAGATGACCG-1\n5\nmixed\nabdomen\n4\n?\n956\n596\n30.75314\n43.61925\n58.57741\n89.95816\n25\n8\n2.6150628\n956\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGATCAGCAATAAC-1\ndonor5_recovery\nTTTGATCAGCAATAAC-1\n5\nmixed\nabdomen\n4\n?\n2148\n939\n34.35754\n48.51024\n61.17318\n79.56238\n71\n14\n3.3054004\n2148\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGATCAGTTACTCG-1\ndonor5_recovery\nTTTGATCAGTTACTCG-1\n5\nmixed\nabdomen\n4\n?\n3145\n1486\n21.90779\n32.84579\n46.45469\n67.59936\n66\n15\n2.0985692\n3145\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGATCGTTGGGCCT-1\ndonor5_recovery\nTTTGATCGTTGGGCCT-1\n5\nmixed\nabdomen\n4\n?\n2897\n1316\n30.54884\n42.18157\n54.57370\n71.83293\n182\n17\n6.2823611\n2897\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGATCTCAAAGGTA-1\ndonor5_recovery\nTTTGATCTCAAAGGTA-1\n5\nmixed\nabdomen\n4\n?\n2155\n1136\n26.07889\n36.98376\n50.06961\n70.48724\n98\n14\n4.5475638\n2155\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGAGTGCAAAT-1\ndonor5_recovery\nTTTGGAGAGTGCAAAT-1\n5\nmixed\nabdomen\n4\n?\n1054\n601\n34.91461\n48.10247\n61.95446\n90.41746\n43\n14\n4.0796964\n1054\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGCATAGGTAA-1\ndonor5_recovery\nTTTGGAGCATAGGTAA-1\n5\nmixed\nabdomen\n4\n?\n1846\n1050\n23.34778\n33.91116\n47.50813\n70.20585\n89\n14\n4.8212351\n1846\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCAGTTTG-1\ndonor5_recovery\nTTTGGAGGTCAGTTTG-1\n5\nmixed\nabdomen\n4\n?\n1222\n769\n26.67758\n38.21604\n53.43699\n77.98691\n51\n13\n4.1734861\n1222\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCCAAGAG-1\ndonor5_recovery\nTTTGGAGGTCCAAGAG-1\n5\nmixed\nabdomen\n4\n?\n1829\n1058\n27.28267\n37.88956\n49.64461\n69.49153\n28\n12\n1.5308912\n1829\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCGACTTA-1\ndonor5_recovery\nTTTGGAGGTCGACTTA-1\n5\nmixed\nabdomen\n4\n?\n2389\n1430\n17.91545\n26.28715\n38.21683\n61.07158\n154\n21\n6.4462118\n2389\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTTGAGAGC-1\ndonor5_recovery\nTTTGGAGGTTGAGAGC-1\n5\nmixed\nabdomen\n4\n?\n1618\n993\n21.69345\n32.26205\n46.66255\n69.53028\n38\n11\n2.3485785\n1618\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGTCCAAGAGG-1\ndonor5_recovery\nTTTGGAGTCCAAGAGG-1\n5\nmixed\nabdomen\n4\n?\n1262\n830\n23.85103\n34.62758\n50.07924\n73.85103\n69\n14\n5.4675119\n1262\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGAGTCTCAACCC-1\ndonor5_recovery\nTTTGGAGTCTCAACCC-1\n5\nmixed\nabdomen\n4\n?\n1135\n717\n29.51542\n40.79295\n54.44934\n80.88106\n18\n10\n1.5859031\n1135\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTAGCCTCTTC-1\ndonor5_recovery\nTTTGGTTAGCCTCTTC-1\n5\nmixed\nabdomen\n4\n?\n763\n584\n24.90170\n36.56619\n49.67235\n88.99083\n24\n8\n3.1454784\n763\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTCACTCTAGA-1\ndonor5_recovery\nTTTGGTTCACTCTAGA-1\n5\nmixed\nabdomen\n4\n?\n812\n570\n27.58621\n40.14778\n54.43350\n91.37931\n24\n8\n2.9556650\n812\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTACGTGAG-1\ndonor5_recovery\nTTTGGTTGTACGTGAG-1\n5\nmixed\nabdomen\n4\n?\n755\n494\n30.99338\n44.90066\n61.05960\n100.00000\n34\n9\n4.5033113\n755\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTCCTACAA-1\ndonor5_recovery\nTTTGGTTGTCCTACAA-1\n5\nmixed\nabdomen\n4\n?\n835\n625\n24.07186\n36.04790\n49.10180\n85.02994\n27\n6\n3.2335329\n835\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTGACTCTA-1\ndonor5_recovery\nTTTGGTTGTGACTCTA-1\n5\nmixed\nabdomen\n4\n?\n938\n572\n29.63753\n43.39019\n60.34115\n92.32409\n2\n2\n0.2132196\n938\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\nTTTGGTTTCGACCAAT-1\n5\nmixed\nabdomen\n4\n?\n1328\n670\n34.33735\n48.34337\n64.30723\n87.19880\n67\n10\n5.0451807\n1328\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\nTTTGTTGGTCCTACGG-1\n5\nmixed\nabdomen\n4\n?\n795\n552\n28.30189\n41.63522\n55.72327\n93.45912\n44\n12\n5.5345912\n795\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\nTTTGTTGGTCGCAGTC-1\n5\nmixed\nabdomen\n4\n?\n1872\n1250\n16.18590\n24.73291\n37.01923\n59.93590\n66\n14\n3.5256410\n1872\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\nTTTGTTGGTGGCGTAA-1\n5\nmixed\nabdomen\n4\n?\n1928\n931\n33.14315\n46.21369\n58.97303\n77.64523\n51\n13\n2.6452282\n1928\nFALSE\nFALSE\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\nTTTGTTGTCGGCATTA-1\n5\nmixed\nabdomen\n4\n?\n2091\n1206\n21.95122\n32.56815\n45.28934\n66.23625\n53\n14\n2.5346724\n2091\nFALSE\nFALSE\n\n\n\n\n\n\nwith(cd_df, table(outlier_sum, outlier_detected))\n\n           outlier_detected\noutlier_sum FALSE  TRUE\n      FALSE 22274    12\n      TRUE     12    39\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\n\nggplot(cd_df, aes(sum, detected, color=outlier_sum, shape=outlier_detected)) +\n    geom_point(size=2) +\n    scale_x_log10() +\n    scale_y_log10() +\n    facet_wrap(~Sample)\n\n\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(cd_df, aes(sum, subsets_Mito_percent, color=outlier_sum, shape=outlier_detected)) +\n    geom_point(size=2) +\n    scale_x_log10() +\n    facet_wrap(~Sample)\n\n\n\n\n\ncolData(sce) &lt;- cd_df %&gt;% DataFrame\ncolData(sce) \n\nDataFrame with 22337 rows and 19 columns\n                                            Sample            Barcode     donor\n                                       &lt;character&gt;        &lt;character&gt; &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1           donor1_fat AAAGAACCACATACGT-1         1\ndonor1_fat.AAAGGTAGTCCGGTCA-1           donor1_fat AAAGGTAGTCCGGTCA-1         1\ndonor1_fat.AAAGGTATCTCTCTTC-1           donor1_fat AAAGGTATCTCTCTTC-1         1\ndonor1_fat.AACCACACAGTGGCTC-1           donor1_fat AACCACACAGTGGCTC-1         1\ndonor1_fat.AACGGGATCTGCTGAA-1           donor1_fat AACGGGATCTGCTGAA-1         1\n...                                            ...                ...       ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1 donor5_recovery TTTGGTTTCGACCAAT-1         5\ndonor5_recovery.TTTGTTGGTCCTACGG-1 donor5_recovery TTTGTTGGTCCTACGG-1         5\ndonor5_recovery.TTTGTTGGTCGCAGTC-1 donor5_recovery TTTGTTGGTCGCAGTC-1         5\ndonor5_recovery.TTTGTTGGTGGCGTAA-1 donor5_recovery TTTGTTGGTGGCGTAA-1         5\ndonor5_recovery.TTTGTTGTCGGCATTA-1 donor5_recovery TTTGTTGTCGGCATTA-1         5\n                                        tissue tissue_origin sequencing_run\n                                   &lt;character&gt;   &lt;character&gt;      &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1              fat       abdomen              1\ndonor1_fat.AAAGGTAGTCCGGTCA-1              fat       abdomen              1\ndonor1_fat.AAAGGTATCTCTCTTC-1              fat       abdomen              1\ndonor1_fat.AACCACACAGTGGCTC-1              fat       abdomen              1\ndonor1_fat.AACGGGATCTGCTGAA-1              fat       abdomen              1\n...                                        ...           ...            ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1       mixed       abdomen              4\ndonor5_recovery.TTTGTTGGTCCTACGG-1       mixed       abdomen              4\ndonor5_recovery.TTTGTTGGTCGCAGTC-1       mixed       abdomen              4\ndonor5_recovery.TTTGTTGGTGGCGTAA-1       mixed       abdomen              4\ndonor5_recovery.TTTGTTGTCGGCATTA-1       mixed       abdomen              4\n                                           sex       sum  detected\n                                   &lt;character&gt; &lt;numeric&gt; &lt;integer&gt;\ndonor1_fat.AAAGAACCACATACGT-1                F      4276      1721\ndonor1_fat.AAAGGTAGTCCGGTCA-1                F      3023      1084\ndonor1_fat.AAAGGTATCTCTCTTC-1                F      3892      1422\ndonor1_fat.AACCACACAGTGGCTC-1                F      7722      2633\ndonor1_fat.AACGGGATCTGCTGAA-1                F      3256      1284\n...                                        ...       ...       ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1           ?      1328       670\ndonor5_recovery.TTTGTTGGTCCTACGG-1           ?       795       552\ndonor5_recovery.TTTGTTGGTCGCAGTC-1           ?      1872      1250\ndonor5_recovery.TTTGTTGGTGGCGTAA-1           ?      1928       931\ndonor5_recovery.TTTGTTGTCGGCATTA-1           ?      2091      1206\n                                   percent.top_50 percent.top_100\n                                        &lt;numeric&gt;       &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1             33.8868         42.7736\ndonor1_fat.AAAGGTAGTCCGGTCA-1             39.6626         52.9937\ndonor1_fat.AAAGGTATCTCTCTTC-1             34.1213         46.5570\ndonor1_fat.AACCACACAGTGGCTC-1             26.8972         38.1248\ndonor1_fat.AACGGGATCTGCTGAA-1             34.3366         46.8059\n...                                           ...             ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1        34.3373         48.3434\ndonor5_recovery.TTTGTTGGTCCTACGG-1        28.3019         41.6352\ndonor5_recovery.TTTGTTGGTCGCAGTC-1        16.1859         24.7329\ndonor5_recovery.TTTGTTGGTGGCGTAA-1        33.1432         46.2137\ndonor5_recovery.TTTGTTGTCGGCATTA-1        21.9512         32.5681\n                                   percent.top_200 percent.top_500\n                                         &lt;numeric&gt;       &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1              52.9935         69.3171\ndonor1_fat.AAAGGTAGTCCGGTCA-1              65.0017         80.6814\ndonor1_fat.AAAGGTATCTCTCTTC-1              58.3505         75.9250\ndonor1_fat.AACCACACAGTGGCTC-1              48.6791         64.1285\ndonor1_fat.AACGGGATCTGCTGAA-1              59.0602         75.9214\n...                                            ...             ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1         64.3072         87.1988\ndonor5_recovery.TTTGTTGGTCCTACGG-1         55.7233         93.4591\ndonor5_recovery.TTTGTTGGTCGCAGTC-1         37.0192         59.9359\ndonor5_recovery.TTTGTTGGTGGCGTAA-1         58.9730         77.6452\ndonor5_recovery.TTTGTTGTCGGCATTA-1         45.2893         66.2363\n                                   subsets_Mito_sum subsets_Mito_detected\n                                          &lt;numeric&gt;             &lt;integer&gt;\ndonor1_fat.AAAGAACCACATACGT-1                   752                    16\ndonor1_fat.AAAGGTAGTCCGGTCA-1                    52                    12\ndonor1_fat.AAAGGTATCTCTCTTC-1                    48                    12\ndonor1_fat.AACCACACAGTGGCTC-1                   103                    13\ndonor1_fat.AACGGGATCTGCTGAA-1                   123                    11\n...                                             ...                   ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1               67                    10\ndonor5_recovery.TTTGTTGGTCCTACGG-1               44                    12\ndonor5_recovery.TTTGTTGGTCGCAGTC-1               66                    14\ndonor5_recovery.TTTGTTGGTGGCGTAA-1               51                    13\ndonor5_recovery.TTTGTTGTCGGCATTA-1               53                    14\n                                   subsets_Mito_percent     total\n                                              &lt;numeric&gt; &lt;numeric&gt;\ndonor1_fat.AAAGAACCACATACGT-1                  17.58653      4276\ndonor1_fat.AAAGGTAGTCCGGTCA-1                   1.72015      3023\ndonor1_fat.AAAGGTATCTCTCTTC-1                   1.23330      3892\ndonor1_fat.AACCACACAGTGGCTC-1                   1.33385      7722\ndonor1_fat.AACGGGATCTGCTGAA-1                   3.77764      3256\n...                                                 ...       ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1              5.04518      1328\ndonor5_recovery.TTTGTTGGTCCTACGG-1              5.53459       795\ndonor5_recovery.TTTGTTGGTCGCAGTC-1              3.52564      1872\ndonor5_recovery.TTTGTTGGTGGCGTAA-1              2.64523      1928\ndonor5_recovery.TTTGTTGTCGGCATTA-1              2.53467      2091\n                                        outlier_sum outlier_detected\n                                   &lt;outlier.filter&gt; &lt;outlier.filter&gt;\ndonor1_fat.AAAGAACCACATACGT-1                 FALSE            FALSE\ndonor1_fat.AAAGGTAGTCCGGTCA-1                 FALSE            FALSE\ndonor1_fat.AAAGGTATCTCTCTTC-1                 FALSE            FALSE\ndonor1_fat.AACCACACAGTGGCTC-1                 FALSE            FALSE\ndonor1_fat.AACGGGATCTGCTGAA-1                 FALSE            FALSE\n...                                             ...              ...\ndonor5_recovery.TTTGGTTTCGACCAAT-1            FALSE            FALSE\ndonor5_recovery.TTTGTTGGTCCTACGG-1            FALSE            FALSE\ndonor5_recovery.TTTGTTGGTCGCAGTC-1            FALSE            FALSE\ndonor5_recovery.TTTGTTGGTGGCGTAA-1            FALSE            FALSE\ndonor5_recovery.TTTGTTGTCGGCATTA-1            FALSE            FALSE\n\n\n\nsce &lt;- sce[,!colData(sce)$outlier_detected]\nsce &lt;- sce[,!colData(sce)$outlier_sum]\nsce\n\nclass: SingleCellExperiment \ndim: 18627 22274 \nmetadata(0):\nassays(1): counts\nrownames(18627): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(22274): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(19): Sample Barcode ... outlier_sum outlier_detected\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\nsaveRDS(sce, file=\"../output/0.1-sce-after-filtering.rds\")\n\n\nmarkers &lt;- googlesheets4::read_sheet(md_sheet, sheet = \"markers\")\nmarkers\n\n✔ Reading from halin-bauer-hLECs-metadata.\n\n✔ Range ''markers''.\n\n\n\n\nA tibble: 37 × 5\n\n\ngene_name\nsubpopulation\nsubpopshort\ndirection\nknown\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n\n\n\n\nENSG00000117707.PROX1\nLECs\nLEC\npositive\nyes\n\n\nENSG00000162493.PDPN\nLECs\nLEC\npositive\nyes\n\n\nENSG00000133800.LYVE1\ncapillary-LEC\ncpLEC\npositive\nyes\n\n\nENSG00000137077.CCL21\ncapillary-LEC\ncpLEC\npositive\nyes\n\n\nENSG00000189056.RELN\ncapillary-LEC\ncpLEC\npositive\nyes\n\n\nENSG00000129048.ACKR4\ncapillary-LEC\ncpLEC\nnegative\nyes\n\n\nENSG00000108691.CCL2\ncapillary-LEC\ncpLEC\nnegative\nno\n\n\nENSG00000081041.CXCL2\ncapillary-LEC\ncpLEC\nnegative\nno\n\n\nENSG00000133800.LYVE1\nprecollector-LEC\npcLEC\npositive\nyes\n\n\nENSG00000137077.CCL21\nprecollector-LEC\npcLEC\npositive\nyes\n\n\nENSG00000189056.RELN\nprecollector-LEC\npcLEC\npositive\nyes\n\n\nENSG00000129048.ACKR4\nprecollector-LEC\npcLEC\nnegative\nyes\n\n\nENSG00000108691.CCL2\nprecollector-LEC\npcLEC\npositive\nno\n\n\nENSG00000081041.CXCL2\nprecollector-LEC\npcLEC\npositive\nno\n\n\nENSG00000133800.LYVE1\ncollector-LEC\nclLEC\nnegative\nyes\n\n\nENSG00000137077.CCL21\ncollector-LEC\nclLEC\nnegative\nyes\n\n\nENSG00000189056.RELN\ncollector-LEC\nclLEC\nnegative\nyes\n\n\nENSG00000129048.ACKR4\ncollector-LEC\nclLEC\npositive\nyes\n\n\nENSG00000108691.CCL2\ncollector-LEC\nclLEC\npositive\nno\n\n\nENSG00000081041.CXCL2\ncollector-LEC\nclLEC\npositive\nno\n\n\nENSG00000137077.CCL21\nvalve-LEC\nvLEC\nnegative\nyes\n\n\nENSG00000133800.LYVE1\nvalve-LEC\nvLEC\nnegative\nyes\n\n\nENSG00000013297.CLDN11\nvalve-LEC\nvLEC\npositive\nyes\n\n\nENSG00000272398.CD24\nvalve-LEC\nvLEC\npositive\nno\n\n\nENSG00000149564.ESAM\nvalve-LEC\nvLEC\npositive\nno\n\n\nENSG00000170017.ALCAM\nvalve-LEC\nvLEC\npositive\nno\n\n\nENSG00000108821.COL1A1\ncontaminant-fibroblasts-smooth-muscle\nCONT-FSM\npositive\nyes\n\n\nENSG00000113721.PDGFRB\ncontaminant-fibroblasts-smooth-muscle\nCONT-FSM\npositive\nyes\n\n\nENSG00000107796.ACTA2\ncontaminant-fibroblasts-smooth-muscle\nCONT-FSM\npositive\nyes\n\n\nENSG00000186081.KRT5\ncontaminant-keratinocytes\nCONT-K\npositive\nyes\n\n\nENSG00000186847.KRT14\ncontaminant-keratinocytes\nCONT-K\npositive\nyes\n\n\nENSG00000081237.PTPRC\ncontaminant-leukocytes\nCONT-L\npositive\nyes\n\n\nENSG00000102755.FLT1\ncontaminant-blood-endothelial-cells\nCONT-BEC\npositive\nyes\n\n\nENSG00000154721.JAM2\ncontaminant-blood-endothelial-cells\nCONT-BEC\npositive\nyes\n\n\nENSG00000090339.ICAM1\nLECs\nLEC\npositive\n?\n\n\nENSG00000103335.PIEZO1\nLECs\nLEC\npositive\n?\n\n\nENSG00000154864.PIEZO2\nLECs\nLEC\npositive\n?\n\n\n\n\n\n\nsce &lt;- logNormCounts(sce)\nsce\n\nclass: SingleCellExperiment \ndim: 18627 22274 \nmetadata(0):\nassays(2): counts logcounts\nrownames(18627): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(22274): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(20): Sample Barcode ... outlier_detected sizeFactor\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\nmgv &lt;- modelGeneVar(sce, block=sce$Sample)\nper_block &lt;- mgv$per.block\nmgv$mgv$per.block &lt;- NULL\nper_block\n\nDataFrame with 18627 rows and 12 columns\n                                donor1_fat\n                               &lt;DataFrame&gt;\n1        0.0000000:0.0000000:0.0000000:...\n2        0.0447544:0.0483622:0.0471062:...\n3        0.0299111:0.0420068:0.0315344:...\n4        0.0000000:0.0000000:0.0000000:...\n5        0.0000000:0.0000000:0.0000000:...\n...                                    ...\n18623 0.00527968:0.00440426:0.00557591:...\n18624 0.00000000:0.00000000:0.00000000:...\n18625 0.00000000:0.00000000:0.00000000:...\n18626 0.01379355:0.01574627:0.01456116:...\n18627 0.00000000:0.00000000:0.00000000:...\n                                  donor1_skin\n                                  &lt;DataFrame&gt;\n1     0.000192091:0.000140327:0.000210392:...\n2     0.030096853:0.034786115:0.032963547:...\n3     0.007230149:0.009100637:0.007918963:...\n4     0.000673060:0.000577614:0.000737182:...\n5     0.000000000:0.000000000:0.000000000:...\n...                                       ...\n18623 0.005793431:0.006536338:0.006345371:...\n18624 0.000655845:0.000823243:0.000718328:...\n18625 0.000000000:0.000000000:0.000000000:...\n18626 0.015571469:0.017150311:0.017054905:...\n18627 0.000000000:0.000000000:0.000000000:...\n                                   donor2_fat\n                                  &lt;DataFrame&gt;\n1     0.000257818:9.52261e-05:0.000231155:...\n2     0.030989651:2.27018e-02:0.027517226:...\n3     0.000541784:4.51619e-04:0.000485743:...\n4     0.001016535:7.51721e-04:0.000911335:...\n5     0.000000000:0.00000e+00:0.000000000:...\n...                                       ...\n18623  0.006846574:0.00432770:0.006130807:...\n18624  0.063328584:0.05779895:0.055368734:...\n18625  0.000000000:0.00000000:0.000000000:...\n18626  0.018603745:0.01511799:0.016598744:...\n18627  0.000612517:0.00105725:0.000549155:...\n                                   donor3_fat\n                                  &lt;DataFrame&gt;\n1     0.005251594:0.002826777:0.002720376:...\n2     0.058227092:0.025883220:0.030161476:...\n3     0.002911593:0.001252882:0.001508233:...\n4     0.000463204:0.000109945:0.000239944:...\n5     0.000768523:0.000603030:0.000398102:...\n...                                       ...\n18623  0.01701294:0.007165761:0.008812857:...\n18624  0.04656016:0.019818419:0.024118293:...\n18625  0.00047452:0.000119722:0.000245806:...\n18626  0.02401902:0.009052763:0.012442053:...\n18627  0.00000000:0.000000000:0.000000000:...\n                                  donor3_skin\n                                  &lt;DataFrame&gt;\n1     0.000000000:0.000000000:0.000000000:...\n2     0.077795605:0.048279909:0.058675308:...\n3     0.004722309:0.005066520:0.003738193:...\n4     0.000962391:0.000527005:0.000763779:...\n5     0.000000000:0.000000000:0.000000000:...\n...                                       ...\n18623    0.03084809:0.02389855:0.02399428:...\n18624    0.05316327:0.03602979:0.04074557:...\n18625    0.00000000:0.00000000:0.00000000:...\n18626    0.00585365:0.00409068:0.00463021:...\n18627    0.00000000:0.00000000:0.00000000:...\n                                  donor4_fat\n                                 &lt;DataFrame&gt;\n1     0.01069955:3.53034e-03:0.004835728:...\n2     0.09387548:4.16551e-02:0.042425119:...\n3     0.01530288:6.05392e-03:0.006916231:...\n4     0.00104185:9.55201e-05:0.000470872:...\n5     0.00000000:0.00000e+00:0.000000000:...\n...                                      ...\n18623    0.0202734:0.00534214:0.00916268:...\n18624    0.0624849:0.02416214:0.02823992:...\n18625    0.0000000:0.00000000:0.00000000:...\n18626    0.0377530:0.01659354:0.01706262:...\n18627    0.0000000:0.00000000:0.00000000:...\n                                  donor4_skin\n                                  &lt;DataFrame&gt;\n1     0.001684255:0.000984743:0.000795111:...\n2     0.099895592:0.041682785:0.047077413:...\n3     0.018399329:0.011478903:0.008685330:...\n4     0.002311079:0.000617455:0.001091023:...\n5     0.000486684:0.000148986:0.000229756:...\n...                                       ...\n18623  0.03531342:0.017654658:0.016666491:...\n18624  0.08061596:0.029509405:0.038012706:...\n18625  0.00000000:0.000000000:0.000000000:...\n18626  0.00619706:0.002728810:0.002925505:...\n18627  0.00156129:0.000797139:0.000737061:...\n                              donor5_recovery\n                                  &lt;DataFrame&gt;\n1     0.002386149:0.003595803:0.004200088:...\n2     0.036177813:0.066393947:0.063676351:...\n3     0.005542531:0.010860622:0.009755932:...\n4     0.000470654:0.000546747:0.000828443:...\n5     0.000000000:0.000000000:0.000000000:...\n...                                       ...\n18623    0.00385830:0.00629160:0.00679135:...\n18624    0.00000000:0.00000000:0.00000000:...\n18625    0.00000000:0.00000000:0.00000000:...\n18626    0.00218717:0.00460785:0.00384985:...\n18627    0.00000000:0.00000000:0.00000000:...\n                                donor6_fat                          donor6_skin\n                               &lt;DataFrame&gt;                          &lt;DataFrame&gt;\n1     0.00000000:0.00000000:0.00000000:... 0.00116394:0.00130381:0.00192853:...\n2     0.02855809:0.04743540:0.04610573:... 0.03484125:0.06236383:0.05771629:...\n3     0.00443248:0.00746152:0.00715685:... 0.00171647:0.00298939:0.00284401:...\n4     0.00105621:0.00222445:0.00170539:... 0.00000000:0.00000000:0.00000000:...\n5     0.00000000:0.00000000:0.00000000:... 0.00000000:0.00000000:0.00000000:...\n...                                    ...                                  ...\n18623  0.00672034:0.0142582:0.01085087:...  0.01009389:0.0186100:0.01672428:...\n18624  0.00000000:0.0000000:0.00000000:...  0.00000000:0.0000000:0.00000000:...\n18625  0.00000000:0.0000000:0.00000000:...  0.00000000:0.0000000:0.00000000:...\n18626  0.00103449:0.0021339:0.00167032:...  0.00490375:0.0084261:0.00812499:...\n18627  0.00000000:0.0000000:0.00000000:...  0.00000000:0.0000000:0.00000000:...\n                                  donor7_fat\n                                 &lt;DataFrame&gt;\n1       0.00162012:0.00274062:0.00245109:...\n2       0.03856859:0.06085669:0.05814055:...\n3       0.01021691:0.01666630:0.01544960:...\n4       0.00108433:0.00200704:0.00164052:...\n5       0.00000000:0.00000000:0.00000000:...\n...                                      ...\n18623 0.012511800:0.017865490:0.01891639:...\n18624 0.000000000:0.000000000:0.00000000:...\n18625 0.000000000:0.000000000:0.00000000:...\n18626 0.000761895:0.000990887:0.00115271:...\n18627 0.000000000:0.000000000:0.00000000:...\n                                  donor7_skin\n                                  &lt;DataFrame&gt;\n1     0.000377092:0.000412090:0.000554036:...\n2     0.029380808:0.047142481:0.043156883:...\n3     0.004676678:0.007048741:0.006871096:...\n4     0.002052253:0.002850248:0.003015239:...\n5     0.000457449:0.000606435:0.000672101:...\n...                                       ...\n18623    0.00951234:0.01478812:0.01397550:...\n18624    0.00000000:0.00000000:0.00000000:...\n18625    0.00000000:0.00000000:0.00000000:...\n18626    0.00246677:0.00309163:0.00362426:...\n18627    0.00000000:0.00000000:0.00000000:...\n\n\n\nmgv &lt;- mgv %&gt;% as.data.frame %&gt;% rownames_to_column(\"gene_name\") %&gt;% left_join(markers, multiple = \"first\")\nmgv\n\nJoining with `by = join_by(gene_name)`\n\n\n\nA data.frame: 18627 × 83\n\n\ngene_name\nmean\ntotal\ntech\nbio\np.value\nFDR\nper.block.donor1_fat.mean\nper.block.donor1_fat.total\nper.block.donor1_fat.tech\n⋯\nper.block.donor7_skin.mean\nper.block.donor7_skin.total\nper.block.donor7_skin.tech\nper.block.donor7_skin.bio\nper.block.donor7_skin.p.value\nper.block.donor7_skin.FDR\nsubpopulation\nsubpopshort\ndirection\nknown\n\n\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n⋯\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n\n\n\n\nENSG00000187634.SAMD11\n0.0019693835\n0.0013024782\n0.0014938755\n-1.913973e-04\n8.737032e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0003770917\n0.0004120903\n0.0005540363\n-1.419460e-04\n9.994747e-01\n1.000000e+00\nNA\nNA\nNA\nNA\n\n\nENSG00000188976.NOC2L\n0.0502634315\n0.0456286194\n0.0462268405\n-5.982211e-04\n5.299364e-01\n9.355400e-01\n0.044754353\n0.048362162\n0.047106190\n⋯\n0.0293808083\n0.0471424812\n0.0431568827\n3.985598e-03\n1.187842e-01\n5.326614e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000187961.KLHL17\n0.0088003534\n0.0100364902\n0.0085720454\n1.464445e-03\n1.356136e-02\n5.041921e-02\n0.029911128\n0.042006834\n0.031534370\n⋯\n0.0046766780\n0.0070487413\n0.0068710959\n1.776454e-04\n3.704551e-01\n7.408704e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000187583.PLEKHN1\n0.0009276301\n0.0008589782\n0.0009503105\n-9.133234e-05\n7.086989e-02\n2.073134e-01\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0020522533\n0.0028502483\n0.0030152388\n-1.649905e-04\n7.579746e-01\n8.954704e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000187642.PERM1\n0.0001427214\n0.0001132043\n0.0001083299\n4.874395e-06\n1.791375e-01\n4.312149e-01\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0004574494\n0.0006064354\n0.0006721007\n-6.566524e-05\n8.942605e-01\n9.949778e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000188290.HES4\n0.4317683304\n0.4744427877\n0.4318170816\n4.262571e-02\n1.769217e-02\n6.342516e-02\n0.579772219\n0.530487385\n0.524572804\n⋯\n0.5032418551\n0.7325884217\n0.6744572788\n5.813114e-02\n1.351696e-01\n5.618877e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000187608.ISG15\n0.1907224467\n0.2125479814\n0.1605618632\n5.198612e-02\n8.298437e-13\n1.131179e-11\n0.116807731\n0.111024323\n0.121563029\n⋯\n0.1162945309\n0.1917556701\n0.1700318967\n2.172377e-02\n5.113300e-02\n3.398987e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000188157.AGRN\n0.1114768158\n0.1148564437\n0.1092542055\n5.602238e-03\n1.795969e-01\n4.320410e-01\n0.138418928\n0.130595390\n0.143518295\n⋯\n0.1001736813\n0.1677008352\n0.1467709611\n2.092987e-02\n3.409516e-02\n2.628374e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000131591.C1orf159\n0.0313450869\n0.0341074411\n0.0326217764\n1.485665e-03\n1.950322e-01\n4.590749e-01\n0.014560216\n0.016643509\n0.015369731\n⋯\n0.0290359040\n0.0439328414\n0.0426504987\n1.282343e-03\n3.502968e-01\n7.360048e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000162571.TTLL10\n0.0008546147\n0.0005900526\n0.0005168317\n7.322091e-05\n1.540465e-10\n1.746455e-09\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0008199698\n0.0019484717\n0.0012047281\n7.437436e-04\n1.447307e-15\n1.961519e-13\nNA\nNA\nNA\nNA\n\n\nENSG00000186891.TNFRSF18\n0.0058911157\n0.0033663407\n0.0034570205\n-9.067979e-05\n1.715891e-07\n1.429371e-06\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0006670706\n0.0006459384\n0.0009800834\n-3.341450e-04\n9.999935e-01\n1.000000e+00\nNA\nNA\nNA\nNA\n\n\nENSG00000186827.TNFRSF4\n0.1043514102\n0.1025507891\n0.0915769314\n1.097386e-02\n4.067668e-02\n1.298149e-01\n0.118148494\n0.138295830\n0.122931497\n⋯\n0.0535097343\n0.0819809698\n0.0785558824\n3.425087e-03\n2.885551e-01\n7.098456e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000078808.SDF4\n0.2212428288\n0.1731091994\n0.1900223305\n-1.691313e-02\n9.752666e-01\n1.000000e+00\n0.125266097\n0.109117598\n0.130182344\n⋯\n0.1523546501\n0.2205261063\n0.2216055398\n-1.079434e-03\n5.248361e-01\n7.857325e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000176022.B3GALT6\n0.0331810618\n0.0290155465\n0.0298696351\n-8.540886e-04\n2.808728e-01\n6.080890e-01\n0.033773789\n0.043187394\n0.035592796\n⋯\n0.0172146779\n0.0291051117\n0.0252902950\n3.814817e-03\n2.685835e-02\n2.274809e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000184163.C1QTNF12\n0.0021494577\n0.0015139299\n0.0013974834\n1.164465e-04\n1.620399e-01\n3.997888e-01\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000160087.UBE2J2\n0.1039678327\n0.0900077789\n0.0929954030\n-2.987624e-03\n6.280412e-01\n1.000000e+00\n0.095448125\n0.074176088\n0.099676791\n⋯\n0.0682506326\n0.1080415891\n0.1001470086\n7.894581e-03\n1.566890e-01\n5.931810e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000162572.SCNN1D\n0.0039239679\n0.0045575486\n0.0040416201\n5.159285e-04\n4.918952e-08\n4.365540e-07\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0057684617\n0.0101547219\n0.0084751452\n1.679577e-03\n5.630535e-03\n7.276488e-02\nNA\nNA\nNA\nNA\n\n\nENSG00000131584.ACAP3\n0.0229812853\n0.0232988062\n0.0211932916\n2.105515e-03\n1.937648e-05\n1.234214e-04\n0.011195668\n0.019804193\n0.011820538\n⋯\n0.0194500131\n0.0379595830\n0.0285735981\n9.385985e-03\n1.328671e-05\n4.117809e-04\nNA\nNA\nNA\nNA\n\n\nENSG00000169972.PUSL1\n0.0148668264\n0.0123331169\n0.0130527191\n-7.196022e-04\n8.753588e-01\n1.000000e+00\n0.022273057\n0.021196167\n0.023497957\n⋯\n0.0099100098\n0.0157438677\n0.0145597274\n1.184140e-03\n1.491395e-01\n5.811430e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000127054.INTS11\n0.0863434745\n0.0693228612\n0.0735482434\n-4.225382e-03\n3.658966e-01\n7.358698e-01\n0.084655755\n0.072026480\n0.088577214\n⋯\n0.0394623773\n0.0632514002\n0.0579543345\n5.297066e-03\n1.212164e-01\n5.363840e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000224051.CPTP\n0.0437399735\n0.0345153310\n0.0355729713\n-1.057640e-03\n2.192897e-01\n5.029921e-01\n0.028106629\n0.021103972\n0.029637060\n⋯\n0.0200511600\n0.0345908846\n0.0294565347\n5.134350e-03\n1.290151e-02\n1.357971e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000169962.TAS1R3\n0.0004052785\n0.0005136642\n0.0004490183\n6.464582e-05\n6.063849e-10\n6.566403e-09\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000107404.DVL1\n0.0546596741\n0.0559125190\n0.0546148119\n1.297707e-03\n1.169168e-01\n3.097954e-01\n0.051992919\n0.051285625\n0.054674802\n⋯\n0.0494111753\n0.0774444246\n0.0725473686\n4.897056e-03\n1.939918e-01\n6.394011e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000162576.MXRA8\n0.0733304526\n0.0816338793\n0.0424210381\n3.921284e-02\n8.369574e-10\n8.943419e-09\n0.041612054\n0.048939431\n0.043815198\n⋯\n0.0070240558\n0.0104407885\n0.0103198435\n1.209450e-04\n4.404284e-01\n7.639509e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000175756.AURKAIP1\n0.2877332314\n0.2267634099\n0.2455746749\n-1.881126e-02\n9.404859e-01\n1.000000e+00\n0.358315318\n0.322001177\n0.351057560\n⋯\n0.1725839830\n0.2569559693\n0.2502336724\n6.722297e-03\n3.655864e-01\n7.396080e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000221978.CCNL2\n0.1554273129\n0.1607440768\n0.1474084468\n1.333563e-02\n5.406649e-02\n1.654175e-01\n0.143807887\n0.203728633\n0.148957683\n⋯\n0.1123157102\n0.1831533488\n0.1643020608\n1.885129e-02\n7.113931e-02\n4.110676e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000242485.MRPL20\n0.4041161319\n0.3611990674\n0.3758276205\n-1.462855e-02\n9.394156e-01\n1.000000e+00\n0.435379963\n0.374452458\n0.415710684\n⋯\n0.3693702802\n0.5208705603\n0.5140860481\n6.784512e-03\n4.329849e-01\n7.621041e-01\nNA\nNA\nNA\nNA\n\n\nENSG00000235098.ANKRD65\n0.0075721639\n0.0037111374\n0.0045934832\n-8.823459e-04\n7.679673e-01\n1.000000e+00\n0.005096231\n0.004103508\n0.005382204\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000205116.TMEM88B\n0.0003453538\n0.0001663211\n0.0002435159\n-7.719476e-05\n9.989500e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0002774246\n0.0002230429\n0.0004076020\n-1.845591e-04\n1.000000e+00\n1.000000e+00\nNA\nNA\nNA\nNA\n\n\nENSG00000179403.VWA1\n0.0201312569\n0.0184182043\n0.0144274781\n3.990726e-03\n9.560126e-06\n6.380166e-05\n0.011154903\n0.007099697\n0.011777524\n⋯\n0.0078463236\n0.0130163670\n0.0115278913\n1.488476e-03\n4.933709e-02\n3.325438e-01\nNA\nNA\nNA\nNA\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋱\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\nENSG00000182484.WASH6P\n1.060511e-01\n1.051630e-01\n1.012401e-01\n3.922887e-03\n5.385302e-02\n1.649027e-01\n0.089568204\n0.108006196\n0.093636322\n⋯\n0.0983430607\n0.1563313631\n0.1441048272\n1.222654e-02\n1.389424e-01\n0.567558120\nNA\nNA\nNA\nNA\n\n\nENSG00000129824.RPS4Y1\n2.235694e-01\n2.838755e-01\n2.897254e-01\n-5.849912e-03\n1.472026e-03\n6.816781e-03\n0.002959566\n0.001383926\n0.003125851\n⋯\n0.0170548138\n0.0324826172\n0.0250554751\n7.427142e-03\n7.501188e-05\n0.001922062\nNA\nNA\nNA\nNA\n\n\nENSG00000067646.ZFY\n3.808236e-02\n4.753073e-02\n4.488257e-02\n2.648161e-03\n5.600530e-03\n2.288586e-02\n0.062956984\n0.069570622\n0.066102981\n⋯\n0.0111761192\n0.0168789885\n0.0164197643\n4.592242e-04\n3.602910e-01\n0.738736203\nNA\nNA\nNA\nNA\n\n\nENSG00000099715.PCDH11Y\n8.276551e-03\n1.038031e-02\n8.746170e-03\n1.634137e-03\n2.348474e-03\n1.046374e-02\n0.018789257\n0.035260608\n0.019828012\n⋯\n0.0056077484\n0.0089139084\n0.0082390261\n6.748823e-04\n1.474144e-01\n0.578190854\nNA\nNA\nNA\nNA\n\n\nENSG00000099721.AMELY\n3.799039e-04\n3.942317e-04\n3.744746e-04\n1.975718e-05\n2.299880e-04\n1.239469e-03\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000092377.TBL1Y\n6.918795e-04\n7.768121e-04\n8.532257e-04\n-7.641360e-05\n4.001967e-01\n7.810283e-01\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0009483741\n0.0013166584\n0.0013933841\n-7.672566e-05\n7.593519e-01\n0.896580882\nNA\nNA\nNA\nNA\n\n\nENSG00000114374.USP9Y\n3.812034e-02\n6.343246e-02\n6.151179e-02\n1.920676e-03\n8.991925e-01\n1.000000e+00\n0.004961967\n0.003890137\n0.005240431\n⋯\n0.0014691287\n0.0021249447\n0.0021584939\n-3.354920e-05\n5.787820e-01\n0.804795343\nNA\nNA\nNA\nNA\n\n\nENSG00000067048.DDX3Y\n9.987608e-02\n1.538440e-01\n1.521439e-01\n1.700035e-03\n3.401029e-04\n1.767338e-03\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0067399916\n0.0129023438\n0.0099025033\n2.999841e-03\n5.346960e-05\n0.001428091\nNA\nNA\nNA\nNA\n\n\nENSG00000183878.UTY\n6.276576e-02\n1.035719e-01\n9.944009e-02\n4.131834e-03\n2.371132e-05\n1.491927e-04\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0037955497\n0.0055075356\n0.0055765314\n-6.899581e-05\n5.628633e-01\n0.797561478\nNA\nNA\nNA\nNA\n\n\nENSG00000154620.TMSB4Y\n3.161534e-03\n5.812091e-03\n5.249932e-03\n5.621585e-04\n3.716597e-03\n1.584561e-02\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000165246.NLGN4Y\n2.889787e-02\n4.648592e-02\n4.439543e-02\n2.090492e-03\n2.261591e-05\n1.426383e-04\n0.007101396\n0.007967912\n0.007499287\n⋯\n0.0059726097\n0.0094529158\n0.0087750778\n6.778379e-04\n1.616008e-01\n0.599288583\nNA\nNA\nNA\nNA\n\n\nENSG00000172468.HSFY1\n1.774793e-04\n1.349566e-04\n1.911604e-04\n-5.620376e-05\n9.754492e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0002446283\n0.0001734250\n0.0003594165\n-1.859914e-04\n1.000000e+00\n1.000000000\nNA\nNA\nNA\nNA\n\n\nENSG00000169953.HSFY2\n2.195080e-04\n2.132608e-04\n2.215071e-04\n-8.246239e-06\n6.838196e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0002892259\n0.0002424224\n0.0004249408\n-1.825184e-04\n1.000000e+00\n1.000000000\nNA\nNA\nNA\nNA\n\n\nENSG00000012817.KDM5D\n1.168414e-02\n2.019782e-02\n1.928814e-02\n9.096875e-04\n2.116818e-03\n9.515955e-03\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000198692.EIF1AY\n4.603123e-02\n7.533155e-02\n7.455884e-02\n7.727028e-04\n9.981512e-02\n2.736453e-01\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0009624456\n0.0009776989\n0.0014140584\n-4.363595e-04\n9.999604e-01\n1.000000000\nNA\nNA\nNA\nNA\n\n\nENSG00000280969.RPS4Y2\n3.188270e-05\n2.432296e-05\n5.147908e-05\n-2.715612e-05\n1.000000e+00\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000169807.PRY2\n6.112707e-05\n5.399550e-05\n8.281698e-05\n-2.882148e-05\n8.976356e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000187191.DAZ3\n2.244223e-05\n1.703156e-05\n2.012135e-05\n-3.089796e-06\n8.264456e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000205916.DAZ4\n1.205705e-04\n2.539327e-04\n1.831278e-04\n7.080490e-05\n7.884693e-07\n6.082992e-06\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000278704.ENSG00000278704\n6.738617e-03\n7.672991e-03\n7.311764e-03\n3.612269e-04\n3.103076e-01\n6.540698e-01\n0.007461762\n0.008797108\n0.007879719\n⋯\n0.0070398383\n0.0101438386\n0.0103430307\n-1.991921e-04\n5.972746e-01\n0.811804880\nNA\nNA\nNA\nNA\n\n\nENSG00000277400.ENSG00000277400\n3.346039e-03\n3.604205e-03\n3.321011e-03\n2.831942e-04\n6.867569e-01\n1.000000e+00\n0.009749444\n0.015018162\n0.010294400\n⋯\n0.0003640715\n0.0003841243\n0.0005349066\n-1.507823e-04\n9.998439e-01\n1.000000000\nNA\nNA\nNA\nNA\n\n\nENSG00000274847.MAFIP\n2.747836e-02\n3.523302e-02\n3.322526e-02\n2.007761e-03\n1.097189e-01\n2.950113e-01\n0.045624753\n0.054548175\n0.048017210\n⋯\n0.0266886287\n0.0400806811\n0.0392040406\n8.766406e-04\n3.874484e-01\n0.746886890\nNA\nNA\nNA\nNA\n\n\nENSG00000276256.ENSG00000276256\n1.456334e-01\n1.587725e-01\n1.663422e-01\n-7.569715e-03\n9.946371e-01\n1.000000e+00\n0.022176195\n0.016113771\n0.023395954\n⋯\n0.2252880825\n0.3118314572\n0.3236612085\n-1.182975e-02\n6.799064e-01\n0.849895931\nNA\nNA\nNA\nNA\n\n\nENSG00000278384.ENSG00000278384\n8.811104e-03\n1.040108e-02\n1.052278e-02\n-1.217001e-04\n5.977625e-01\n9.991189e-01\n0.003029215\n0.001449831\n0.003199408\n⋯\n0.0087212489\n0.0138309448\n0.0128132871\n1.017658e-03\n1.548784e-01\n0.590868757\nNA\nNA\nNA\nNA\n\n\nENSG00000273748.ENSG00000273748\n8.629686e-02\n9.038450e-02\n8.604669e-02\n4.337806e-03\n4.265947e-01\n8.149871e-01\n0.068696288\n0.080482907\n0.072066698\n⋯\n0.0876646108\n0.1369676261\n0.1285271979\n8.440428e-03\n2.004931e-01\n0.646712417\nNA\nNA\nNA\nNA\n\n\nENSG00000271254.ENSG00000271254\n1.367201e-02\n1.176190e-02\n1.199557e-02\n-2.336686e-04\n1.048407e-01\n2.843984e-01\n0.005279681\n0.004404255\n0.005575911\n⋯\n0.0095123359\n0.0147881250\n0.0139754977\n8.126273e-04\n2.285474e-01\n0.674288547\nNA\nNA\nNA\nNA\n\n\nENSG00000276345.ENSG00000276345\n2.556739e-02\n1.401183e-02\n1.560030e-02\n-1.588466e-03\n8.243541e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000276017.ENSG00000276017\n3.954335e-05\n9.976801e-06\n2.048383e-05\n-1.050703e-05\n9.858771e-01\n1.000000e+00\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\nENSG00000278817.ENSG00000278817\n1.109546e-02\n8.310894e-03\n8.641444e-03\n-3.305493e-04\n7.548021e-03\n2.987236e-02\n0.013793552\n0.015746266\n0.014561158\n⋯\n0.0024667705\n0.0030916251\n0.0036242592\n-5.326341e-04\n9.699135e-01\n1.000000000\nNA\nNA\nNA\nNA\n\n\nENSG00000277196.ENSG00000277196\n1.811506e-04\n1.545324e-04\n1.071847e-04\n4.734772e-05\n5.457040e-08\n4.813223e-07\n0.000000000\n0.000000000\n0.000000000\n⋯\n0.0000000000\n0.0000000000\n0.0000000000\n0.000000e+00\nNaN\nNaN\nNA\nNA\nNA\nNA\n\n\n\n\n\n\noptions(repr.plot.width=10, repr.plot.height=10)\n\nggplot(mgv, aes(x=mean, y=bio, colour=subpopshort)) +\n    geom_point(size=5)\n\nggplot(mgv, aes(x=subpopshort, y=bio, colour=subpopshort)) +\n    geom_boxplot() +\n    theme(axis.text.x = element_text(angle = 45, hjust=1))\n\n\n\n\n\n\n\n\nnm &lt;- names(per_block)\nnames(nm) &lt;- nm\nnm\n\ndonor1_fat'donor1_fat'donor1_skin'donor1_skin'donor2_fat'donor2_fat'donor3_fat'donor3_fat'donor3_skin'donor3_skin'donor4_fat'donor4_fat'donor4_skin'donor4_skin'donor5_recovery'donor5_recovery'donor6_fat'donor6_fat'donor6_skin'donor6_skin'donor7_fat'donor7_fat'donor7_skin'donor7_skin'\n\n\n\noptions(repr.plot.width=6, repr.plot.height=6)\n\nper_block_ggs &lt;- lapply(nm, function(u) {\n    z &lt;- per_block[[u]] %&gt;% as.data.frame %&gt;% rownames_to_column(\"gene_name\") %&gt;%\n        left_join(markers, multiple = \"first\")\n    p &lt;- ggplot(z, aes(x=subpopshort, y=-log10(FDR), colour=subpopshort)) +\n        geom_boxplot() +\n        theme(axis.text.x = element_text(angle = 45, hjust=1)) +\n        ggtitle(u)\n        print(p)\n})\n\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 5932 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 1984 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 2469 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 1555 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 3137 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 3732 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 2029 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 1699 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 2766 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 3088 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 2705 rows containing non-finite values (`stat_boxplot()`).”\nJoining with `by = join_by(gene_name)`\nWarning message:\n“Removed 2229 rows containing non-finite values (`stat_boxplot()`).”\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\nggarrange(plotlist = per_block_ggs, nrow = 3, ncol = 4)\n\nWarning message:\n“Removed 5932 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 1984 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 2469 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 1555 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 3137 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 3732 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 2029 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 1699 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 2766 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 3088 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 2705 rows containing non-finite values (`stat_boxplot()`).”\nWarning message:\n“Removed 2229 rows containing non-finite values (`stat_boxplot()`).”\n\n\n\n\n\n\nuniq_markers &lt;- unique(markers$gene_name)\nuniq_markers\n\n\n'ENSG00000117707.PROX1''ENSG00000162493.PDPN''ENSG00000133800.LYVE1''ENSG00000137077.CCL21''ENSG00000189056.RELN''ENSG00000129048.ACKR4''ENSG00000108691.CCL2''ENSG00000081041.CXCL2''ENSG00000013297.CLDN11''ENSG00000272398.CD24''ENSG00000149564.ESAM''ENSG00000170017.ALCAM''ENSG00000108821.COL1A1''ENSG00000113721.PDGFRB''ENSG00000107796.ACTA2''ENSG00000186081.KRT5''ENSG00000186847.KRT14''ENSG00000081237.PTPRC''ENSG00000102755.FLT1''ENSG00000154721.JAM2''ENSG00000090339.ICAM1''ENSG00000103335.PIEZO1''ENSG00000154864.PIEZO2'\n\n\n\nper_block_umaps &lt;- lapply(nm, function(u) {\n    s &lt;- sce[,sce$Sample==u]\n    mgv &lt;- modelGeneVar(s)\n    hvgs &lt;- mgv %&gt;% as.data.frame %&gt;% rownames_to_column(\"gene_name\") %&gt;%\n        arrange(p.value) %&gt;% head(500) %&gt;% pull(\"gene_name\")\n    s &lt;- runPCA(s, subset_row=hvgs)\n    s &lt;- runUMAP(s)\n    exp &lt;- as.matrix(logcounts(s)[uniq_markers,])\n    data.frame(\n        rowname = rownames(colData(s)), Sample = s$Sample,\n        UMAP = reducedDim(s, \"UMAP\"), t(exp)\n    ) %&gt;% return()\n})\n\nWarning message in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth = TRUE, :\n“You're computing too large a percentage of total singular values, use a standard svd instead.”\n\n\n\npdf(\"figures/umaps-markers-across-samples.pdf\", width=10, height=8)\nfor(i in seq_len(length(uniq_markers))) {\n\n  m &lt;- markers %&gt;% dplyr::filter(gene_name==uniq_markers[i]) %&gt;% pull(\"subpopulation\")\n\n    print(ggplot(bind_rows(per_block_umaps), aes_string(x=\"UMAP.1\", y=\"UMAP.2\", colour = uniq_markers[i])) +\n        geom_point() +\n        scale_colour_gradient(low = \"grey80\", high = \"blue\") +\n        facet_wrap(~Sample, scales = \"free\") +\n        theme(legend.position=\"top\") +\n        ggtitle(m)\n    )\n\n}\ndev.off()\n\nWarning message:\n“`aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.”\n\n\npdf: 2\n\n\n\nms &lt;- bind_rows(per_block_umaps) %&gt;% melt(id.vars = c(\"rowname\", \"Sample\", \"UMAP.1\", \"UMAP.2\")) %&gt;% split(\"Sample\")\nms\n\n$Sample = \n\nA data.frame: 512302 × 6\n\n\n\nrowname\nSample\nUMAP.1\nUMAP.2\nvariable\nvalue\n\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;fct&gt;\n&lt;dbl&gt;\n\n\n\n\n1\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\n-2.0484646\n-1.1637262\nENSG00000117707.PROX1\n1.1180317\n\n\n2\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\n2.8242526\n-1.0391492\nENSG00000117707.PROX1\n0.0000000\n\n\n3\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\n0.9381566\n0.6268698\nENSG00000117707.PROX1\n1.0517659\n\n\n4\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\n-0.6080225\n-0.6364202\nENSG00000117707.PROX1\n0.0000000\n\n\n5\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\n-1.0524757\n-1.6120028\nENSG00000117707.PROX1\n0.0000000\n\n\n6\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\n1.5718066\n0.7489513\nENSG00000117707.PROX1\n2.0521759\n\n\n7\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\n1.7909548\n0.8797356\nENSG00000117707.PROX1\n1.7869727\n\n\n8\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\n-1.0558064\n1.0522912\nENSG00000117707.PROX1\n2.0656439\n\n\n9\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\n-1.0539844\n-0.7540492\nENSG00000117707.PROX1\n0.8052045\n\n\n10\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\n-1.3530891\n-1.1469282\nENSG00000117707.PROX1\n2.2499633\n\n\n11\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\n1.8577221\n0.7200912\nENSG00000117707.PROX1\n0.7807234\n\n\n12\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\n1.6504609\n-0.9285525\nENSG00000117707.PROX1\n0.0000000\n\n\n13\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\n-0.6354316\n1.3237580\nENSG00000117707.PROX1\n1.6079082\n\n\n14\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\n-0.1048098\n0.9759096\nENSG00000117707.PROX1\n2.5479505\n\n\n15\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\n2.0356176\n-0.3929195\nENSG00000117707.PROX1\n0.0000000\n\n\n16\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\n0.4631455\n1.2451497\nENSG00000117707.PROX1\n0.0000000\n\n\n17\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\n0.8288960\n-0.8372497\nENSG00000117707.PROX1\n0.9320313\n\n\n18\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\n2.0905075\n0.3380302\nENSG00000117707.PROX1\n0.0000000\n\n\n19\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\n-3.9451654\n0.2357324\nENSG00000117707.PROX1\n2.1732948\n\n\n20\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\n2.7871909\n0.2391406\nENSG00000117707.PROX1\n0.0000000\n\n\n21\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\n-3.5143168\n0.4605635\nENSG00000117707.PROX1\n0.0000000\n\n\n22\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\n-0.4711578\n-0.9177226\nENSG00000117707.PROX1\n0.0000000\n\n\n23\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\n-4.0332029\n0.4111551\nENSG00000117707.PROX1\n2.6920234\n\n\n24\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\n2.8228720\n-1.0549392\nENSG00000117707.PROX1\n0.0000000\n\n\n25\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\n-0.2053631\n0.8217293\nENSG00000117707.PROX1\n1.4683445\n\n\n26\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\n2.1387318\n-0.4795322\nENSG00000117707.PROX1\n0.0000000\n\n\n27\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\n-0.9772060\n-1.4272784\nENSG00000117707.PROX1\n0.9130940\n\n\n28\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat\n-1.1057518\n-1.5379166\nENSG00000117707.PROX1\n2.6862529\n\n\n29\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat\n0.3803560\n0.7960730\nENSG00000117707.PROX1\n1.5156637\n\n\n30\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat\n-0.5325592\n-1.5191154\nENSG00000117707.PROX1\n0.0000000\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\n512273\ndonor7_skin.TTTATGCTCGTGTCAA-1\ndonor7_skin\n0.44066022\n-2.3981223\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512274\ndonor7_skin.TTTCACAAGCGATGGT-1\ndonor7_skin\n-2.32789935\n0.5459931\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512275\ndonor7_skin.TTTCACAGTTGTAGCT-1\ndonor7_skin\n-0.63556482\n-1.3933723\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512276\ndonor7_skin.TTTCAGTTCAATCGGT-1\ndonor7_skin\n-0.62373890\n-1.2646084\nENSG00000154864.PIEZO2\n0.7371799\n\n\n512277\ndonor7_skin.TTTCATGGTACAGTCT-1\ndonor7_skin\n1.56131671\n2.2107785\nENSG00000154864.PIEZO2\n1.0879936\n\n\n512278\ndonor7_skin.TTTCATGGTGGCTGCT-1\ndonor7_skin\n1.27958320\n1.3705374\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512279\ndonor7_skin.TTTCATGTCCTTATGT-1\ndonor7_skin\n1.51498244\n-2.0856054\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512280\ndonor7_skin.TTTCCTCAGCGGACAT-1\ndonor7_skin\n-1.95951611\n0.0865000\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512281\ndonor7_skin.TTTCCTCCACTCTAGA-1\ndonor7_skin\n3.84445618\n0.9458799\nENSG00000154864.PIEZO2\n1.4716415\n\n\n512282\ndonor7_skin.TTTCCTCGTACAAAGT-1\ndonor7_skin\n-1.86466755\n0.1249833\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512283\ndonor7_skin.TTTCCTCGTAGCGCTC-1\ndonor7_skin\n0.96789597\n-1.2941531\nENSG00000154864.PIEZO2\n1.0866399\n\n\n512284\ndonor7_skin.TTTCCTCGTGGCCCAT-1\ndonor7_skin\n-1.77742146\n1.0157657\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512285\ndonor7_skin.TTTCGATAGTGTCATC-1\ndonor7_skin\n1.08103965\n-0.5591272\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512286\ndonor7_skin.TTTCGATCAAGAAATC-1\ndonor7_skin\n-2.02880452\n-4.1955617\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512287\ndonor7_skin.TTTCGATTCTGCCCTA-1\ndonor7_skin\n-2.95822276\n-1.6004554\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512288\ndonor7_skin.TTTGACTCACCCTTAC-1\ndonor7_skin\n-1.19297369\n0.3856518\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512289\ndonor7_skin.TTTGACTCAGTAACGG-1\ndonor7_skin\n-2.75150790\n-0.7835479\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512290\ndonor7_skin.TTTGACTGTTCTGACA-1\ndonor7_skin\n-1.31828757\n-0.2367129\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512291\ndonor7_skin.TTTGATCCACATATGC-1\ndonor7_skin\n0.71390794\n2.2297013\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512292\ndonor7_skin.TTTGATCCACTAGAGG-1\ndonor7_skin\n-1.83226659\n0.5647108\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512293\ndonor7_skin.TTTGATCGTCCCAAAT-1\ndonor7_skin\n0.01913915\n2.3483524\nENSG00000154864.PIEZO2\n2.3022276\n\n\n512294\ndonor7_skin.TTTGATCGTTCTCCAC-1\ndonor7_skin\n0.83273528\n2.6859512\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512295\ndonor7_skin.TTTGATCTCTGTCTCG-1\ndonor7_skin\n-1.36970748\n-0.4502688\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512296\ndonor7_skin.TTTGGAGAGCAAACAT-1\ndonor7_skin\n2.42198656\n0.8811707\nENSG00000154864.PIEZO2\n1.7446003\n\n\n512297\ndonor7_skin.TTTGGAGAGTACTCGT-1\ndonor7_skin\n-0.99745222\n2.7946794\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512298\ndonor7_skin.TTTGGAGGTACGTGTT-1\ndonor7_skin\n-0.40469517\n3.2030871\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512299\ndonor7_skin.TTTGGAGTCCATTTGT-1\ndonor7_skin\n-2.61639698\n-1.3488972\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512300\ndonor7_skin.TTTGGAGTCTTACCGC-1\ndonor7_skin\n0.74898480\n2.0100686\nENSG00000154864.PIEZO2\n1.3394578\n\n\n512301\ndonor7_skin.TTTGGTTGTTGTAGCT-1\ndonor7_skin\n0.60430000\n2.4989591\nENSG00000154864.PIEZO2\n0.0000000\n\n\n512302\ndonor7_skin.TTTGTTGCAACTGTGT-1\ndonor7_skin\n-0.57576229\n-1.1000320\nENSG00000154864.PIEZO2\n2.3025932\n\n\n\n\n\n\npdf(\"figures/umaps-all-markers-each-sample.pdf\", width=10, height=8)\nfor(i in seq_len(length(ms))) {\n\n    print(\n        ggplot(ms[[i]], aes(x=UMAP.1, y=UMAP.2, colour = value)) +\n        geom_point() +\n        scale_colour_gradient(low = \"grey80\", high = \"blue\") +\n        facet_wrap(~variable) +\n        theme(legend.position=\"top\") +\n        ggtitle(names(ms)[i])\n        )\n\n}\ndev.off()\n\npdf: 2\n\n\n\nd &lt;- bind_rows(per_block_umaps)\nd_rnormd &lt;- d[,-c(1:4)] + rnorm(prod(dim(d)), mean = 0, sd = .001)\nds &lt;- split(d_rnormd, d$Sample)\n\n\npdf(\"figures/heatmaps-all-markers-each-sample.pdf\", width=10, height=5)\nfor(i in seq_len(length(ds))) {\n    pheatmap(t(ds[[i]]), show_colnames = FALSE,\n    clustering_distance_cols = \"correlation\",\n    clustering_distance_rows = \"correlation\",\n    main = names(ds)[i]\n    )\n\n}\ndev.off()\n\npdf: 3\n\n\n\nds_norm &lt;- ds\npdf(\"figures/heatmaps-all-markers-each-sample-normalized.pdf\", width=10, height=5)\nfor(i in seq_len(length(ds))) {\n  \n  qs &lt;- apply(ds[[i]], 2, quantile, p=.90)\n  qs[qs &lt; 1] &lt;- 1\n  \n  for(j in 1:ncol(ds[[i]]))\n    ds_norm[[i]][,j] &lt;- ds_norm[[i]][,j]/qs[j]\n\n  ds_norm[[i]][ds_norm[[i]]&gt;1] &lt;- 1\n\n  \n  pheatmap(t(ds_norm[[i]]), show_colnames = FALSE,\n           clustering_distance_cols = \"correlation\",\n           clustering_distance_rows = \"correlation\",\n           main = names(ds)[i]\n           )\n\n}\ndev.off()\n\npdf: 3\n\n\n\n# contaminants\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(d, aes(\n    x = ENSG00000137077.CCL21,\n    y = ENSG00000108821.COL1A1)\n) + \ngeom_jitter(width=.1, height = .5) +\nfacet_wrap(~Sample)\n\n\n\n\n\noptions(repr.plot.width=12, repr.plot.height=6)\nboxplot(as.data.frame(d[,-(1:4)]), las=2)\n\n\n\n\n\nexp &lt;- d[,-(1:4)] %&gt;% as.matrix\np90 &lt;- exp %&gt;% apply(2, quantile, probs=.9)\np90\n\nENSG00000117707.PROX12.7040474964207ENSG00000162493.PDPN1.69283581132588ENSG00000133800.LYVE13.26185058645611ENSG00000137077.CCL217.22691459652125ENSG00000189056.RELN2.24996327230414ENSG00000129048.ACKR40ENSG00000108691.CCL23.71939503454669ENSG00000081041.CXCL22.89062607918324ENSG00000013297.CLDN110ENSG00000272398.CD240ENSG00000149564.ESAM0.355130098838991ENSG00000170017.ALCAM0ENSG00000108821.COL1A10ENSG00000113721.PDGFRB0ENSG00000107796.ACTA20ENSG00000186081.KRT50ENSG00000186847.KRT140ENSG00000081237.PTPRC0ENSG00000102755.FLT10ENSG00000154721.JAM20ENSG00000090339.ICAM11.88047655359566ENSG00000103335.PIEZO11.28664026201016ENSG00000154864.PIEZO21.73042322902796\n\n\n\ncol1a1 &lt;- exp[,\"ENSG00000108821.COL1A1\"] / 2\ncol1a1[col1a1 &gt; 1] &lt;- 1\n\njam2 &lt;- exp[,\"ENSG00000154721.JAM2\"] / 2\njam2[jam2 &gt; 1] &lt;- 1\n\nprgfrb &lt;- exp[,\"ENSG00000113721.PDGFRB\"] / 2\nprgfrb[prgfrb &gt; 1] &lt;- 1\n\n      \npdpn &lt;- exp[,\"ENSG00000162493.PDPN\"] / p90[\"ENSG00000162493.PDPN\"]\npdpn[pdpn &gt; 1] &lt;- 1\n\ncxcl2 &lt;- exp[,\"ENSG00000081041.CXCL2\"] / p90[\"ENSG00000081041.CXCL2\"]\ncxcl2[cxcl2 &gt; 1] &lt;- 1\n             \nccl2 &lt;- exp[,\"ENSG00000108691.CCL2\"] / p90[\"ENSG00000108691.CCL2\"]\nccl2[ccl2 &gt; 1] &lt;- 1\n\nccl21 &lt;- exp[,\"ENSG00000137077.CCL21\"] / p90[\"ENSG00000137077.CCL21\"]\nccl21[ccl21 &gt; 1] &lt;- 1\n\nlyve1 &lt;- exp[,\"ENSG00000133800.LYVE1\"] / p90[\"ENSG00000133800.LYVE1\"]\nlyve1[lyve1 &gt; 1] &lt;- 1\n\nprox1 &lt;- exp[,\"ENSG00000117707.PROX1\"] / p90[\"ENSG00000117707.PROX1\"]\nprox1[prox1 &gt; 1] &lt;- 1\n\ndf &lt;- data.frame(\n    Sample=d$Sample, \n    col1a1, jam2, prgfrb, ccl21, lyve1,\n    prox1, pdpn, ccl2, cxcl2\n)\n\n# noise? before filtering?\ndf[,-1] &lt;- df[,-1] + rnorm(\n    nrow(df)*(ncol(df)-1),\n    mean=0, sd=.02\n)\n\ndf\n\n\nA data.frame: 22274 × 10\n\n\n\nSample\ncol1a1\njam2\nprgfrb\nccl21\nlyve1\nprox1\npdpn\nccl2\ncxcl2\n\n\n\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\n-6.177371e-03\n-0.0031744491\n0.025607984\n0.8637877\n0.506185147\n0.399910959\n-2.141122e-02\n-0.0147191045\n-0.0092179474\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\n-2.562640e-02\n0.0135274094\n0.016411063\n0.6995753\n-0.030954370\n-0.020318782\n1.272878e-02\n0.0321146768\n-0.0155214929\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\n3.954838e-03\n-0.0047302147\n-0.058921807\n1.0064774\n0.009121395\n0.403507005\n9.707439e-01\n0.0009019757\n-0.0097793427\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\n-8.390417e-04\n-0.0049775072\n0.004997854\n0.9798234\n0.630962393\n-0.022863151\n3.719339e-01\n0.6664521861\n0.0467031244\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\n-3.294729e-02\n0.0172184506\n0.025801842\n1.0099529\n0.952636547\n0.016039127\n3.159890e-02\n-0.0161948350\n0.0093164554\n\n\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\n-9.278279e-03\n-0.0432904238\n-0.004928558\n0.6361269\n0.021998822\n0.764609556\n7.688593e-03\n0.4987814014\n0.2286961444\n\n\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\n8.961247e-03\n0.0257253419\n-0.007706475\n0.5688781\n0.011359943\n0.668748819\n-9.337751e-04\n-0.0031576763\n-0.0033508996\n\n\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\n-2.025285e-02\n-0.0427843370\n0.043382435\n0.7318062\n0.612130896\n0.729646983\n4.289729e-03\n1.0105701492\n0.5701520444\n\n\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\n-1.957310e-02\n-0.0155224185\n-0.014063269\n0.7817754\n0.948710864\n0.299500667\n7.823209e-01\n-0.0224818197\n-0.0198374980\n\n\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\n5.040912e-03\n-0.0047053116\n-0.001473258\n0.6704721\n0.547458265\n0.829585304\n-8.579479e-05\n-0.0042205833\n-0.0122900824\n\n\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\n-2.382496e-02\n0.0412669633\n-0.004748681\n0.7122134\n-0.008654046\n0.306771378\n4.814842e-01\n0.3609760289\n0.5507497536\n\n\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\n-2.887057e-02\n-0.0007119733\n-0.011167208\n0.2209485\n-0.004722751\n-0.006377754\n1.007664e-02\n-0.0018593270\n0.9934970903\n\n\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\n7.492564e-03\n0.0063471223\n0.009616054\n0.7539768\n0.873148301\n0.580555478\n5.203047e-01\n0.3668938136\n-0.0005466140\n\n\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\n2.690249e-02\n-0.0020851500\n0.010444795\n0.7800630\n0.400894972\n0.965109975\n-1.875359e-02\n0.6930383825\n-0.0011001914\n\n\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\n-2.288523e-02\n0.0277930016\n-0.001592410\n1.0105555\n0.331541713\n-0.017978599\n2.130233e-02\n0.9701081869\n0.6099380962\n\n\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\n1.469623e-02\n0.0315918627\n-0.030168437\n0.7318597\n0.807769612\n0.013928482\n2.950614e-02\n0.8370519554\n0.0040403227\n\n\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\n-2.389362e-02\n-0.0308304543\n0.003702698\n0.9223370\n0.451392924\n0.348397754\n1.515303e-02\n1.0203946074\n0.6950916051\n\n\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\n-5.153461e-05\n-0.0112837207\n-0.016008569\n1.0031394\n-0.006312337\n-0.006464281\n3.518851e-03\n1.0086026451\n-0.0328234172\n\n\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\n-4.068141e-02\n-0.0195332344\n-0.013722141\n0.7616221\n0.903429875\n0.811012906\n-2.210629e-02\n0.0126439890\n-0.0003801494\n\n\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\n1.864060e-02\n0.0445714489\n0.006365741\n0.8880584\n0.704812734\n-0.033339004\n1.545340e-03\n0.5677575058\n-0.0066729671\n\n\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\n-2.603773e-02\n0.0030491045\n0.006140261\n0.9205795\n0.967926311\n0.041954248\n1.651663e-02\n-0.0126926382\n0.0182637707\n\n\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\n-1.347052e-02\n-0.0266749866\n-0.005039600\n0.8886155\n-0.016309032\n0.003981775\n4.496706e-02\n0.0007821924\n-0.0156276358\n\n\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\n3.204020e-02\n-0.0264540226\n0.001974596\n0.5470836\n-0.025112726\n1.016290121\n8.666760e-01\n0.0273618310\n-0.0189019862\n\n\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\n-1.730093e-02\n0.0059739468\n0.015334581\n0.5701491\n0.476474856\n-0.016580222\n9.025668e-01\n-0.0097566128\n0.0045944003\n\n\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\n-1.537451e-02\n-0.0036618865\n0.010825460\n0.8017194\n0.346596916\n0.572483367\n4.284791e-01\n0.5251782663\n0.6016392301\n\n\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\n-2.320340e-02\n-0.0068700812\n-0.003882135\n0.9658855\n0.574961429\n-0.007573551\n-2.751537e-02\n1.0131715862\n-0.0037450447\n\n\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\n9.452643e-03\n0.0290292370\n-0.018340308\n0.8366796\n0.782972925\n0.312903236\n7.415997e-03\n-0.0047334983\n-0.0152212498\n\n\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat\n-1.201114e-02\n0.0098563370\n0.007610442\n0.6463695\n0.845765201\n0.988111397\n-1.628989e-02\n-0.0451875636\n0.4230879417\n\n\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat\n8.615362e-03\n0.0034245307\n0.003521553\n0.9543483\n0.258806687\n0.545596044\n8.743513e-01\n0.8007611046\n0.0106937511\n\n\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat\n1.324703e-02\n-0.0081669716\n-0.002687446\n1.0038940\n0.705750068\n0.024315192\n2.940806e-03\n0.0233627376\n0.0038278500\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\ndonor7_skin.TTTATGCTCGTGTCAA-1\ndonor7_skin\n-0.0003990615\n0.0296742640\n0.0024537346\n-0.0022613577\n0.005936938\n-0.0152438542\n0.011365044\n0.0266668524\n0.993266362\n\n\ndonor7_skin.TTTCACAAGCGATGGT-1\ndonor7_skin\n0.0724061217\n0.0163329879\n-0.0121939738\n0.8780212054\n0.915039457\n-0.0022887873\n-0.003619139\n0.6576163700\n-0.022271624\n\n\ndonor7_skin.TTTCACAGTTGTAGCT-1\ndonor7_skin\n-0.0193141786\n0.0291989017\n0.0173694292\n0.6724375849\n-0.014048362\n0.8438412083\n-0.014767578\n0.3371750161\n1.012992834\n\n\ndonor7_skin.TTTCAGTTCAATCGGT-1\ndonor7_skin\n-0.0089066053\n0.0535302078\n0.0057074223\n0.9399958719\n0.837298673\n0.7853596621\n0.001170393\n0.5677482638\n-0.015832060\n\n\ndonor7_skin.TTTCATGGTACAGTCT-1\ndonor7_skin\n0.0168256604\n-0.0141936968\n0.0342388298\n0.8215068327\n0.956895869\n0.9802217122\n-0.014461001\n-0.0221556456\n0.024801192\n\n\ndonor7_skin.TTTCATGGTGGCTGCT-1\ndonor7_skin\n-0.0070698679\n0.0068699903\n-0.0091017995\n0.2931002673\n0.810785461\n1.0026773554\n0.492932180\n0.0548301164\n-0.010028765\n\n\ndonor7_skin.TTTCATGTCCTTATGT-1\ndonor7_skin\n-0.0244871095\n0.0021237005\n0.0569417374\n0.2855903543\n0.008329916\n0.7890122466\n0.667711838\n0.8982960297\n0.859786864\n\n\ndonor7_skin.TTTCCTCAGCGGACAT-1\ndonor7_skin\n0.0101579819\n-0.0072413576\n-0.0085471731\n0.9655089864\n0.537852124\n-0.0006230239\n0.019402825\n0.9072832572\n0.883812935\n\n\ndonor7_skin.TTTCCTCCACTCTAGA-1\ndonor7_skin\n0.0078304239\n-0.0350495412\n-0.0009815983\n0.4845271662\n0.990405026\n0.8220684204\n0.019326832\n0.0022491603\n-0.011941081\n\n\ndonor7_skin.TTTCCTCGTACAAAGT-1\ndonor7_skin\n-0.0362198769\n-0.0103053609\n0.0227414740\n0.8186186769\n0.576536763\n0.9798925477\n0.006112943\n0.0073708300\n-0.020194533\n\n\ndonor7_skin.TTTCCTCGTAGCGCTC-1\ndonor7_skin\n-0.0272635933\n-0.0507201323\n0.0359429627\n0.3640793752\n0.693701713\n0.2074575138\n0.383341644\n0.5185157652\n0.002529597\n\n\ndonor7_skin.TTTCCTCGTGGCCCAT-1\ndonor7_skin\n-0.0141176115\n0.0140864067\n0.0219909984\n0.5788112613\n0.027949546\n0.0088000969\n-0.032908415\n0.6754636217\n1.001629578\n\n\ndonor7_skin.TTTCGATAGTGTCATC-1\ndonor7_skin\n0.0094453692\n-0.0021904036\n0.0250803613\n0.7851348844\n0.960259296\n0.3687019867\n-0.026586277\n0.0046595506\n0.021779652\n\n\ndonor7_skin.TTTCGATCAAGAAATC-1\ndonor7_skin\n-0.0242377823\n-0.0403578822\n-0.0062238060\n-0.0191509953\n-0.003257678\n0.9991128536\n-0.008962441\n0.0064038129\n-0.021909010\n\n\ndonor7_skin.TTTCGATTCTGCCCTA-1\ndonor7_skin\n-0.0032107839\n0.0155023708\n0.0389190531\n-0.0136244979\n0.020727457\n0.7525883420\n0.782999736\n0.0112400347\n0.463305575\n\n\ndonor7_skin.TTTGACTCACCCTTAC-1\ndonor7_skin\n-0.0001306085\n-0.0178902702\n0.0078969840\n0.9241689730\n0.547651788\n-0.0120514165\n1.009696181\n0.0331389587\n-0.046051959\n\n\ndonor7_skin.TTTGACTCAGTAACGG-1\ndonor7_skin\n0.0050997361\n-0.0118696652\n0.0130506358\n0.5997844688\n0.544050749\n-0.0387092503\n-0.021861516\n1.0054835865\n0.617677334\n\n\ndonor7_skin.TTTGACTGTTCTGACA-1\ndonor7_skin\n-0.0033006433\n-0.0167376666\n-0.0095107318\n0.7667512684\n0.013864044\n0.5748190268\n0.007200415\n0.8863525341\n-0.012955067\n\n\ndonor7_skin.TTTGATCCACATATGC-1\ndonor7_skin\n0.0086986293\n0.0001716679\n-0.0063615097\n0.7438463843\n-0.017501750\n0.0030111330\n0.043734232\n0.4958974983\n0.012600984\n\n\ndonor7_skin.TTTGATCCACTAGAGG-1\ndonor7_skin\n-0.0032251796\n-0.0021914976\n0.0128733049\n1.0157908962\n-0.001787367\n-0.0052518524\n-0.008076685\n-0.0090272773\n0.973062128\n\n\ndonor7_skin.TTTGATCGTCCCAAAT-1\ndonor7_skin\n-0.0195745681\n0.0250537166\n-0.0088243499\n-0.0039134482\n-0.022815206\n-0.0144200855\n0.005719765\n0.0196336264\n0.735776560\n\n\ndonor7_skin.TTTGATCGTTCTCCAC-1\ndonor7_skin\n-0.0434723500\n-0.0252945210\n0.0179085736\n0.6929848846\n0.962433259\n0.7529268707\n0.020575347\n0.0015099153\n0.024224592\n\n\ndonor7_skin.TTTGATCTCTGTCTCG-1\ndonor7_skin\n0.0070041822\n-0.0115678572\n0.0243900636\n0.5309536652\n0.608532916\n-0.0109624939\n0.828145276\n0.3868799389\n0.945091813\n\n\ndonor7_skin.TTTGGAGAGCAAACAT-1\ndonor7_skin\n0.0041887005\n0.0139418241\n-0.0088589254\n0.6603070090\n0.998915741\n0.8172057627\n-0.022135229\n-0.0187547122\n0.979596396\n\n\ndonor7_skin.TTTGGAGAGTACTCGT-1\ndonor7_skin\n0.0054559858\n0.0175492243\n0.0156962339\n0.7827001774\n0.987185754\n0.6964182957\n0.036893497\n-0.0010041689\n-0.004765871\n\n\ndonor7_skin.TTTGGAGGTACGTGTT-1\ndonor7_skin\n0.0190830933\n0.0145798248\n-0.0356252672\n1.0102405349\n0.542353546\n0.0361041893\n-0.022489221\n-0.0096067625\n0.018684895\n\n\ndonor7_skin.TTTGGAGTCCATTTGT-1\ndonor7_skin\n-0.0027773493\n-0.0189338551\n0.0359169146\n0.0009260175\n-0.000390323\n0.4425000838\n-0.012844999\n0.5196031753\n0.438295525\n\n\ndonor7_skin.TTTGGAGTCTTACCGC-1\ndonor7_skin\n0.0331070097\n-0.0074154506\n0.0028981773\n0.4783320616\n0.747969470\n0.4664506242\n0.001862201\n-0.0004225433\n0.007729157\n\n\ndonor7_skin.TTTGGTTGTTGTAGCT-1\ndonor7_skin\n-0.0246628673\n-0.0032276620\n-0.0063759478\n0.8240156451\n1.017997709\n0.0117801748\n0.006195800\n0.0052499922\n0.016706311\n\n\ndonor7_skin.TTTGTTGCAACTGTGT-1\ndonor7_skin\n0.0128099107\n0.0109123962\n-0.0250518974\n0.8200733693\n0.914873636\n0.6920174360\n-0.027329639\n0.3451530485\n0.010775754\n\n\n\n\n\n\ndf$keep &lt;- df %&gt;% with((col1a1+jam2+prgfrb) &lt; .1)\nmean(!df$keep)\nsum(!df$keep)\nwith(df, table(Sample, keep))\n\n0.0311574032504265\n\n\n694\n\n\n                 keep\nSample            FALSE TRUE\n  donor1_fat          2  156\n  donor1_skin        19 3784\n  donor2_fat         24 2794\n  donor3_fat        297  724\n  donor3_skin        29  540\n  donor4_fat         38   50\n  donor4_skin        47  582\n  donor5_recovery   122 4757\n  donor6_fat         25 1969\n  donor6_skin        14 1696\n  donor7_fat         26 1681\n  donor7_skin        51 2847\n\n\n\noptions(repr.plot.width=20, repr.plot.height=20)\n\nggplot(df, aes(x=col1a1+jam2+prgfrb, y=ccl21+lyve1+prox1+pdpn+cxcl2+ccl2, shape=keep)) +\n    geom_jitter(width=.01, height = .1) +\n    geom_vline(xintercept = .05) +\n    facet_wrap(~Sample) + geom_density_2d()\n\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\nWarning message:\n“`stat_contour()`: Zero contours were generated”\nWarning message in min(x):\n“nessun argomento non-mancante al minimo; si restituisce Inf”\nWarning message in max(x):\n“nessun argomento non-mancante al massimo; si restituisce -Inf”\n\n\n\n\n\n\nmatch(rownames(colData(sce)), rownames(df))\n\n\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200⋯1376613767137681376913770137711377213773137741377513776137771377813779137801378113782137831378413785137861378713788137891379013791137921379313794137951379613797137981379913800138011380213803138041380513806138071380813809138101381113812138131381413815138161381713818138191382013821138221382313824138251382613827138281382913830138311383213833138341383513836138371383813839138401384113842138431384413845138461384713848138491385013851138521385313854138551385613857138581385913860138611386213863138641386513866138671386813869138701387113872138731387413875138761387713878138791388013881138821388313884138851388613887138881388913890138911389213893138941389513896138971389813899139001390113902139031390413905139061390713908139091391013911139121391313914139151391613917139181391913920139211392213923139241392513926139271392813929139301393113932139331393413935139361393713938139391394013941139421394313944139451394613947139481394913950139511395213953139541395513956139571395813959139601396113962139631396413965\n\n\n\ndf &lt;- df[match(rownames(colData(sce)), rownames(df)),]\nall(rownames(df) == rownames(colData(sce)))\n\nTRUE\n\n\n\nsce$outlier_contamination &lt;- !df$keep\nsce %&gt;% colData %&gt;% as.data.frame\n\n\nA data.frame: 22274 × 21\n\n\n\nSample\nBarcode\ndonor\ntissue\ntissue_origin\nsequencing_run\nsex\nsum\ndetected\npercent.top_50\n⋯\npercent.top_200\npercent.top_500\nsubsets_Mito_sum\nsubsets_Mito_detected\nsubsets_Mito_percent\ntotal\noutlier_sum\noutlier_detected\nsizeFactor\noutlier_contamination\n\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n⋯\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;int&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;otlr.flt&gt;\n&lt;otlr.flt&gt;\n&lt;dbl&gt;\n&lt;lgl&gt;\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\nAAAGAACCACATACGT-1\n1\nfat\nabdomen\n1\nF\n4276\n1721\n33.88681\n⋯\n52.99345\n69.31712\n752\n16\n17.5865295\n4276\nFALSE\nFALSE\n0.8543311\nFALSE\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\nAAAGGTAGTCCGGTCA-1\n1\nfat\nabdomen\n1\nF\n3023\n1084\n39.66259\n⋯\n65.00165\n80.68144\n52\n12\n1.7201456\n3023\nFALSE\nFALSE\n0.7202661\nFALSE\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\nAAAGGTATCTCTCTTC-1\n1\nfat\nabdomen\n1\nF\n3892\n1422\n34.12127\n⋯\n58.35046\n75.92497\n48\n12\n1.2332991\n3892\nFALSE\nFALSE\n0.9319094\nFALSE\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\nAACCACACAGTGGCTC-1\n1\nfat\nabdomen\n1\nF\n7722\n2633\n26.89718\n⋯\n48.67910\n64.12846\n103\n13\n1.3338513\n7722\nFALSE\nFALSE\n1.8470909\nFALSE\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\nAACGGGATCTGCTGAA-1\n1\nfat\nabdomen\n1\nF\n3256\n1284\n34.33661\n⋯\n59.06020\n75.92138\n123\n11\n3.7776413\n3256\nFALSE\nFALSE\n0.7595401\nFALSE\n\n\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\nAAGAACATCTGTGCAA-1\n1\nfat\nabdomen\n1\nF\n6777\n1989\n32.86115\n⋯\n60.01180\n74.07407\n224\n14\n3.3052973\n6777\nFALSE\nFALSE\n1.5886582\nFALSE\n\n\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\nAAGCATCTCGATCCCT-1\n1\nfat\nabdomen\n1\nF\n1746\n839\n34.07789\n⋯\n61.45475\n80.58419\n63\n11\n3.6082474\n1746\nFALSE\nFALSE\n0.4080134\nFALSE\n\n\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\nAAGCGAGAGTATCCTG-1\n1\nfat\nabdomen\n1\nF\n6750\n2393\n24.08889\n⋯\n46.69630\n63.71852\n277\n18\n4.1037037\n6750\nFALSE\nFALSE\n1.5692636\nFALSE\n\n\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\nAAGTTCGAGGCAGGTT-1\n1\nfat\nabdomen\n1\nF\n5707\n2041\n31.20729\n⋯\n54.17908\n68.91537\n188\n12\n3.2942001\n5707\nFALSE\nFALSE\n1.3379833\nFALSE\n\n\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\nAATCGACCAATTGCAC-1\n1\nfat\nabdomen\n1\nF\n3401\n1534\n26.60982\n⋯\n49.51485\n68.92091\n107\n15\n3.1461335\n3401\nFALSE\nFALSE\n0.7985717\nFALSE\n\n\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\nACAAAGACAATGACCT-1\n1\nfat\nabdomen\n1\nF\n5851\n1802\n32.49017\n⋯\n58.43446\n74.67100\n106\n16\n1.8116561\n5851\nFALSE\nFALSE\n1.3927730\nFALSE\n\n\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\nACAAAGACACTAACGT-1\n1\nfat\nabdomen\n1\nF\n3602\n1004\n43.80900\n⋯\n72.01555\n86.00777\n60\n11\n1.6657413\n3602\nFALSE\nFALSE\n0.8586948\nFALSE\n\n\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\nACAACCAAGGGCTTCC-1\n1\nfat\nabdomen\n1\nF\n10238\n3273\n22.24067\n⋯\n44.50088\n59.89451\n168\n12\n1.6409455\n10238\nFALSE\nFALSE\n2.4412922\nFALSE\n\n\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\nACAGGGATCTCATAGG-1\n1\nfat\nabdomen\n1\nF\n5210\n1884\n27.96545\n⋯\n53.03263\n69.17466\n105\n13\n2.0153551\n5210\nFALSE\nFALSE\n1.2376164\nFALSE\n\n\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\nACATTTCCACTCCACT-1\n1\nfat\nabdomen\n1\nF\n3606\n1305\n36.30061\n⋯\n61.53633\n77.67610\n33\n11\n0.9151414\n3606\nFALSE\nFALSE\n0.8662102\nFALSE\n\n\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\nACATTTCTCGATGGAG-1\n1\nfat\nabdomen\n1\nF\n3853\n1491\n34.07734\n⋯\n58.44796\n74.27978\n68\n13\n1.7648586\n3853\nFALSE\nFALSE\n0.9176059\nFALSE\n\n\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\nACCCTTGTCACCATAG-1\n1\nfat\nabdomen\n1\nF\n4627\n1604\n34.92544\n⋯\n59.39053\n74.82170\n84\n12\n1.8154312\n4627\nFALSE\nFALSE\n1.1013695\nFALSE\n\n\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\nACCTACCAGACCTCCG-1\n1\nfat\nabdomen\n1\nF\n1732\n651\n46.76674\n⋯\n73.78753\n91.28176\n41\n12\n2.3672055\n1732\nFALSE\nFALSE\n0.4099528\nFALSE\n\n\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\nACGGAAGCACACCTAA-1\n1\nfat\nabdomen\n1\nF\n5069\n2279\n17.65634\n⋯\n36.41744\n56.77648\n369\n14\n7.2795423\n5069\nFALSE\nFALSE\n1.1394313\nFALSE\n\n\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\nACGTAGTTCCCGAAAT-1\n1\nfat\nabdomen\n1\nF\n3897\n1246\n36.23300\n⋯\n62.63793\n80.70310\n39\n11\n1.0007698\n3897\nFALSE\nFALSE\n0.9353034\nFALSE\n\n\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\nACGTTCCAGATGAATC-1\n1\nfat\nabdomen\n1\nF\n1884\n1136\n28.60934\n⋯\n47.29299\n66.24204\n280\n13\n14.8619958\n1884\nFALSE\nFALSE\n0.3888612\nFALSE\n\n\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\nACTCTCGAGCCGTTGC-1\n1\nfat\nabdomen\n1\nF\n1220\n611\n41.96721\n⋯\n66.31148\n90.90164\n154\n15\n12.6229508\n1220\nFALSE\nFALSE\n0.2584327\nFALSE\n\n\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\nACTTCCGTCAGGAACG-1\n1\nfat\nabdomen\n1\nF\n4898\n2364\n17.29277\n⋯\n34.29971\n53.14414\n367\n16\n7.4928542\n4898\nFALSE\nFALSE\n1.0984603\nFALSE\n\n\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\nAGACACTCAGGCGATA-1\n1\nfat\nabdomen\n1\nF\n4601\n1518\n33.51445\n⋯\n59.70441\n76.26603\n171\n12\n3.7165834\n4601\nFALSE\nFALSE\n1.0739746\nFALSE\n\n\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\nAGACCATTCAAAGGTA-1\n1\nfat\nabdomen\n1\nF\n7030\n2375\n27.28307\n⋯\n50.54054\n66.28734\n27\n10\n0.3840683\n7030\nFALSE\nFALSE\n1.6977527\nFALSE\n\n\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\nAGAGAGCCAAGCCCAC-1\n1\nfat\nabdomen\n1\nF\n3437\n1047\n43.26447\n⋯\n69.53739\n84.08496\n85\n12\n2.4730870\n3437\nFALSE\nFALSE\n0.8126327\nFALSE\n\n\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\nAGAGCCCAGTCTAGCT-1\n1\nfat\nabdomen\n1\nF\n4781\n1680\n33.44489\n⋯\n58.12592\n73.41560\n110\n14\n2.3007739\n4781\nFALSE\nFALSE\n1.1324008\nFALSE\n\n\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat\nAGATCCAGTGCAGTGA-1\n1\nfat\nabdomen\n1\nF\n3119\n1398\n30.49054\n⋯\n53.83136\n71.20872\n84\n12\n2.6931709\n3119\nFALSE\nFALSE\n0.7357817\nFALSE\n\n\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat\nAGATCGTGTTGCGTAT-1\n1\nfat\nabdomen\n1\nF\n4444\n1616\n32.06571\n⋯\n56.79568\n73.33483\n7\n5\n0.1575158\n4444\nFALSE\nFALSE\n1.0756716\nFALSE\n\n\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat\nAGGAGGTCAATACGAA-1\n1\nfat\nabdomen\n1\nF\n3179\n1211\n36.83548\n⋯\n61.81189\n77.63448\n108\n12\n3.3972947\n3179\nFALSE\nFALSE\n0.7445093\nFALSE\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋱\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\ndonor5_recovery.TTTCGATAGTGGAATT-1\ndonor5_recovery\nTTTCGATAGTGGAATT-1\n5\nmixed\nabdomen\n4\n?\n3048\n1575\n21.42388\n⋯\n42.84777\n64.20604\n139\n16\n4.5603675\n3048\nFALSE\nFALSE\n0.7052353\nFALSE\n\n\ndonor5_recovery.TTTCGATGTGCTGATT-1\ndonor5_recovery\nTTTCGATGTGCTGATT-1\n5\nmixed\nabdomen\n4\n?\n2238\n1400\n17.20286\n⋯\n36.90795\n59.78552\n57\n15\n2.5469169\n2238\nFALSE\nFALSE\n0.5287446\nFALSE\n\n\ndonor5_recovery.TTTGACTAGATGGGCT-1\ndonor5_recovery\nTTTGACTAGATGGGCT-1\n5\nmixed\nabdomen\n4\n?\n2448\n1208\n27.69608\n⋯\n53.10458\n71.07843\n95\n16\n3.8807190\n2448\nFALSE\nFALSE\n0.5704430\nTRUE\n\n\ndonor5_recovery.TTTGACTAGTGTTCAC-1\ndonor5_recovery\nTTTGACTAGTGTTCAC-1\n5\nmixed\nabdomen\n4\n?\n6499\n2564\n24.23450\n⋯\n44.72996\n60.70165\n78\n13\n1.2001846\n6499\nFALSE\nFALSE\n1.5566571\nFALSE\n\n\ndonor5_recovery.TTTGACTGTCCAAATC-1\ndonor5_recovery\nTTTGACTGTCCAAATC-1\n5\nmixed\nabdomen\n4\n?\n958\n673\n24.32150\n⋯\n50.62630\n81.94154\n8\n4\n0.8350731\n958\nFALSE\nFALSE\n0.2303106\nFALSE\n\n\ndonor5_recovery.TTTGACTGTGATTCTG-1\ndonor5_recovery\nTTTGACTGTGATTCTG-1\n5\nmixed\nabdomen\n4\n?\n1568\n955\n26.97704\n⋯\n50.70153\n70.98214\n71\n14\n4.5280612\n1568\nFALSE\nFALSE\n0.3629210\nFALSE\n\n\ndonor5_recovery.TTTGACTGTTGTCTAG-1\ndonor5_recovery\nTTTGACTGTTGTCTAG-1\n5\nmixed\nabdomen\n4\n?\n936\n593\n29.70085\n⋯\n58.01282\n90.06410\n38\n11\n4.0598291\n936\nFALSE\nFALSE\n0.2177041\nFALSE\n\n\ndonor5_recovery.TTTGATCAGATGACCG-1\ndonor5_recovery\nTTTGATCAGATGACCG-1\n5\nmixed\nabdomen\n4\n?\n956\n596\n30.75314\n⋯\n58.57741\n89.95816\n25\n8\n2.6150628\n956\nFALSE\nFALSE\n0.2257044\nFALSE\n\n\ndonor5_recovery.TTTGATCAGCAATAAC-1\ndonor5_recovery\nTTTGATCAGCAATAAC-1\n5\nmixed\nabdomen\n4\n?\n2148\n939\n34.35754\n⋯\n61.17318\n79.56238\n71\n14\n3.3054004\n2148\nFALSE\nFALSE\n0.5035317\nFALSE\n\n\ndonor5_recovery.TTTGATCAGTTACTCG-1\ndonor5_recovery\nTTTGATCAGTTACTCG-1\n5\nmixed\nabdomen\n4\n?\n3145\n1486\n21.90779\n⋯\n46.45469\n67.59936\n66\n15\n2.0985692\n3145\nFALSE\nFALSE\n0.7464487\nFALSE\n\n\ndonor5_recovery.TTTGATCGTTGGGCCT-1\ndonor5_recovery\nTTTGATCGTTGGGCCT-1\n5\nmixed\nabdomen\n4\n?\n2897\n1316\n30.54884\n⋯\n54.57370\n71.83293\n182\n17\n6.2823611\n2897\nFALSE\nFALSE\n0.6582034\nFALSE\n\n\ndonor5_recovery.TTTGATCTCAAAGGTA-1\ndonor5_recovery\nTTTGATCTCAAAGGTA-1\n5\nmixed\nabdomen\n4\n?\n2155\n1136\n26.07889\n⋯\n50.06961\n70.48724\n98\n14\n4.5475638\n2155\nFALSE\nFALSE\n0.4986830\nFALSE\n\n\ndonor5_recovery.TTTGGAGAGTGCAAAT-1\ndonor5_recovery\nTTTGGAGAGTGCAAAT-1\n5\nmixed\nabdomen\n4\n?\n1054\n601\n34.91461\n⋯\n61.95446\n90.41746\n43\n14\n4.0796964\n1054\nFALSE\nFALSE\n0.2450989\nFALSE\n\n\ndonor5_recovery.TTTGGAGCATAGGTAA-1\ndonor5_recovery\nTTTGGAGCATAGGTAA-1\n5\nmixed\nabdomen\n4\n?\n1846\n1050\n23.34778\n⋯\n47.50813\n70.20585\n89\n14\n4.8212351\n1846\nFALSE\nFALSE\n0.4259534\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCAGTTTG-1\ndonor5_recovery\nTTTGGAGGTCAGTTTG-1\n5\nmixed\nabdomen\n4\n?\n1222\n769\n26.67758\n⋯\n53.43699\n77.98691\n51\n13\n4.1734861\n1222\nFALSE\nFALSE\n0.2838881\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCCAAGAG-1\ndonor5_recovery\nTTTGGAGGTCCAAGAG-1\n5\nmixed\nabdomen\n4\n?\n1829\n1058\n27.28267\n⋯\n49.64461\n69.49153\n28\n12\n1.5308912\n1829\nFALSE\nFALSE\n0.4366204\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTCGACTTA-1\ndonor5_recovery\nTTTGGAGGTCGACTTA-1\n5\nmixed\nabdomen\n4\n?\n2389\n1430\n17.91545\n⋯\n38.21683\n61.07158\n154\n21\n6.4462118\n2389\nFALSE\nFALSE\n0.5418360\nFALSE\n\n\ndonor5_recovery.TTTGGAGGTTGAGAGC-1\ndonor5_recovery\nTTTGGAGGTTGAGAGC-1\n5\nmixed\nabdomen\n4\n?\n1618\n993\n21.69345\n⋯\n46.66255\n69.53028\n38\n11\n2.3485785\n1618\nFALSE\nFALSE\n0.3830429\nFALSE\n\n\ndonor5_recovery.TTTGGAGTCCAAGAGG-1\ndonor5_recovery\nTTTGGAGTCCAAGAGG-1\n5\nmixed\nabdomen\n4\n?\n1262\n830\n23.85103\n⋯\n50.07924\n73.85103\n69\n14\n5.4675119\n1262\nFALSE\nFALSE\n0.2892216\nFALSE\n\n\ndonor5_recovery.TTTGGAGTCTCAACCC-1\ndonor5_recovery\nTTTGGAGTCTCAACCC-1\n5\nmixed\nabdomen\n4\n?\n1135\n717\n29.51542\n⋯\n54.44934\n80.88106\n18\n10\n1.5859031\n1135\nFALSE\nFALSE\n0.2707968\nFALSE\n\n\ndonor5_recovery.TTTGGTTAGCCTCTTC-1\ndonor5_recovery\nTTTGGTTAGCCTCTTC-1\n5\nmixed\nabdomen\n4\n?\n763\n584\n24.90170\n⋯\n49.67235\n88.99083\n24\n8\n3.1454784\n763\nFALSE\nFALSE\n0.1791574\nFALSE\n\n\ndonor5_recovery.TTTGGTTCACTCTAGA-1\ndonor5_recovery\nTTTGGTTCACTCTAGA-1\n5\nmixed\nabdomen\n4\n?\n812\n570\n27.58621\n⋯\n54.43350\n91.37931\n24\n8\n2.9556650\n812\nFALSE\nFALSE\n0.1910366\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTACGTGAG-1\ndonor5_recovery\nTTTGGTTGTACGTGAG-1\n5\nmixed\nabdomen\n4\n?\n755\n494\n30.99338\n⋯\n61.05960\n100.00000\n34\n9\n4.5033113\n755\nFALSE\nFALSE\n0.1747936\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTCCTACAA-1\ndonor5_recovery\nTTTGGTTGTCCTACAA-1\n5\nmixed\nabdomen\n4\n?\n835\n625\n24.07186\n⋯\n49.10180\n85.02994\n27\n6\n3.2335329\n835\nFALSE\nFALSE\n0.1958852\nFALSE\n\n\ndonor5_recovery.TTTGGTTGTGACTCTA-1\ndonor5_recovery\nTTTGGTTGTGACTCTA-1\n5\nmixed\nabdomen\n4\n?\n938\n572\n29.63753\n⋯\n60.34115\n92.32409\n2\n2\n0.2132196\n938\nFALSE\nFALSE\n0.2269165\nFALSE\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\nTTTGGTTTCGACCAAT-1\n5\nmixed\nabdomen\n4\n?\n1328\n670\n34.33735\n⋯\n64.30723\n87.19880\n67\n10\n5.0451807\n1328\nFALSE\nFALSE\n0.3057070\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\nTTTGTTGGTCCTACGG-1\n5\nmixed\nabdomen\n4\n?\n795\n552\n28.30189\n⋯\n55.72327\n93.45912\n44\n12\n5.5345912\n795\nFALSE\nFALSE\n0.1820666\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\nTTTGTTGGTCGCAGTC-1\n5\nmixed\nabdomen\n4\n?\n1872\n1250\n16.18590\n⋯\n37.01923\n59.93590\n66\n14\n3.5256410\n1872\nFALSE\nFALSE\n0.4378325\nFALSE\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\nTTTGTTGGTGGCGTAA-1\n5\nmixed\nabdomen\n4\n?\n1928\n931\n33.14315\n⋯\n58.97303\n77.64523\n51\n13\n2.6452282\n1928\nFALSE\nFALSE\n0.4550452\nFALSE\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\nTTTGTTGTCGGCATTA-1\n5\nmixed\nabdomen\n4\n?\n2091\n1206\n21.95122\n⋯\n45.28934\n66.23625\n53\n14\n2.5346724\n2091\nFALSE\nFALSE\n0.4940768\nFALSE\n\n\n\n\n\n\nd &lt;- d[match(rownames(colData(sce)), rownames(d)),]\nd$keep &lt;- df$keep\nall(rownames(d) == rownames(df))\n\nTRUE\n\n\n\ndf1 &lt;- cbind(d, df[,-c(1,11)])\ndf1\n\n\nA data.frame: 22274 × 37\n\n\n\nrowname\nSample\nUMAP.1\nUMAP.2\nENSG00000117707.PROX1\nENSG00000162493.PDPN\nENSG00000133800.LYVE1\nENSG00000137077.CCL21\nENSG00000189056.RELN\nENSG00000129048.ACKR4\n⋯\nkeep\ncol1a1\njam2\nprgfrb\nccl21\nlyve1\nprox1\npdpn\nccl2\ncxcl2\n\n\n\n&lt;chr&gt;\n&lt;chr&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n⋯\n&lt;lgl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n&lt;dbl&gt;\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\n-2.0484646\n-1.1637262\n1.1180317\n0.0000000\n1.7402855\n6.106210\n0.0000000\n0.000000\n⋯\nTRUE\n-6.177371e-03\n-0.0031744491\n0.025607984\n0.8637877\n0.506185147\n0.399910959\n-2.141122e-02\n-0.0147191045\n-0.0092179474\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\n2.8242526\n-1.0391492\n0.0000000\n0.0000000\n0.0000000\n5.158232\n0.0000000\n0.000000\n⋯\nTRUE\n-2.562640e-02\n0.0135274094\n0.016411063\n0.6995753\n-0.030954370\n-0.020318782\n1.272878e-02\n0.0321146768\n-0.0155214929\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\n0.9381566\n0.6268698\n1.0517659\n2.0769685\n0.0000000\n7.544117\n0.0000000\n0.000000\n⋯\nTRUE\n3.954838e-03\n-0.0047302147\n-0.058921807\n1.0064774\n0.009121395\n0.403507005\n9.707439e-01\n0.0009019757\n-0.0097793427\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\n-0.6080225\n-0.6364202\n0.0000000\n0.6242337\n2.0869030\n7.002557\n0.6242337\n0.000000\n⋯\nTRUE\n-8.390417e-04\n-0.0049775072\n0.004997854\n0.9798234\n0.630962393\n-0.022863151\n3.719339e-01\n0.6664521861\n0.0467031244\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\n-1.0524757\n-1.6120028\n0.0000000\n0.0000000\n3.1537271\n7.438566\n1.2120004\n0.000000\n⋯\nTRUE\n-3.294729e-02\n0.0172184506\n0.025801842\n1.0099529\n0.952636547\n0.016039127\n3.159890e-02\n-0.0161948350\n0.0093164554\n\n\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat.AAGAACATCTGTGCAA-1\ndonor1_fat\n1.5718066\n0.7489513\n2.0521759\n0.0000000\n0.0000000\n4.639207\n0.0000000\n0.000000\n⋯\nTRUE\n-9.278279e-03\n-0.0432904238\n-0.004928558\n0.6361269\n0.021998822\n0.764609556\n7.688593e-03\n0.4987814014\n0.2286961444\n\n\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat.AAGCATCTCGATCCCT-1\ndonor1_fat\n1.7909548\n0.8797356\n1.7869727\n0.0000000\n0.0000000\n4.182398\n0.0000000\n0.000000\n⋯\nTRUE\n8.961247e-03\n0.0257253419\n-0.007706475\n0.5688781\n0.011359943\n0.668748819\n-9.337751e-04\n-0.0031576763\n-0.0033508996\n\n\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat.AAGCGAGAGTATCCTG-1\ndonor1_fat\n-1.0558064\n1.0522912\n2.0656439\n0.0000000\n2.0656439\n5.340170\n1.1855387\n0.000000\n⋯\nTRUE\n-2.025285e-02\n-0.0427843370\n0.043382435\n0.7318062\n0.612130896\n0.729646983\n4.289729e-03\n1.0105701492\n0.5701520444\n\n\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat.AAGTTCGAGGCAGGTT-1\ndonor1_fat\n-1.0539844\n-0.7540492\n0.8052045\n1.3189166\n3.0830320\n5.494934\n0.0000000\n0.000000\n⋯\nTRUE\n-1.957310e-02\n-0.0155224185\n-0.014063269\n0.7817754\n0.948710864\n0.299500667\n7.823209e-01\n-0.0224818197\n-0.0198374980\n\n\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat.AATCGACCAATTGCAC-1\ndonor1_fat\n-1.3530891\n-1.1469282\n2.2499633\n0.0000000\n1.8091969\n4.835378\n0.0000000\n0.000000\n⋯\nTRUE\n5.040912e-03\n-0.0047053116\n-0.001473258\n0.6704721\n0.547458265\n0.829585304\n-8.579479e-05\n-0.0042205833\n-0.0122900824\n\n\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat.ACAAAGACAATGACCT-1\ndonor1_fat\n1.8577221\n0.7200912\n0.7807234\n0.7807234\n0.0000000\n5.148268\n0.0000000\n0.000000\n⋯\nTRUE\n-2.382496e-02\n0.0412669633\n-0.004748681\n0.7122134\n-0.008654046\n0.306771378\n4.814842e-01\n0.3609760289\n0.5507497536\n\n\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat.ACAAAGACACTAACGT-1\ndonor1_fat\n1.6504609\n-0.9285525\n0.0000000\n0.0000000\n0.0000000\n1.735139\n0.0000000\n0.000000\n⋯\nTRUE\n-2.887057e-02\n-0.0007119733\n-0.011167208\n0.2209485\n-0.004722751\n-0.006377754\n1.007664e-02\n-0.0018593270\n0.9934970903\n\n\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat.ACAACCAAGGGCTTCC-1\ndonor1_fat\n-0.6354316\n1.3237580\n1.6079082\n0.8633345\n2.7516068\n5.683224\n0.8633345\n0.000000\n⋯\nTRUE\n7.492564e-03\n0.0063471223\n0.009616054\n0.7539768\n0.873148301\n0.580555478\n5.203047e-01\n0.3668938136\n-0.0005466140\n\n\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat.ACAGGGATCTCATAGG-1\ndonor1_fat\n-0.1048098\n0.9759096\n2.5479505\n0.0000000\n1.3873679\n5.628782\n0.0000000\n0.000000\n⋯\nTRUE\n2.690249e-02\n-0.0020851500\n0.010444795\n0.7800630\n0.400894972\n0.965109975\n-1.875359e-02\n0.6930383825\n-0.0011001914\n\n\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat.ACATTTCCACTCCACT-1\ndonor1_fat\n2.0356176\n-0.3929195\n0.0000000\n0.0000000\n1.1073224\n7.776050\n0.0000000\n1.107322\n⋯\nTRUE\n-2.288523e-02\n0.0277930016\n-0.001592410\n1.0105555\n0.331541713\n-0.017978599\n2.130233e-02\n0.9701081869\n0.6099380962\n\n\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat.ACATTTCTCGATGGAG-1\ndonor1_fat\n0.4631455\n1.2451497\n0.0000000\n0.0000000\n2.6890671\n5.406405\n0.0000000\n0.000000\n⋯\nTRUE\n1.469623e-02\n0.0315918627\n-0.030168437\n0.7318597\n0.807769612\n0.013928482\n2.950614e-02\n0.8370519554\n0.0040403227\n\n\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat.ACCCTTGTCACCATAG-1\ndonor1_fat\n0.8288960\n-0.8372497\n0.9320313\n0.0000000\n1.4936069\n6.744583\n1.4936069\n0.000000\n⋯\nTRUE\n-2.389362e-02\n-0.0308304543\n0.003702698\n0.9223370\n0.451392924\n0.348397754\n1.515303e-02\n1.0203946074\n0.6950916051\n\n\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat.ACCTACCAGACCTCCG-1\ndonor1_fat\n2.0905075\n0.3380302\n0.0000000\n0.0000000\n0.0000000\n8.245428\n0.0000000\n0.000000\n⋯\nTRUE\n-5.153461e-05\n-0.0112837207\n-0.016008569\n1.0031394\n-0.006312337\n-0.006464281\n3.518851e-03\n1.0086026451\n-0.0328234172\n\n\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat.ACGGAAGCACACCTAA-1\ndonor1_fat\n-3.9451654\n0.2357324\n2.1732948\n0.0000000\n3.0037904\n5.174136\n2.8366140\n0.000000\n⋯\nTRUE\n-4.068141e-02\n-0.0195332344\n-0.013722141\n0.7616221\n0.903429875\n0.811012906\n-2.210629e-02\n0.0126439890\n-0.0003801494\n\n\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat.ACGTAGTTCCCGAAAT-1\ndonor1_fat\n2.7871909\n0.2391406\n0.0000000\n0.0000000\n2.3996324\n6.304685\n0.0000000\n0.000000\n⋯\nTRUE\n1.864060e-02\n0.0445714489\n0.006365741\n0.8880584\n0.704812734\n-0.033339004\n1.545340e-03\n0.5677575058\n-0.0066729671\n\n\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat.ACGTTCCAGATGAATC-1\ndonor1_fat\n-3.5143168\n0.4605635\n0.0000000\n0.0000000\n4.2480247\n6.801925\n1.8365751\n0.000000\n⋯\nTRUE\n-2.603773e-02\n0.0030491045\n0.006140261\n0.9205795\n0.967926311\n0.041954248\n1.651663e-02\n-0.0126926382\n0.0182637707\n\n\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat.ACTCTCGAGCCGTTGC-1\ndonor1_fat\n-0.4711578\n-0.9177226\n0.0000000\n0.0000000\n0.0000000\n6.292590\n0.0000000\n0.000000\n⋯\nTRUE\n-1.347052e-02\n-0.0266749866\n-0.005039600\n0.8886155\n-0.016309032\n0.003981775\n4.496706e-02\n0.0007821924\n-0.0156276358\n\n\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat.ACTTCCGTCAGGAACG-1\ndonor1_fat\n-4.0332029\n0.4111551\n2.6920234\n1.4960688\n0.0000000\n3.681983\n0.9338485\n0.000000\n⋯\nTRUE\n3.204020e-02\n-0.0264540226\n0.001974596\n0.5470836\n-0.025112726\n1.016290121\n8.666760e-01\n0.0273618310\n-0.0189019862\n\n\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat.AGACACTCAGGCGATA-1\ndonor1_fat\n2.8228720\n-1.0549392\n0.0000000\n1.5171453\n1.5171453\n4.150574\n0.0000000\n0.000000\n⋯\nTRUE\n-1.730093e-02\n0.0059739468\n0.015334581\n0.5701491\n0.476474856\n-0.016580222\n9.025668e-01\n-0.0097566128\n0.0045944003\n\n\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat.AGACCATTCAAAGGTA-1\ndonor1_fat\n-0.2053631\n0.8217293\n1.4683445\n0.6681318\n1.1230224\n5.770836\n0.0000000\n0.000000\n⋯\nTRUE\n-1.537451e-02\n-0.0036618865\n0.010825460\n0.8017194\n0.346596916\n0.572483367\n4.284791e-01\n0.5251782663\n0.6016392301\n\n\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat.AGAGAGCCAAGCCCAC-1\ndonor1_fat\n2.1387318\n-0.4795322\n0.0000000\n0.0000000\n1.7912458\n7.487297\n0.0000000\n0.000000\n⋯\nTRUE\n-2.320340e-02\n-0.0068700812\n-0.003882135\n0.9658855\n0.574961429\n-0.007573551\n-2.751537e-02\n1.0131715862\n-0.0037450447\n\n\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat.AGAGCCCAGTCTAGCT-1\ndonor1_fat\n-0.9772060\n-1.4272784\n0.9130940\n0.0000000\n2.6550031\n5.973050\n0.0000000\n0.000000\n⋯\nTRUE\n9.452643e-03\n0.0290292370\n-0.018340308\n0.8366796\n0.782972925\n0.312903236\n7.415997e-03\n-0.0047334983\n-0.0152212498\n\n\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat.AGATCCAGTGCAGTGA-1\ndonor1_fat\n-1.1057518\n-1.5379166\n2.6862529\n0.0000000\n2.6862529\n4.745392\n1.2382358\n0.000000\n⋯\nTRUE\n-1.201114e-02\n0.0098563370\n0.007610442\n0.6463695\n0.845765201\n0.988111397\n-1.628989e-02\n-0.0451875636\n0.4230879417\n\n\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat.AGATCGTGTTGCGTAT-1\ndonor1_fat\n0.3803560\n0.7960730\n1.5156637\n1.5156637\n0.9483405\n6.802562\n0.0000000\n0.000000\n⋯\nTRUE\n8.615362e-03\n0.0034245307\n0.003521553\n0.9543483\n0.258806687\n0.545596044\n8.743513e-01\n0.8007611046\n0.0106937511\n\n\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat.AGGAGGTCAATACGAA-1\ndonor1_fat\n-0.5325592\n-1.5191154\n0.0000000\n0.0000000\n2.3304149\n7.858134\n0.0000000\n0.000000\n⋯\nTRUE\n1.324703e-02\n-0.0081669716\n-0.002687446\n1.0038940\n0.705750068\n0.024315192\n2.940806e-03\n0.0233627376\n0.0038278500\n\n\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋱\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n⋮\n\n\ndonor5_recovery.TTTCGATAGTGGAATT-1\ndonor5_recovery.TTTCGATAGTGGAATT-1\ndonor5_recovery\n0.931899659\n0.9874523770\n1.273794\n1.939578\n2.738090\n5.295910\n1.273794\n0\n⋯\nTRUE\n0.0078565286\n-0.057756457\n-0.014375509\n0.72361653\n8.451639e-01\n0.465701289\n1.0021322779\n0.024510657\n0.001530271\n\n\ndonor5_recovery.TTTCGATGTGCTGATT-1\ndonor5_recovery.TTTCGATGTGCTGATT-1\ndonor5_recovery\n3.102502457\n0.6960900914\n3.386309\n0.000000\n2.257778\n4.780195\n1.531704\n0\n⋯\nTRUE\n-0.0088987663\n0.005490213\n-0.043369000\n0.67533106\n7.024431e-01\n1.043129369\n-0.0101730319\n-0.014094991\n0.018495620\n\n\ndonor5_recovery.TTTGACTAGATGGGCT-1\ndonor5_recovery.TTTGACTAGATGGGCT-1\ndonor5_recovery\n-2.869293698\n-1.1133072484\n0.000000\n0.000000\n0.000000\n5.878965\n1.461017\n0\n⋯\nFALSE\n-0.0080437276\n0.746968267\n-0.018369823\n0.79137227\n2.986268e-02\n0.017854879\n0.0294468781\n1.002458934\n0.955267980\n\n\ndonor5_recovery.TTTGACTAGTGTTCAC-1\ndonor5_recovery.TTTGACTAGTGTTCAC-1\ndonor5_recovery\n1.664190642\n-1.3018784631\n2.074509\n0.000000\n2.618055\n5.711280\n1.192071\n0\n⋯\nTRUE\n-0.0035028445\n-0.009318380\n0.003125337\n0.79445088\n8.138261e-01\n0.765391191\n0.0433107484\n0.004387637\n0.021394056\n\n\ndonor5_recovery.TTTGACTGTCCAAATC-1\ndonor5_recovery.TTTGACTGTCCAAATC-1\ndonor5_recovery\n-0.966822632\n-0.6384149898\n3.275592\n0.000000\n0.000000\n5.730737\n3.275592\n0\n⋯\nTRUE\n0.0354439677\n0.023959903\n-0.042248876\n0.79037410\n1.087581e-03\n0.993731390\n0.0034982672\n0.665586256\n0.829429226\n\n\ndonor5_recovery.TTTGACTGTGATTCTG-1\ndonor5_recovery.TTTGACTGTGATTCTG-1\ndonor5_recovery\n-0.445122727\n-0.0006952394\n1.908975\n1.908975\n2.702844\n5.090220\n0.000000\n0\n⋯\nTRUE\n-0.0157393377\n-0.008596564\n-0.018597758\n0.71798386\n7.873196e-01\n0.712328288\n1.0224097005\n0.530886129\n0.635044719\n\n\ndonor5_recovery.TTTGACTGTTGTCTAG-1\ndonor5_recovery.TTTGACTGTTGTCTAG-1\ndonor5_recovery\n1.368694297\n-0.5846982110\n0.000000\n2.483723\n0.000000\n4.835941\n2.483723\n0\n⋯\nTRUE\n-0.0048798873\n0.041886363\n0.010982527\n0.69210490\n3.078261e-02\n-0.003647282\n1.0260963791\n0.663098789\n1.006265200\n\n\ndonor5_recovery.TTTGATCAGATGACCG-1\ndonor5_recovery.TTTGATCAGATGACCG-1\ndonor5_recovery\n-2.969551571\n-1.9333430637\n0.000000\n0.000000\n0.000000\n4.785731\n0.000000\n0\n⋯\nTRUE\n0.0049796262\n-0.017490582\n-0.028089584\n0.71132958\n-8.360597e-05\n-0.011483696\n-0.0162825909\n0.980354720\n0.991351882\n\n\ndonor5_recovery.TTTGATCAGCAATAAC-1\ndonor5_recovery.TTTGATCAGCAATAAC-1\ndonor5_recovery\n-1.709560879\n0.5504284989\n0.000000\n0.000000\n2.313810\n3.897415\n2.313810\n0\n⋯\nTRUE\n0.0020095366\n-0.016285486\n-0.040712249\n0.53686022\n7.452480e-01\n0.025949401\n0.0056907374\n0.406526968\n0.555830859\n\n\ndonor5_recovery.TTTGATCAGTTACTCG-1\ndonor5_recovery.TTTGATCAGTTACTCG-1\ndonor5_recovery\n0.267802707\n1.6214266907\n1.226309\n1.226309\n1.879452\n4.202872\n0.000000\n0\n⋯\nTRUE\n-0.0258017198\n-0.029121559\n-0.003151891\n0.57797358\n6.069127e-01\n0.433515779\n0.7166358416\n0.035210088\n0.996010501\n\n\ndonor5_recovery.TTTGATCGTTGGGCCT-1\ndonor5_recovery.TTTGATCGTTGGGCCT-1\ndonor5_recovery\n-2.176621445\n0.4464715611\n2.474530\n1.333016\n2.013846\n5.040236\n0.000000\n0\n⋯\nTRUE\n0.0134119960\n-0.010139829\n-0.005379385\n0.68251086\n6.489346e-01\n0.928533940\n0.8013680439\n0.004283741\n-0.002875205\n\n\ndonor5_recovery.TTTGATCTCAAAGGTA-1\ndonor5_recovery.TTTGATCTCAAAGGTA-1\ndonor5_recovery\n-0.603514918\n1.1894396435\n2.324973\n0.000000\n1.587500\n5.618437\n1.587500\n0\n⋯\nTRUE\n0.0316904299\n0.031706872\n-0.005089500\n0.76535833\n4.907608e-01\n0.835413458\n0.0452100049\n0.458816864\n0.529348538\n\n\ndonor5_recovery.TTTGGAGAGTGCAAAT-1\ndonor5_recovery.TTTGGAGAGTGCAAAT-1\ndonor5_recovery\n1.878585807\n-1.7861404825\n0.000000\n0.000000\n0.000000\n4.885569\n0.000000\n0\n⋯\nTRUE\n-0.0619833289\n-0.013402551\n-0.008624484\n0.66754052\n-1.080015e-02\n-0.016247571\n0.0161020449\n0.022663335\n0.004043271\n\n\ndonor5_recovery.TTTGGAGCATAGGTAA-1\ndonor5_recovery.TTTGGAGCATAGGTAA-1\ndonor5_recovery\n1.836256198\n2.0150197636\n0.000000\n2.509784\n1.743159\n5.899463\n0.000000\n0\n⋯\nTRUE\n-0.0301521554\n-0.031969654\n-0.044194671\n0.85170500\n5.239608e-01\n0.001799755\n1.0241798955\n0.463552702\n0.614902318\n\n\ndonor5_recovery.TTTGGAGGTCAGTTTG-1\ndonor5_recovery.TTTGGAGGTCAGTTTG-1\ndonor5_recovery\n-1.074542531\n-0.6555272449\n0.000000\n2.177125\n0.000000\n5.750545\n2.177125\n0\n⋯\nTRUE\n0.0012958515\n-0.005301574\n0.006366746\n0.76019623\n-1.548313e-02\n-0.005096393\n0.9813391205\n0.598935412\n0.031390193\n\n\ndonor5_recovery.TTTGGAGGTCCAAGAG-1\ndonor5_recovery.TTTGGAGGTCCAAGAG-1\ndonor5_recovery\n-0.190672883\n0.7834137570\n2.480430\n0.000000\n0.000000\n5.617554\n0.000000\n0\n⋯\nTRUE\n0.0246976849\n0.006555066\n0.022130622\n0.75928545\n-4.184287e-02\n0.927049462\n0.0060278824\n0.871505983\n0.000916595\n\n\ndonor5_recovery.TTTGGAGGTCGACTTA-1\ndonor5_recovery.TTTGGAGGTCGACTTA-1\ndonor5_recovery\n3.671599380\n1.8101390492\n1.508721\n0.000000\n0.000000\n5.441227\n1.508721\n0\n⋯\nTRUE\n0.0332257688\n-0.004227929\n0.034628239\n0.74670302\n-1.086385e-02\n0.603558678\n0.0226744277\n0.011588924\n0.025319511\n\n\ndonor5_recovery.TTTGGAGGTTGAGAGC-1\ndonor5_recovery.TTTGGAGGTTGAGAGC-1\ndonor5_recovery\n0.003620616\n2.9168378007\n1.852268\n1.852268\n0.000000\n3.142744\n1.852268\n0\n⋯\nTRUE\n-0.0006157999\n-0.035827474\n0.000994279\n0.43876522\n-2.388770e-02\n0.682955565\n0.9690956326\n0.008550913\n0.005462183\n\n\ndonor5_recovery.TTTGGAGTCCAAGAGG-1\ndonor5_recovery.TTTGGAGTCCAAGAGG-1\ndonor5_recovery\n2.601738057\n-0.4427393783\n2.156253\n0.000000\n0.000000\n3.890469\n2.984610\n0\n⋯\nTRUE\n0.0081313922\n-0.006917426\n-0.004137815\n0.53481200\n-1.358548e-02\n0.793416894\n0.0234968804\n-0.026179733\n-0.006334056\n\n\ndonor5_recovery.TTTGGAGTCTCAACCC-1\ndonor5_recovery.TTTGGAGTCTCAACCC-1\ndonor5_recovery\n-3.085723408\n-1.6553999815\n0.000000\n0.000000\n0.000000\n5.379235\n0.000000\n0\n⋯\nTRUE\n0.0229661385\n-0.002785685\n0.014491942\n0.69413300\n-6.715803e-03\n0.013639157\n0.0319976176\n0.775310750\n0.996777514\n\n\ndonor5_recovery.TTTGGTTAGCCTCTTC-1\ndonor5_recovery.TTTGGTTAGCCTCTTC-1\ndonor5_recovery\n0.379168502\n-0.6033170331\n0.000000\n0.000000\n2.718457\n6.200887\n0.000000\n0\n⋯\nTRUE\n0.0159770391\n-0.030253281\n0.018827326\n0.85607541\n8.387669e-01\n0.012585263\n0.0195137018\n0.011391660\n0.014805679\n\n\ndonor5_recovery.TTTGGTTCACTCTAGA-1\ndonor5_recovery.TTTGGTTCACTCTAGA-1\ndonor5_recovery\n-1.271802434\n-0.9042818058\n0.000000\n0.000000\n0.000000\n5.422125\n0.000000\n0\n⋯\nTRUE\n0.0005551034\n0.002609067\n0.017852325\n0.72905845\n-8.366208e-03\n-0.041417373\n0.0252338117\n-0.002223779\n0.039848818\n\n\ndonor5_recovery.TTTGGTTGTACGTGAG-1\ndonor5_recovery.TTTGGTTGTACGTGAG-1\ndonor5_recovery\n-1.942956456\n-1.6052285690\n0.000000\n0.000000\n2.748683\n5.547458\n0.000000\n0\n⋯\nTRUE\n-0.0045435839\n0.010477268\n0.026323274\n0.76677997\n8.295560e-01\n-0.003306779\n-0.0108690302\n0.029159402\n0.003339426\n\n\ndonor5_recovery.TTTGGTTGTCCTACAA-1\ndonor5_recovery.TTTGGTTGTCCTACAA-1\ndonor5_recovery\n0.055927030\n0.0280046355\n3.486722\n0.000000\n0.000000\n4.729289\n0.000000\n0\n⋯\nTRUE\n-0.0055102803\n-0.029907189\n0.002991879\n0.66621842\n2.914754e-02\n0.991302344\n0.0001031865\n0.014177467\n-0.012870370\n\n\ndonor5_recovery.TTTGGTTGTGACTCTA-1\ndonor5_recovery.TTTGGTTGTGACTCTA-1\ndonor5_recovery\n-2.104454049\n-0.7065999616\n0.000000\n0.000000\n2.434803\n5.628656\n2.434803\n0\n⋯\nTRUE\n0.0053178274\n-0.006904177\n-0.021327896\n0.76737950\n7.614108e-01\n0.010816247\n-0.0349556397\n-0.013907964\n0.992275798\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\n-3.072308549\n-1.2226327170\n0.000000\n0.000000\n0.000000\n6.810155\n0.000000\n0\n⋯\nTRUE\n-0.0196506085\n-0.020662980\n0.020700614\n0.96829368\n5.692978e-02\n0.011930542\n-0.0282590883\n-0.011952372\n0.023237628\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\n-0.856789836\n-1.2551037479\n0.000000\n0.000000\n0.000000\n5.301861\n0.000000\n0\n⋯\nTRUE\n-0.0168946830\n-0.002951992\n-0.006812661\n0.76314051\n7.248523e-03\n0.017844289\n-0.0012970226\n0.710317045\n0.022999301\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\n3.593091539\n1.3092576157\n3.634581\n1.715445\n1.715445\n5.230497\n1.715445\n0\n⋯\nTRUE\n-0.0171547874\n0.004613047\n-0.002779767\n0.77820613\n5.612141e-01\n1.015181387\n1.0078475380\n-0.011442070\n-0.029356296\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\n1.460117213\n-2.1077972461\n2.431668\n0.000000\n0.000000\n0.000000\n0.000000\n0\n⋯\nTRUE\n0.0033150125\n-0.018099916\n-0.002460468\n-0.00730366\n5.005984e-03\n0.865443464\n-0.0463183614\n-0.008029120\n0.001738280\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\n-0.309542426\n2.9477435242\n1.596447\n0.000000\n0.000000\n1.596447\n0.000000\n0\n⋯\nTRUE\n-0.0403284420\n-0.019161737\n0.005990958\n0.20457458\n7.002154e-03\n0.603981121\n0.0025060108\n-0.019188513\n0.012098517\n\n\n\n\n\n\npdf(\"figures/contam-removal-spotcheck.pdf\", width=10, height=5)\n\nggplot(df1, aes(x=UMAP.1, y=UMAP.2, colour=ccl21+lyve1+prox1+pdpn+cxcl2+ccl2)) +\n    geom_point() +\n    scale_colour_gradient(low = \"grey80\", high = \"blue\") +\n    facet_wrap(~Sample, scales = \"free\") +\n    theme(legend.position=\"bottom\")\n\nggplot(df1, aes(x=UMAP.1, y=UMAP.2, colour=col1a1+jam2+prgfrb)) +\n    geom_point() +\n    scale_colour_gradient(low = \"grey80\", high = \"red\") +\n    facet_wrap(~Sample, scales = \"free\") +\n    theme(legend.position=\"bottom\")\n\nggplot(df1, aes(x=UMAP.1, y=UMAP.2)) +\n    geom_point(colour=\"grey\") +\n    geom_point(data = df1 %&gt;% dplyr::filter(!keep), colour=\"black\") +\n    facet_wrap(~Sample, scales = \"free\") +\n    theme(legend.position=\"bottom\")\n\ndev.off()\n\npdf: 2\n\n\n\ntable(sce$Sample, sce$outlier_contamination)\n\n                 \n                  FALSE TRUE\n  donor1_fat        156    2\n  donor1_skin      3784   19\n  donor2_fat       2794   24\n  donor3_fat        724  297\n  donor3_skin       540   29\n  donor4_fat         50   38\n  donor4_skin       582   47\n  donor5_recovery  4757  122\n  donor6_fat       1969   25\n  donor6_skin      1696   14\n  donor7_fat       1681   26\n  donor7_skin      2847   51\n\n\n\nsce &lt;- sce[,!sce$outlier_contamination]\nsce\n\nclass: SingleCellExperiment \ndim: 18627 21580 \nmetadata(0):\nassays(2): counts logcounts\nrownames(18627): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(21580): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(21): Sample Barcode ... sizeFactor outlier_contamination\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\ntable(sce$Sample)\n\n\n     donor1_fat     donor1_skin      donor2_fat      donor3_fat     donor3_skin \n            156            3784            2794             724             540 \n     donor4_fat     donor4_skin donor5_recovery      donor6_fat     donor6_skin \n             50             582            4757            1969            1696 \n     donor7_fat     donor7_skin \n           1681            2847 \n\n\n\nsaveRDS(sce, file=\"../output/0.2-sce-after-contamination-removal.rds\")"
  },
  {
    "objectID": "code/shinycell.html",
    "href": "code/shinycell.html",
    "title": "shinycell",
    "section": "",
    "text": "library(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(zellkonverter)\nlibrary(SingleCellExperiment)\nlibrary(ShinyCell)\n\n\n\n\nsce &lt;- readH5AD(file.path(\"..\", \"data\", \"1.1-sce-after-contamination-removal-integration-clustering.h5ad\"), reader =\"R\")\n\nsce_pre &lt;- readRDS(file.path(\"..\", \"data\", \"0.2-sce-after-contamination-removal.rds\"))\n\n#saveRDS(sce, file.path(\"..\", \"data\", \"1.1-sce-after-contamination-removal-integration-clustering.rds\"))\n\n#Annotate object\nsce$cell_types &lt;- sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res\n\nsce &lt;- sce[, !sce$cell_types %in% c(\"6\", \"8\", \"9\", \"10\")]\n\nsce$cell_type_name &lt;- as.factor(sce$cell_types) |&gt; droplevels()\nlevels(sce$cell_type_name) &lt;- c(\"4 precollector2\", \"1 capillary1\", \"3 precollector1\", \"6 valve\", \"2 capillary2\", \"5 collector\", \"7 proliferative\")\n\nsce$cell_type_name &lt;- factor(sce$cell_type_name, levels = c(\"1 capillary1\", \"2 capillary2\", \"3 precollector1\", \"4 precollector2\", \"5 collector\", \"6 valve\", \"7 proliferative\"))\n\nreducedDims(sce)[\"umap\"] &lt;- reducedDims(sce)[\"logcounts.scaled.pca.harmony.neighbors.umap\"]\n\n# Add relevant metadata to unfiltered sce\nsce_pre &lt;- sce_pre[, colnames(sce)]\ncolData(sce_pre) &lt;- colData(sce)\nreducedDims(sce_pre) &lt;- reducedDims(sce)\n\nsaveRDS(sce_pre, file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\n\n\n\n\n\n\nscConf = createConfig(sce_pre)\nmakeShinyApp(sce_pre, scConf, gene.mapping = TRUE,\n             shiny.title = \"LECs different tissues\")"
  },
  {
    "objectID": "code/shinycell.html#preamble",
    "href": "code/shinycell.html#preamble",
    "title": "shinycell",
    "section": "",
    "text": "library(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(zellkonverter)\nlibrary(SingleCellExperiment)\nlibrary(ShinyCell)\n\n\n\n\nsce &lt;- readH5AD(file.path(\"..\", \"data\", \"1.1-sce-after-contamination-removal-integration-clustering.h5ad\"), reader =\"R\")\n\nsce_pre &lt;- readRDS(file.path(\"..\", \"data\", \"0.2-sce-after-contamination-removal.rds\"))\n\n#saveRDS(sce, file.path(\"..\", \"data\", \"1.1-sce-after-contamination-removal-integration-clustering.rds\"))\n\n#Annotate object\nsce$cell_types &lt;- sce$logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res\n\nsce &lt;- sce[, !sce$cell_types %in% c(\"6\", \"8\", \"9\", \"10\")]\n\nsce$cell_type_name &lt;- as.factor(sce$cell_types) |&gt; droplevels()\nlevels(sce$cell_type_name) &lt;- c(\"4 precollector2\", \"1 capillary1\", \"3 precollector1\", \"6 valve\", \"2 capillary2\", \"5 collector\", \"7 proliferative\")\n\nsce$cell_type_name &lt;- factor(sce$cell_type_name, levels = c(\"1 capillary1\", \"2 capillary2\", \"3 precollector1\", \"4 precollector2\", \"5 collector\", \"6 valve\", \"7 proliferative\"))\n\nreducedDims(sce)[\"umap\"] &lt;- reducedDims(sce)[\"logcounts.scaled.pca.harmony.neighbors.umap\"]\n\n# Add relevant metadata to unfiltered sce\nsce_pre &lt;- sce_pre[, colnames(sce)]\ncolData(sce_pre) &lt;- colData(sce)\nreducedDims(sce_pre) &lt;- reducedDims(sce)\n\nsaveRDS(sce_pre, file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))"
  },
  {
    "objectID": "code/shinycell.html#load-shinycell",
    "href": "code/shinycell.html#load-shinycell",
    "title": "shinycell",
    "section": "",
    "text": "scConf = createConfig(sce_pre)\nmakeShinyApp(sce_pre, scConf, gene.mapping = TRUE,\n             shiny.title = \"LECs different tissues\")"
  },
  {
    "objectID": "code/convert_to_adata.html",
    "href": "code/convert_to_adata.html",
    "title": "lec_flow_push",
    "section": "",
    "text": "suppressPackageStartupMessages({\n    library(dplyr)\n    library(ggplot2)\n    library(SingleCellExperiment)\n    library(scater)\n    library(scran)\n    library(UpSetR)\n    library(googlesheets4)\n    library(cowplot)\n    library(BiocParallel)\n    library(scDblFinder)\n    library(tibble)\n    library(ggpubr)\n    library(reshape2)\n    library(pheatmap)\n    library(RColorBrewer)\n    library(batchelor)\n    library(DropletUtils)\n    library(zellkonverter) # library for conversion of singlecellexperiment objects\n})\n\nWarning message:\n“il pacchetto ‘UpSetR’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘googlesheets4’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘batchelor’ è stato creato con R versione 4.3.0”\nWarning message:\n“il pacchetto ‘DropletUtils’ è stato creato con R versione 4.3.0”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__DummyArrayViewport’ con ‘DelayedArray::.__C__DummyArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::DummyArrayGrid’ con ‘DelayedArray::DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::DummyArrayViewport’ con ‘DelayedArray::DummyArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::write_block’ con ‘DelayedArray::write_block’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::maxlength’ con ‘DelayedArray::maxlength’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::arbind’ con ‘DelayedArray::arbind’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.ArbitraryArrayGrid’ con ‘DelayedArray::aperm.ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::refdim’ con ‘DelayedArray::refdim’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::downsample’ con ‘DelayedArray::downsample’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.character.Array’ con ‘DelayedArray::as.character.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::mapToGrid’ con ‘DelayedArray::mapToGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.complex.Array’ con ‘DelayedArray::as.complex.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::Mindex2Lindex’ con ‘DelayedArray::Mindex2Lindex’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.matrix.Array’ con ‘DelayedArray::as.matrix.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::is_sparse’ con ‘DelayedArray::is_sparse’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__RegularArrayGrid’ con ‘DelayedArray::.__C__RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__SafeArrayViewport’ con ‘DelayedArray::.__C__SafeArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__Array’ con ‘DelayedArray::.__C__Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArrayViewport’ con ‘DelayedArray::.__C__ArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::RegularArrayGrid’ con ‘DelayedArray::RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::makeNindexFromArrayViewport’ con ‘DelayedArray::makeNindexFromArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::extract_array’ con ‘DelayedArray::extract_array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArbitraryArrayGrid’ con ‘DelayedArray::.__C__ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.DummyArrayGrid’ con ‘DelayedArray::aperm.DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.array.Array’ con ‘DelayedArray::as.array.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.integer.Array’ con ‘DelayedArray::as.integer.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::is_sparse&lt;-’ con ‘DelayedArray::is_sparse&lt;-’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.raw.Array’ con ‘DelayedArray::as.raw.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__DummyArrayGrid’ con ‘DelayedArray::.__C__DummyArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::ArbitraryArrayGrid’ con ‘DelayedArray::ArbitraryArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.character.ArrayGrid’ con ‘DelayedArray::as.character.ArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.numeric.Array’ con ‘DelayedArray::as.numeric.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::ArrayViewport’ con ‘DelayedArray::ArrayViewport’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::acbind’ con ‘DelayedArray::acbind’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::t.Array’ con ‘DelayedArray::t.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::read_block’ con ‘DelayedArray::read_block’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::rowsum’ con ‘DelayedArray::rowsum’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::.__C__ArrayGrid’ con ‘DelayedArray::.__C__ArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::aperm.RegularArrayGrid’ con ‘DelayedArray::aperm.RegularArrayGrid’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.vector.Array’ con ‘DelayedArray::as.vector.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::Lindex2Mindex’ con ‘DelayedArray::Lindex2Mindex’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::colsum’ con ‘DelayedArray::colsum’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::mapToRef’ con ‘DelayedArray::mapToRef’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.data.frame.Array’ con ‘DelayedArray::as.data.frame.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“sostituzione dell'importazione precedente ‘S4Arrays::as.logical.Array’ con ‘DelayedArray::as.logical.Array’ durante il caricamento di ‘HDF5Array’”\nWarning message:\n“trovate tabelle metodi multiple per ‘extract_array’”\nWarning message:\n“trovate tabelle metodi multiple per ‘is_sparse’”\nWarning message:\n“trovate tabelle metodi multiple per ‘is_sparse&lt;-’”\nWarning message:\n“trovate tabelle metodi multiple per ‘write_block’”\n\n\n\nsce &lt;- readRDS(file=\"../output/0.2-sce-after-contamination-removal.rds\")\nsce\n\nclass: SingleCellExperiment \ndim: 18627 21580 \nmetadata(0):\nassays(2): counts logcounts\nrownames(18627): ENSG00000187634.SAMD11 ENSG00000188976.NOC2L ...\n  ENSG00000278817.ENSG00000278817 ENSG00000277196.ENSG00000277196\nrowData names(3): ID Symbol Type\ncolnames(21580): donor1_fat.AAAGAACCACATACGT-1\n  donor1_fat.AAAGGTAGTCCGGTCA-1 ... donor5_recovery.TTTGTTGGTGGCGTAA-1\n  donor5_recovery.TTTGTTGTCGGCATTA-1\ncolData names(21): Sample Barcode ... sizeFactor outlier_contamination\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\n# same object, but in Annotated Data format\n\nwriteH5AD(sce, \"../output/0.2-sce-after-contamination-removal.h5ad\")\n\n+ '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/0/bin/conda' 'create' '--yes' '--prefix' '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/zellkonverter/1.8.0/zellkonverterAnnDataEnv-0.8.0' 'python=3.8.13' '--quiet' '-c' 'conda-forge'\n\n+ '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/0/bin/conda' 'install' '--yes' '--prefix' '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/zellkonverter/1.8.0/zellkonverterAnnDataEnv-0.8.0' 'python=3.8.13'\n\n+ '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/0/bin/conda' 'install' '--yes' '--prefix' '/Users/daniele/Library/Caches/org.R-project.R/R/basilisk/1.9.12/zellkonverter/1.8.0/zellkonverterAnnDataEnv-0.8.0' '-c' 'conda-forge' 'python=3.8.13' 'anndata=0.8.0' 'h5py=3.6.0' 'hdf5=1.12.1' 'natsort=8.1.0' 'numpy=1.22.3' 'packaging=21.3' 'pandas=1.4.2' 'python=3.8.13' 'scipy=1.7.3' 'sqlite=3.38.2'\n\nℹ Using the 'counts' assay as the X matrix"
  },
  {
    "objectID": "code/vis_de.html",
    "href": "code/vis_de.html",
    "title": "vis_de",
    "section": "",
    "text": "Libraries\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(scater)\nlibrary(pheatmap)\nlibrary(ComplexHeatmap)\nlibrary(UpSetR)\nlibrary(patchwork)\nlibrary(EnhancedVolcano)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\nHelper functions\n\n\nCode\n# volcano plot function as defined in https://github.com/HelenaLC/TLS-Silina/blob/main/code/geo-02-differential.qmd\n\n.volcano &lt;- \\(df, title, fdr = 0.05, lfc = 1, select_lab = NULL) {\n  EnhancedVolcano(df, \n    x = \"logFC\", y = \"FDR\",\n    FCcutoff = lfc, pCutoff = fdr,\n    selectLab = select_lab,\n    pointSize = 1.7, raster = TRUE,\n    title = title, subtitle = NULL,\n    lab = rownames(df), labSize = 4, \n    drawConnectors = TRUE, widthConnectors = 0.5) +\n  guides(col = guide_legend(override.aes = list(alpha = 1, size = 5))) +\n  theme_bw(9) + theme(\n    aspect.ratio = 1,\n    legend.title = element_blank(),\n    panel.grid.minor = element_blank())\n}\n\n\n\n\n\npb_de_files &lt;- list.files(\"../out/de/20231024\", pattern = \".csv\", full.names = T)\npb_de_names &lt;- list.files(\"../out/de/20231024\", pattern = \".csv\", full.names = F)\npb_de &lt;- lapply(pb_de_files, read.csv, row.names=1)\nnames(pb_de) &lt;- gsub(\"\\\\.csv\",\"\",pb_de_names)\nnames(pb_de)\n\n[1] \"cap_pseudo_bulk\"     \"coll_pseudo_bulk\"    \"DEA\"                \n[4] \"precoll_pseudo_bulk\" \"valves_pseudo_bulk\" \n\npb_all &lt;- readRDS(\"../out/de/pb_all.rds\")\npb_all$gene_symbol[duplicated(pb_all$gene_symbol)] &lt;- pb_all$full_gene_name[duplicated(pb_all$gene_symbol)]\nrownames(pb_all) &lt;- pb_all$gene_symbol\npb_de[[\"all\"]] &lt;- pb_all\npb_de &lt;- pb_de[-which(names(pb_de) %in% \"DEA\")]\n\npb_valve &lt;-  readRDS(\"../out/de/valve2_vs_1.rds\")\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nsce &lt;- sce[, !sce$donor %in% c(\"2.0\", \"5.0\")]\nsce$donor &lt;- sce$donor |&gt; droplevels()\nsce$tissue &lt;- sce$tissue |&gt; droplevels()\n\n#list to map de names to cell type names\nct_nam &lt;- list(\"cap_pseudo_bulk\" = c(\"capillary\"),\n               \"precoll_pseudo_bulk\" = c(\"precollector\"),\n               \"valves_pseudo_bulk\" = c(\"valve\"))\n\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n\nlabel_list &lt;- list(\"cap_pseudo_bulk\" = c(\"APOD\",\"S100A4\", \"S100A6\", \"KLF2\", \"CAVIN3\", \"ID2\",\n                                         \"ADAMTS5\", \"PLXNA2\", \"EPB41\", \"CD34\", \n                                         \"ANGPT2\"),\n                   \"coll_pseudo_bulk\" = c(\"CFD\",\"APOD\", \"ADAMTS5\", \"CCL2\", \"CCL21\"),\n                   \"valves_pseudo_bulk\" = c(\"ICAM1\", \"S100A4\",\"SOX18\",\"ID1\",\"SAMD4A\",\n                                            \"MFAP4\",\"HMOX1\",\"HBA2\",\"MEOX2\",\"HBA1\",\"TEX14\",\"SMAD5\",\"FN1\",\n                                            \"GALNT13\",\"CFH\",\"MGP\"),\n                   \"all\" = c(\"S100A4\", \"ADAMTS5\", \"COL5a2\", \"TAC3\",\"RBP1\",\"MFAP4\",\"MGAT4C\", \"MSR1\",\n                             \"NCALD\",\"GALNT13\",\"NPTX2\",\"SYT12\"))\n\nvalve_lab = c(\"NEO1\",\"ADAMTS1\",\"ADAMTS6\",\"CD24\",\"STC1\",\"GRP\",\"CCDC3\",\"ACKR3\",\n              \"RCAN1\",\"SEMA3D\",\"FGL2\",\"SLC12A2\",\"ADAMTS9\",\"ENOX1\",\"IGFBP2\",\n              \"SERPINB1\",\"CLDN11\",\"ANKRD55\",\"SCG3\",\"HGF\",\"HBA2\",\"ADM\",\"ANGPT2\",\n              \"CLU\",\"APOD\",\"GJA4\",\"FST\")\n\n\n\n\n\n\n\n\nfor (. in names(pb_de)) {\n    p &lt;- .volcano(df = pb_de[[.]], title = ., fdr = 0.05, lfc = 0.75, \n                  select_lab =label_list[[.]])\n    cat(\"####\", ., \"\\n\"); print(p); cat(\"\\n\\n\")\n}\n\ndup_ind &lt;-which(duplicated(pb_valve$gene_symbol))\npb_valve$gene_symbol[dup_ind] &lt;- paste0(pb_valve$full_gene_name[dup_ind], \n                                        \".\",  pb_valve$gene_symbol[dup_ind])\nrownames(pb_valve) &lt;- pb_valve$gene_symbol\np_val &lt;- .volcano(df = pb_valve, title = \"valve2 vs valve1\", fdr = 0.05, \n                  lfc = 0.75, select_lab = valve_lab)\ncat(\"####\", \"valve subgroups\", \"\\n\"); print(p_val); cat(\"\\n\\n\")\n\n\ncap_pseudo_bulkcoll_pseudo_bulkprecoll_pseudo_bulkvalves_pseudo_bulkallvalve subgroups\n\n\n\n\n\n\n\n\nWarning: ggrepel: 14 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\npb_valve$gene_symbol[duplicated(pb_valve$gene_symbol)] &lt;- paste0(\n  pb_valve$full_gene_name[duplicated(pb_valve$gene_symbol)], \".\",\n  pb_valve$gene_symbol[duplicated(pb_valve$gene_symbol)]\n)\n\nrownames(pb_valve) &lt;- pb_valve$gene_symbol\np_val &lt;- .volcano(df = pb_valve, title = \"valve2 vs valve1\", fdr = 0.05, \n                  lfc = 0.75, select_lab = valve_lab)\ncat(\"####\", \"valve subgroups\", \"\\n\"); print(p_val); cat(\"\\n\\n\")\n\n\n\n\n\n\n\n\n\n\n\nCode\nsummed &lt;- aggregateAcrossCells(sce, \n                               id=colData(sce)[,c(\"tissue\", \"ct_broad\", \"donor\")],\n                               use.assay.type = \"counts\")\n\nsummed &lt;- summed[,summed$ncells &gt;= 10]\nrownames(summed) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(summed))\n\n# subset res to de-genes\nde_list &lt;- lapply(pb_de, function(.){\n  top &lt;- as.data.frame(.) |&gt; \n      filter(FDR &lt; 0.01) |&gt; \n      slice_max(abs(logFC), n = 20)\n}) \n\ndrop_ind &lt;- which(sapply(de_list, nrow) &lt; 1)\ndrop_ind2 &lt;- which(names(de_list) %in% c(\"DEA\", \"all\"))\nde_gen_list &lt;- de_list[-c(drop_ind, drop_ind2)]\n\nfor (. in names(de_gen_list)) {\n    sub &lt;- summed[,colData(summed)$ct_broad %in% ct_nam[[.]]]\n    sub &lt;- sub[,order(sub$tissue)]\n    mtx_sub &lt;- log1p(assays(sub)[[\"counts\"]][rownames(de_gen_list[[.]]),])\n    colnames(mtx_sub) &lt;- paste0(\"pseudobulk_\", seq_along(1:ncol(sub)))\n    cd &lt;- data.frame(\"tissue\" = sub$tissue)\n    rownames(cd) &lt;- colnames(mtx_sub)\n    hm &lt;- pheatmap(mtx_sub, \n        main = ., fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        cluster_cols = FALSE,\n        annotation_col = cd)\n    cat(\"####\", ., \"\\n\"); draw(hm); cat(\"\\n\\n\")\n}\n\n\n\ncap_pseudo_bulkprecoll_pseudo_bulkvalves_pseudo_bulkall\n\n\n\n\n\n\n\n\n\n\n\nsummed_all &lt;- aggregateAcrossCells(sce, \n                               id=colData(sce)[,c(\"tissue\", \"donor\")],\n                               use.assay.type = \"counts\")\n\nsummed_all &lt;- summed_all[,summed_all$ncells &gt;= 10]\nrownames(summed_all) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(summed_all))\n\n# subset res to de-genes\nde_all &lt;- as.data.frame(pb_all) |&gt; \n      filter(FDR &lt; 0.01) |&gt; \n      slice_max(abs(logFC), n = 20)\n\n\nsummed_all &lt;- summed_all[,order(summed_all$tissue)]\nmtx_all &lt;- log1p(counts(summed_all)[rownames(de_all),])\ncolnames(mtx_all) &lt;- paste0(\"pseudobulk_\", seq_along(1:ncol(summed_all)))\ncd &lt;- data.frame(\"tissue\" = summed_all$tissue,\n                 \"donor\" = summed_all$donor)\nrownames(cd) &lt;- colnames(mtx_all)\nhm &lt;- pheatmap(mtx_all, \n               main = \"all\", fontsize = 6,\n               col = rev(hcl.colors(51, \"RdBu\")),\n               scale = \"row\", \n               show_colnames = FALSE,\n               cluster_cols = FALSE,\n               annotation_col = cd)\n\ndraw(hm)\n\n\n\n\n\n\n\n\nupset_list &lt;- lapply(pb_de, function(de_res){\n  de_res &lt;- de_res |&gt; \n    filter(FDR &lt; 0.05 & abs(logFC) &gt; 0.75)\n  rownames(de_res)\n})\n\nupset(fromList(upset_list), order.by = \"freq\")\n\n\n\n\n\n\n\nupset_list &lt;- lapply(pb_de, function(de_res){\n  de_res &lt;- de_res |&gt; \n    filter(FDR &lt; 0.05)\n  rownames(de_res)\n})\n\nupset(fromList(upset_list), order.by = \"freq\")\n\n\n\n\n\n\n\n\n\nrownames(sce) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(sce))\nsce_col &lt;- sce[,sce$ct_broad %in% \"collector\"]\nsce_col$ct_broad &lt;- sce_col$ct_broad |&gt; droplevels()\nsummed_col &lt;- summed[,summed$ct_broad %in% \"collector\"]\nsummed_col$ct_broad &lt;- summed_col$ct_broad |&gt; droplevels()\n\nplotExpression(sce_col, features=\"ACKR4\", \n    x=\"tissue\", colour_by=\"donor\")\n\n\n\nplotExpression(summed_col, features=\"ACKR4\", \n    x=\"tissue\", colour_by=\"donor\", exprs_values = \"counts\")"
  },
  {
    "objectID": "code/vis_de.html#preambel",
    "href": "code/vis_de.html#preambel",
    "title": "vis_de",
    "section": "",
    "text": "Libraries\n\nlibrary(scran)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(scater)\nlibrary(pheatmap)\nlibrary(ComplexHeatmap)\nlibrary(UpSetR)\nlibrary(patchwork)\nlibrary(EnhancedVolcano)\nlibrary(SingleCellExperiment)\nlibrary(stringr)\nlibrary(gridExtra)\n\nHelper functions\n\n\nCode\n# volcano plot function as defined in https://github.com/HelenaLC/TLS-Silina/blob/main/code/geo-02-differential.qmd\n\n.volcano &lt;- \\(df, title, fdr = 0.05, lfc = 1, select_lab = NULL) {\n  EnhancedVolcano(df, \n    x = \"logFC\", y = \"FDR\",\n    FCcutoff = lfc, pCutoff = fdr,\n    selectLab = select_lab,\n    pointSize = 1.7, raster = TRUE,\n    title = title, subtitle = NULL,\n    lab = rownames(df), labSize = 4, \n    drawConnectors = TRUE, widthConnectors = 0.5) +\n  guides(col = guide_legend(override.aes = list(alpha = 1, size = 5))) +\n  theme_bw(9) + theme(\n    aspect.ratio = 1,\n    legend.title = element_blank(),\n    panel.grid.minor = element_blank())\n}\n\n\n\n\n\npb_de_files &lt;- list.files(\"../out/de/20231024\", pattern = \".csv\", full.names = T)\npb_de_names &lt;- list.files(\"../out/de/20231024\", pattern = \".csv\", full.names = F)\npb_de &lt;- lapply(pb_de_files, read.csv, row.names=1)\nnames(pb_de) &lt;- gsub(\"\\\\.csv\",\"\",pb_de_names)\nnames(pb_de)\n\n[1] \"cap_pseudo_bulk\"     \"coll_pseudo_bulk\"    \"DEA\"                \n[4] \"precoll_pseudo_bulk\" \"valves_pseudo_bulk\" \n\npb_all &lt;- readRDS(\"../out/de/pb_all.rds\")\npb_all$gene_symbol[duplicated(pb_all$gene_symbol)] &lt;- pb_all$full_gene_name[duplicated(pb_all$gene_symbol)]\nrownames(pb_all) &lt;- pb_all$gene_symbol\npb_de[[\"all\"]] &lt;- pb_all\npb_de &lt;- pb_de[-which(names(pb_de) %in% \"DEA\")]\n\npb_valve &lt;-  readRDS(\"../out/de/valve2_vs_1.rds\")\n\nsce &lt;- readRDS(file.path(\"..\", \"data\", \"sce_all_metadata_genes.rds\"))\nsce &lt;- sce[, !sce$donor %in% c(\"2.0\", \"5.0\")]\nsce$donor &lt;- sce$donor |&gt; droplevels()\nsce$tissue &lt;- sce$tissue |&gt; droplevels()\n\n#list to map de names to cell type names\nct_nam &lt;- list(\"cap_pseudo_bulk\" = c(\"capillary\"),\n               \"precoll_pseudo_bulk\" = c(\"precollector\"),\n               \"valves_pseudo_bulk\" = c(\"valve\"))\n\nsce$ct_broad &lt;- sce$cell_type_name |&gt; forcats::fct_collapse(\n  \"capillary\" = c(\"1 capillary1\", \"2 capillary2\"),\n  \"precollector\" = c(\"3 precollector1\", \"4 precollector2\"),\n  \"collector\" = c(\"5 collector\"),\n  \"valve\" = c(\"6 valve\"),\n  \"prolieferative\" = c(\"7 proliferative\"))\n\n\nlabel_list &lt;- list(\"cap_pseudo_bulk\" = c(\"APOD\",\"S100A4\", \"S100A6\", \"KLF2\", \"CAVIN3\", \"ID2\",\n                                         \"ADAMTS5\", \"PLXNA2\", \"EPB41\", \"CD34\", \n                                         \"ANGPT2\"),\n                   \"coll_pseudo_bulk\" = c(\"CFD\",\"APOD\", \"ADAMTS5\", \"CCL2\", \"CCL21\"),\n                   \"valves_pseudo_bulk\" = c(\"ICAM1\", \"S100A4\",\"SOX18\",\"ID1\",\"SAMD4A\",\n                                            \"MFAP4\",\"HMOX1\",\"HBA2\",\"MEOX2\",\"HBA1\",\"TEX14\",\"SMAD5\",\"FN1\",\n                                            \"GALNT13\",\"CFH\",\"MGP\"),\n                   \"all\" = c(\"S100A4\", \"ADAMTS5\", \"COL5a2\", \"TAC3\",\"RBP1\",\"MFAP4\",\"MGAT4C\", \"MSR1\",\n                             \"NCALD\",\"GALNT13\",\"NPTX2\",\"SYT12\"))\n\nvalve_lab = c(\"NEO1\",\"ADAMTS1\",\"ADAMTS6\",\"CD24\",\"STC1\",\"GRP\",\"CCDC3\",\"ACKR3\",\n              \"RCAN1\",\"SEMA3D\",\"FGL2\",\"SLC12A2\",\"ADAMTS9\",\"ENOX1\",\"IGFBP2\",\n              \"SERPINB1\",\"CLDN11\",\"ANKRD55\",\"SCG3\",\"HGF\",\"HBA2\",\"ADM\",\"ANGPT2\",\n              \"CLU\",\"APOD\",\"GJA4\",\"FST\")"
  },
  {
    "objectID": "code/vis_de.html#visualizations",
    "href": "code/vis_de.html#visualizations",
    "title": "vis_de",
    "section": "",
    "text": "for (. in names(pb_de)) {\n    p &lt;- .volcano(df = pb_de[[.]], title = ., fdr = 0.05, lfc = 0.75, \n                  select_lab =label_list[[.]])\n    cat(\"####\", ., \"\\n\"); print(p); cat(\"\\n\\n\")\n}\n\ndup_ind &lt;-which(duplicated(pb_valve$gene_symbol))\npb_valve$gene_symbol[dup_ind] &lt;- paste0(pb_valve$full_gene_name[dup_ind], \n                                        \".\",  pb_valve$gene_symbol[dup_ind])\nrownames(pb_valve) &lt;- pb_valve$gene_symbol\np_val &lt;- .volcano(df = pb_valve, title = \"valve2 vs valve1\", fdr = 0.05, \n                  lfc = 0.75, select_lab = valve_lab)\ncat(\"####\", \"valve subgroups\", \"\\n\"); print(p_val); cat(\"\\n\\n\")\n\n\ncap_pseudo_bulkcoll_pseudo_bulkprecoll_pseudo_bulkvalves_pseudo_bulkallvalve subgroups\n\n\n\n\n\n\n\n\nWarning: ggrepel: 14 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\npb_valve$gene_symbol[duplicated(pb_valve$gene_symbol)] &lt;- paste0(\n  pb_valve$full_gene_name[duplicated(pb_valve$gene_symbol)], \".\",\n  pb_valve$gene_symbol[duplicated(pb_valve$gene_symbol)]\n)\n\nrownames(pb_valve) &lt;- pb_valve$gene_symbol\np_val &lt;- .volcano(df = pb_valve, title = \"valve2 vs valve1\", fdr = 0.05, \n                  lfc = 0.75, select_lab = valve_lab)\ncat(\"####\", \"valve subgroups\", \"\\n\"); print(p_val); cat(\"\\n\\n\")\n\n\n\n\n\n\n\n\n\n\n\nCode\nsummed &lt;- aggregateAcrossCells(sce, \n                               id=colData(sce)[,c(\"tissue\", \"ct_broad\", \"donor\")],\n                               use.assay.type = \"counts\")\n\nsummed &lt;- summed[,summed$ncells &gt;= 10]\nrownames(summed) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(summed))\n\n# subset res to de-genes\nde_list &lt;- lapply(pb_de, function(.){\n  top &lt;- as.data.frame(.) |&gt; \n      filter(FDR &lt; 0.01) |&gt; \n      slice_max(abs(logFC), n = 20)\n}) \n\ndrop_ind &lt;- which(sapply(de_list, nrow) &lt; 1)\ndrop_ind2 &lt;- which(names(de_list) %in% c(\"DEA\", \"all\"))\nde_gen_list &lt;- de_list[-c(drop_ind, drop_ind2)]\n\nfor (. in names(de_gen_list)) {\n    sub &lt;- summed[,colData(summed)$ct_broad %in% ct_nam[[.]]]\n    sub &lt;- sub[,order(sub$tissue)]\n    mtx_sub &lt;- log1p(assays(sub)[[\"counts\"]][rownames(de_gen_list[[.]]),])\n    colnames(mtx_sub) &lt;- paste0(\"pseudobulk_\", seq_along(1:ncol(sub)))\n    cd &lt;- data.frame(\"tissue\" = sub$tissue)\n    rownames(cd) &lt;- colnames(mtx_sub)\n    hm &lt;- pheatmap(mtx_sub, \n        main = ., fontsize = 6,\n        col = rev(hcl.colors(51, \"RdBu\")),\n        scale = \"row\", \n        show_colnames = FALSE,\n        cluster_cols = FALSE,\n        annotation_col = cd)\n    cat(\"####\", ., \"\\n\"); draw(hm); cat(\"\\n\\n\")\n}\n\n\n\ncap_pseudo_bulkprecoll_pseudo_bulkvalves_pseudo_bulkall\n\n\n\n\n\n\n\n\n\n\n\nsummed_all &lt;- aggregateAcrossCells(sce, \n                               id=colData(sce)[,c(\"tissue\", \"donor\")],\n                               use.assay.type = \"counts\")\n\nsummed_all &lt;- summed_all[,summed_all$ncells &gt;= 10]\nrownames(summed_all) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(summed_all))\n\n# subset res to de-genes\nde_all &lt;- as.data.frame(pb_all) |&gt; \n      filter(FDR &lt; 0.01) |&gt; \n      slice_max(abs(logFC), n = 20)\n\n\nsummed_all &lt;- summed_all[,order(summed_all$tissue)]\nmtx_all &lt;- log1p(counts(summed_all)[rownames(de_all),])\ncolnames(mtx_all) &lt;- paste0(\"pseudobulk_\", seq_along(1:ncol(summed_all)))\ncd &lt;- data.frame(\"tissue\" = summed_all$tissue,\n                 \"donor\" = summed_all$donor)\nrownames(cd) &lt;- colnames(mtx_all)\nhm &lt;- pheatmap(mtx_all, \n               main = \"all\", fontsize = 6,\n               col = rev(hcl.colors(51, \"RdBu\")),\n               scale = \"row\", \n               show_colnames = FALSE,\n               cluster_cols = FALSE,\n               annotation_col = cd)\n\ndraw(hm)\n\n\n\n\n\n\n\n\nupset_list &lt;- lapply(pb_de, function(de_res){\n  de_res &lt;- de_res |&gt; \n    filter(FDR &lt; 0.05 & abs(logFC) &gt; 0.75)\n  rownames(de_res)\n})\n\nupset(fromList(upset_list), order.by = \"freq\")\n\n\n\n\n\n\n\nupset_list &lt;- lapply(pb_de, function(de_res){\n  de_res &lt;- de_res |&gt; \n    filter(FDR &lt; 0.05)\n  rownames(de_res)\n})\n\nupset(fromList(upset_list), order.by = \"freq\")\n\n\n\n\n\n\n\n\n\nrownames(sce) &lt;- gsub(\"^.*\\\\.\",\"\",rownames(sce))\nsce_col &lt;- sce[,sce$ct_broad %in% \"collector\"]\nsce_col$ct_broad &lt;- sce_col$ct_broad |&gt; droplevels()\nsummed_col &lt;- summed[,summed$ct_broad %in% \"collector\"]\nsummed_col$ct_broad &lt;- summed_col$ct_broad |&gt; droplevels()\n\nplotExpression(sce_col, features=\"ACKR4\", \n    x=\"tissue\", colour_by=\"donor\")\n\n\n\nplotExpression(summed_col, features=\"ACKR4\", \n    x=\"tissue\", colour_by=\"donor\", exprs_values = \"counts\")"
  },
  {
    "objectID": "code/integration_n_clustering.html",
    "href": "code/integration_n_clustering.html",
    "title": "lec_flow_push",
    "section": "",
    "text": "import scanpy as sc\nimport numpy as np\nimport pandas as pd\nimport os\nimport scanorama\nfrom scipy import sparse, stats\n\nfrom matplotlib import pyplot as plt\nfrom matplotlib import colors\n\nfrom sklearn.decomposition import PCA\nfrom sklearn.preprocessing import StandardScaler, quantile_transform, maxabs_scale\nfrom sklearn.pipeline import Pipeline\n\nsc.settings.set_figure_params(\n    dpi=80,\n    facecolor=\"white\",\n    frameon=False,\n)\n\n\nadata = sc.read_h5ad(\"../output/0.2-sce-after-contamination-removal.h5ad\") # read adata\nadata.obs = adata.obs[['Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex']].astype(str) # take just the useful info\nsc.pp.calculate_qc_metrics(adata, inplace=True) # 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', etc...\nadata\n\nAnnData object with n_obs × n_vars = 21588 × 18627\n    obs: 'Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes'\n    var: 'ID', 'Symbol', 'Type', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts'\n    uns: 'X_name'\n    layers: 'logcounts'\n\n\n\n# cells stratification\n\nadata.obs.groupby([\"sequencing_run\", \"donor\", \"tissue_origin\", \"tissue\"])[[\"Barcode\"]].count().replace(0, np.nan).dropna().astype(int).to_csv(\"../output/1.0-cells_after_filtering.csv\")\nadata.obs.groupby([\"sequencing_run\", \"donor\", \"tissue_origin\", \"tissue\"])[[\"Barcode\"]].count().replace(0, np.nan).dropna().astype(int)\n\n\n\n\n\n\n\n\n\n\n\nBarcode\n\n\nsequencing_run\ndonor\ntissue_origin\ntissue\n\n\n\n\n\n1.0\n1.0\nabdomen\nfat\n158\n\n\nskin\n3784\n\n\n2.0\narm\nfat\n2794\n\n\n2.0\n3.0\nabdomen\nfat\n724\n\n\nskin\n540\n\n\n4.0\nabdomen\nfat\n49\n\n\nskin\n584\n\n\n3.0\n6.0\nabdomen\nfat\n1974\n\n\nskin\n1692\n\n\n7.0\nthigh\nfat\n1680\n\n\nskin\n2847\n\n\n4.0\n5.0\nabdomen\nmixed\n4762\n\n\n\n\n\n\n\n\n# standardize logcounts and pca\nadata.layers[\"logcounts.scaled\"] = sc.pp.scale(adata, zero_center=True, max_value=None, copy=True, layer=\"logcounts\").layers[\"logcounts\"]\nadata.obsm[\"logcounts.scaled.pca\"] = sc.pp.pca(adata.layers[\"logcounts.scaled\"], svd_solver=\"arpack\", n_comps=100)\n\n\n# first 2 PCs\nsc.pl.embedding(adata, basis=\"logcounts.scaled.pca\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n# compute the neighbors graph (using the PCA representation) and the UMAP embedding\n\nsc.pp.neighbors(adata, use_rep=\"logcounts.scaled.pca\", n_pcs=20, n_neighbors=10, key_added=\"logcounts.scaled.pca.neighbors\")\nadata.obsm[\"logcounts.scaled.pca.neighbors.umap\"] = sc.tl.umap(adata, neighbors_key=\"logcounts.scaled.pca.neighbors\", copy=True).obsm[\"X_umap\"]\nadata\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: The 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.\n  @numba.jit()\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: The 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.\n  @numba.jit()\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: The 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.\n  @numba.jit()\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: The 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.\n  @numba.jit()\n\n\nAnnData object with n_obs × n_vars = 21588 × 18627\n    obs: 'Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes'\n    var: 'ID', 'Symbol', 'Type', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts'\n    uns: 'X_name', 'donor_colors', 'sequencing_run_colors', 'tissue_origin_colors', 'tissue_colors', 'logcounts.scaled.pca.neighbors'\n    obsm: 'logcounts.scaled.pca', 'logcounts.scaled.pca.neighbors.umap'\n    layers: 'logcounts', 'logcounts.scaled'\n    obsp: 'logcounts.scaled.pca.neighbors_distances', 'logcounts.scaled.pca.neighbors_connectivities'\n\n\n\n# UMAP embedding\n\nsc.pl.embedding(adata, basis=\"logcounts.scaled.pca.neighbors.umap\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\nplt.hist(adata.obs.total_counts, bins=100)\nplt.xlabel(\"total count per cell\")\nplt.show()\n\n\n\n\n\nplt.hist(adata.obs.log1p_total_counts, bins=100)\nplt.xlabel(\"total log1p-count per cell\")\nplt.show()\n\n\n\n\n\nplt.hist(adata.var.total_counts, bins=100)\nplt.xlabel(\"total count per gene\")\nplt.show()\n\n\n\n\n\nplt.hist(adata.var.log1p_total_counts, bins=100)\nplt.xlabel(\"total log1p-count per gene\")\nplt.show()\n\n\n\n\n\n# zero-count cells, zero-count genes\n(adata.obs.total_counts==0).sum(), (adata.var.total_counts==0).sum()\n\n(0, 177)\n\n\n\n# select the HVGs using pearson method\n\npearson_hvgs = sc.experimental.pp.highly_variable_genes(adata, inplace=False, batch_key=\"donor\", layer=None, flavor=\"pearson_residuals\", n_top_genes=500)\npearson_hvgs\n\n\n\n\n\n\n\n\nmeans\nvariances\nresidual_variances\nhighly_variable_rank\nhighly_variable_nbatches\nhighly_variable_intersection\nhighly_variable\n\n\n\n\nENSG00000187634.SAMD11\n0.000973\n0.000972\n0.908626\nNaN\n0\nFalse\nFalse\n\n\nENSG00000188976.NOC2L\n0.042709\n0.049040\n1.066757\nNaN\n0\nFalse\nFalse\n\n\nENSG00000187961.KLHL17\n0.005420\n0.006224\n1.313732\nNaN\n0\nFalse\nFalse\n\n\nENSG00000187583.PLEKHN1\n0.001019\n0.001018\n0.832943\nNaN\n0\nFalse\nFalse\n\n\nENSG00000187642.PERM1\n0.000232\n0.000510\n0.522404\nNaN\n0\nFalse\nFalse\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n\n\nENSG00000271254.ENSG00000271254\n0.011349\n0.013074\n1.100826\nNaN\n0\nFalse\nFalse\n\n\nENSG00000276345.ENSG00000276345\n0.025246\n0.029983\n0.637354\nNaN\n0\nFalse\nFalse\n\n\nENSG00000276017.ENSG00000276017\n0.000046\n0.000046\n0.083079\nNaN\n0\nFalse\nFalse\n\n\nENSG00000278817.ENSG00000278817\n0.008894\n0.009093\n1.044582\nNaN\n0\nFalse\nFalse\n\n\nENSG00000277196.ENSG00000277196\n0.000139\n0.000139\n0.427159\nNaN\n0\nFalse\nFalse\n\n\n\n\n18627 rows × 7 columns\n\n\n\n\nplt.figure(figsize=(10,10))\nplt.colorbar(plt.scatter(\n    pearson_hvgs.means, pearson_hvgs.variances,\n    alpha=.5, s=pearson_hvgs.residual_variances*10, c=np.log1p(pearson_hvgs.residual_variances),\n    cmap=\"spring_r\"\n), label=\"log(residuals)\")\nplt.xscale(\"log\")\nplt.yscale(\"log\")\nplt.xlabel(\"mean\")\nplt.ylabel(\"variance\")\nplt.show()\n\n\n\n\n\nplt.figure(figsize=(10,10))\nplt.colorbar(plt.scatter(\n    pearson_hvgs.means, pearson_hvgs.variances,\n    alpha=.25, s=pearson_hvgs.residual_variances*10, c=pearson_hvgs.highly_variable_nbatches,\n    cmap=\"turbo\"\n), label=\"number of batches\")\nplt.xscale(\"log\")\nplt.yscale(\"log\")\nplt.xlabel(\"mean\")\nplt.ylabel(\"variance\")\nplt.show()\n\n\n\n\n\nplt.figure(figsize=(10,5))\n\nplt.title(\"How many genes are highly valiable in at least n batches?\")\n\nplt.plot(\n    np.arange(adata.obs.donor.nunique())+1,\n    (pearson_hvgs[[\"highly_variable_nbatches\"]].values &gt; np.arange(adata.obs.donor.nunique())[None,:]).sum(axis=0),\n    linewidth=5\n)\n\nplt.ylabel(\"n genes\")\nplt.xlabel(\"n batches\")\nplt.show()\n\n\n\n\n\n# reading the LECs population and subpopulation markers\n\nmarkers = pd.read_csv(\"../markers.csv\", header=None)\nmarkers.columns = [\"gene_ID\", \"population\", \"population_ID\", \"positive\", \"known\"]\nmarkers = markers.loc[markers.population.str.match(\".*LEC.*\")]\nmarkers[\"positive\"] = markers.positive==\"positive\"\nmarkers\n\n\n\n\n\n\n\n\ngene_ID\npopulation\npopulation_ID\npositive\nknown\n\n\n\n\n0\nENSG00000117707.PROX1\nLECs\nLEC\nTrue\nyes\n\n\n1\nENSG00000162493.PDPN\nLECs\nLEC\nTrue\nyes\n\n\n2\nENSG00000133800.LYVE1\ncapillary-LEC\ncpLEC\nTrue\nyes\n\n\n3\nENSG00000137077.CCL21\ncapillary-LEC\ncpLEC\nTrue\nyes\n\n\n4\nENSG00000189056.RELN\ncapillary-LEC\ncpLEC\nTrue\nyes\n\n\n5\nENSG00000129048.ACKR4\ncapillary-LEC\ncpLEC\nFalse\nyes\n\n\n6\nENSG00000108691.CCL2\ncapillary-LEC\ncpLEC\nFalse\nno\n\n\n7\nENSG00000081041.CXCL2\ncapillary-LEC\ncpLEC\nFalse\nno\n\n\n8\nENSG00000133800.LYVE1\nprecollector-LEC\npcLEC\nTrue\nyes\n\n\n9\nENSG00000137077.CCL21\nprecollector-LEC\npcLEC\nTrue\nyes\n\n\n10\nENSG00000189056.RELN\nprecollector-LEC\npcLEC\nTrue\nyes\n\n\n11\nENSG00000129048.ACKR4\nprecollector-LEC\npcLEC\nFalse\nyes\n\n\n12\nENSG00000108691.CCL2\nprecollector-LEC\npcLEC\nTrue\nno\n\n\n13\nENSG00000081041.CXCL2\nprecollector-LEC\npcLEC\nTrue\nno\n\n\n14\nENSG00000133800.LYVE1\ncollector-LEC\nclLEC\nFalse\nyes\n\n\n15\nENSG00000137077.CCL21\ncollector-LEC\nclLEC\nFalse\nyes\n\n\n16\nENSG00000189056.RELN\ncollector-LEC\nclLEC\nFalse\nyes\n\n\n17\nENSG00000129048.ACKR4\ncollector-LEC\nclLEC\nTrue\nyes\n\n\n18\nENSG00000108691.CCL2\ncollector-LEC\nclLEC\nTrue\nno\n\n\n19\nENSG00000081041.CXCL2\ncollector-LEC\nclLEC\nTrue\nno\n\n\n20\nENSG00000137077.CCL21\nvalve-LEC\nvLEC\nFalse\nyes\n\n\n21\nENSG00000133800.LYVE1\nvalve-LEC\nvLEC\nFalse\nyes\n\n\n22\nENSG00000013297.CLDN11\nvalve-LEC\nvLEC\nTrue\nyes\n\n\n23\nENSG00000272398.CD24\nvalve-LEC\nvLEC\nTrue\nno\n\n\n24\nENSG00000149564.ESAM\nvalve-LEC\nvLEC\nTrue\nno\n\n\n25\nENSG00000170017.ALCAM\nvalve-LEC\nvLEC\nTrue\nno\n\n\n34\nENSG00000090339.ICAM1\nLECs\nLEC\nTrue\n?\n\n\n35\nENSG00000103335.PIEZO1\nLECs\nLEC\nTrue\n?\n\n\n36\nENSG00000154864.PIEZO2\nLECs\nLEC\nTrue\n?\n\n\n\n\n\n\n\n\nplt.figure(figsize=(10, 5))\nplt.subplot(121)\nplt.hist(np.log10(adata.var.n_cells_by_counts +1), bins=100, density=True)\nplt.xlabel(\"gene log variance\")\nplt.ylabel(\"PDF\")\nplt.subplot(122)\nplt.hist(np.log10(adata.var.n_cells_by_counts +1), bins=100, density=True, cumulative=True)\nplt.xlabel(\"gene log variance\")\nplt.ylabel(\"CDF\")\nplt.show()\n\n\n\n\n\n# selecting genes highly variable in at least 2 batches and markers\n# (markers are not HVG, but we need them)\n\nselected_hvgs = pearson_hvgs[pearson_hvgs.highly_variable_nbatches&gt;=2].index.union(markers.gene_ID)\nselected_hvgs\n\nIndex(['ENSG00000003436.TFPI', 'ENSG00000004799.PDK4', 'ENSG00000005483.KMT2E',\n       'ENSG00000007908.SELE', 'ENSG00000008083.JARID2',\n       'ENSG00000008294.SPAG9', 'ENSG00000008405.CRY1', 'ENSG00000008517.IL32',\n       'ENSG00000008988.RPS20', 'ENSG00000009413.REV3L',\n       ...\n       'ENSG00000244694.PTCHD4', 'ENSG00000257987.TEX49',\n       'ENSG00000265972.TXNIP', 'ENSG00000266964.FXYD1',\n       'ENSG00000271503.CCL5', 'ENSG00000272398.CD24', 'ENSG00000276644.DACH1',\n       'ENSG00000284491.THSD8', 'ENSG00000288602.C8orf44-SGK3',\n       'ENSG00000291237.SOD2'],\n      dtype='object', length=675)\n\n\n\nadata.var[\"selected\"] = adata.var.index.isin(selected_hvgs)\nadata.var\n\n\n\n\n\n\n\n\nID\nSymbol\nType\nn_cells_by_counts\nmean_counts\nlog1p_mean_counts\npct_dropout_by_counts\ntotal_counts\nlog1p_total_counts\nselected\n\n\n\n\nENSG00000187634.SAMD11\nENSG00000187634\nSAMD11\nGene Expression\n21\n0.000973\n0.000972\n99.902724\n21.0\n3.091042\nFalse\n\n\nENSG00000188976.NOC2L\nENSG00000188976\nNOC2L\nGene Expression\n850\n0.042709\n0.041822\n96.062627\n922.0\n6.827629\nFalse\n\n\nENSG00000187961.KLHL17\nENSG00000187961\nKLHL17\nGene Expression\n108\n0.005420\n0.005405\n99.499722\n117.0\n4.770685\nFalse\n\n\nENSG00000187583.PLEKHN1\nENSG00000187583\nPLEKHN1\nGene Expression\n22\n0.001019\n0.001019\n99.898092\n22.0\n3.135494\nFalse\n\n\nENSG00000187642.PERM1\nENSG00000187642\nPERM1\nGene Expression\n3\n0.000232\n0.000232\n99.986103\n5.0\n1.791759\nFalse\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\nENSG00000271254.ENSG00000271254\nENSG00000271254\nENSG00000271254\nGene Expression\n226\n0.011349\n0.011285\n98.953122\n245.0\n5.505332\nFalse\n\n\nENSG00000276345.ENSG00000276345\nENSG00000276345\nENSG00000276345\nGene Expression\n491\n0.025246\n0.024932\n97.725588\n545.0\n6.302619\nFalse\n\n\nENSG00000276017.ENSG00000276017\nENSG00000276017\nENSG00000276017\nGene Expression\n1\n0.000046\n0.000046\n99.995368\n1.0\n0.693147\nFalse\n\n\nENSG00000278817.ENSG00000278817\nENSG00000278817\nENSG00000278817\nGene Expression\n189\n0.008894\n0.008855\n99.124514\n192.0\n5.262690\nFalse\n\n\nENSG00000277196.ENSG00000277196\nENSG00000277196\nENSG00000277196\nGene Expression\n3\n0.000139\n0.000139\n99.986103\n3.0\n1.386294\nFalse\n\n\n\n\n18627 rows × 10 columns\n\n\n\n\n# now working just on the HVGs\n\nadata_hvgs = adata[:,adata.var.selected].copy()\nsc.pp.calculate_qc_metrics(adata_hvgs, inplace=True)\nadata_hvgs\n\nAnnData object with n_obs × n_vars = 21588 × 661\n    obs: 'Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes'\n    var: 'ID', 'Symbol', 'Type', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts', 'selected'\n    uns: 'X_name', 'donor_colors', 'sequencing_run_colors', 'tissue_origin_colors', 'tissue_colors', 'logcounts.scaled.pca.neighbors'\n    obsm: 'logcounts.scaled.pca', 'logcounts.scaled.pca.neighbors.umap'\n    layers: 'logcounts', 'logcounts.scaled'\n    obsp: 'logcounts.scaled.pca.neighbors_distances', 'logcounts.scaled.pca.neighbors_connectivities'\n\n\n\nsc.pl.violin(adata_hvgs, ['n_genes_by_counts', 'total_counts'], jitter=0.4, multi_panel=True, log=True)\n\n\n\n\n\nplt.figure(figsize=(10, 5))\nplt.subplot(121)\nplt.hist(np.log10(adata_hvgs.var.n_cells_by_counts), bins=100, density=True)\nplt.xlabel(\"gene log variance\")\nplt.ylabel(\"PDF\")\nplt.subplot(122)\nplt.hist(np.log10(adata_hvgs.var.n_cells_by_counts), bins=100, density=True, cumulative=True)\nplt.xlabel(\"gene log variance\")\nplt.ylabel(\"CDF\")\nplt.show()\n\n\n\n\n\n# HVGs PCA explained variance\n\npca = PCA(svd_solver=\"full\").fit(adata_hvgs.layers[\"logcounts.scaled\"])\nplt.plot(np.cumsum(pca.explained_variance_ratio_))\nplt.show()\nplt.plot(pca.explained_variance_ratio_)\nplt.show()\n\n\n\n\n\n\n\n\nplt.plot(pca.explained_variance_ratio_[:50])\n\n\n\n\n\n# recompute PCA, neighbors and UMAP just on HVGs\n\nadata_hvgs.obsm[\"logcounts.scaled.pca\"] = sc.pp.pca(adata_hvgs.layers[\"logcounts.scaled\"], svd_solver=\"arpack\", n_comps=100)\nsc.pp.neighbors(adata_hvgs, use_rep=\"logcounts.scaled.pca\", n_pcs=100, n_neighbors=25, key_added=\"logcounts.scaled.pca.neighbors\")\nadata_hvgs.obsm[\"logcounts.scaled.pca.neighbors.umap\"] = sc.tl.umap(adata_hvgs, neighbors_key=\"logcounts.scaled.pca.neighbors\", copy=True).obsm[\"X_umap\"]\nadata_hvgs\n\nAnnData object with n_obs × n_vars = 21588 × 661\n    obs: 'Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes'\n    var: 'ID', 'Symbol', 'Type', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts', 'selected'\n    uns: 'X_name', 'donor_colors', 'sequencing_run_colors', 'tissue_origin_colors', 'tissue_colors', 'logcounts.scaled.pca.neighbors'\n    obsm: 'logcounts.scaled.pca', 'logcounts.scaled.pca.neighbors.umap'\n    layers: 'logcounts', 'logcounts.scaled'\n    obsp: 'logcounts.scaled.pca.neighbors_distances', 'logcounts.scaled.pca.neighbors_connectivities'\n\n\n\n# 2 PCs\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n# UMAP\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca.neighbors.umap\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n# scanorama intergation\n\n_out_scanorama = scanorama.correct(\n    [adata_hvgs[adata_hvgs.obs.donor==donor].copy().layers[\"logcounts.scaled\"] for donor in adata_hvgs.obs.donor.unique()],\n    genes_list = [adata_hvgs.var.index.to_list()]*adata_hvgs.obs.donor.nunique(),\n    return_dimred=True, knn=40, sigma=20 # hyperparameters: knn, sigma\n)\n_out_scanorama\n\nFound 661 genes among all datasets\n[[0.         0.81853973 0.66376582 0.67298578 0.57528642 0.32293252\n  0.25418569]\n [0.         0.         0.80300633 0.28909953 0.24194703 0.43450251\n  0.26986399]\n [0.         0.         0.         0.63507109 0.65743671 0.8568038\n  0.56566456]\n [0.         0.         0.         0.         0.78515008 0.72511848\n  0.56398104]\n [0.         0.         0.         0.         0.         0.84260775\n  0.90507365]\n [0.         0.         0.         0.         0.         0.\n  0.94057875]\n [0.         0.         0.         0.         0.         0.\n  0.        ]]\nProcessing datasets (5, 6)\nProcessing datasets (4, 6)\nProcessing datasets (2, 5)\nProcessing datasets (4, 5)\nProcessing datasets (0, 1)\nProcessing datasets (1, 2)\nProcessing datasets (3, 4)\nProcessing datasets (3, 5)\nProcessing datasets (0, 3)\nProcessing datasets (0, 2)\nProcessing datasets (2, 4)\nProcessing datasets (2, 3)\nProcessing datasets (0, 4)\nProcessing datasets (2, 6)\nProcessing datasets (3, 6)\nProcessing datasets (1, 5)\nProcessing datasets (0, 5)\nProcessing datasets (1, 3)\nProcessing datasets (1, 6)\nProcessing datasets (0, 6)\nProcessing datasets (1, 4)\n\n\n([array([[ 0.15499599,  0.06518975, -0.01299546, ...,  0.02788879,\n          -0.03987133, -0.00690037],\n         [-0.29755602,  0.19157411,  0.13257315, ...,  0.0442807 ,\n          -0.00492444, -0.01317647],\n         [-0.22754984,  0.0381117 ,  0.05283327, ..., -0.00977411,\n           0.0061749 ,  0.01003503],\n         ...,\n         [ 0.14433898,  0.2337615 , -0.00384419, ...,  0.11232922,\n           0.00169593,  0.0090357 ],\n         [-0.24651929, -0.01847732, -0.00705104, ..., -0.03045652,\n           0.00324885,  0.04252008],\n         [-0.01052221,  0.0394253 , -0.01300106, ..., -0.03162768,\n           0.01625904, -0.01664504]]),\n  array([[-0.06234173, -0.06557873,  0.04186698, ...,  0.04546896,\n           0.04436917, -0.00609741],\n         [-0.2686676 ,  0.0521724 ,  0.06564512, ..., -0.02829906,\n           0.00054603,  0.01064134],\n         [-0.09798006,  0.11487086,  0.02689218, ...,  0.0173614 ,\n          -0.06372137, -0.01508645],\n         ...,\n         [-0.15823784, -0.14843606,  0.01756423, ..., -0.01177048,\n           0.00510066,  0.02638219],\n         [-0.32701807,  0.12204812,  0.07459577, ..., -0.01325339,\n          -0.00540898,  0.00482282],\n         [-0.28177148, -0.03915433,  0.06508979, ..., -0.02300479,\n           0.01643855, -0.01600262]]),\n  array([[ 0.15855013,  0.00203635,  0.19450258, ...,  0.01839163,\n          -0.01763088,  0.0244716 ],\n         [-0.1931036 , -0.03984173,  0.08583574, ..., -0.00956667,\n          -0.00171763,  0.04041452],\n         [-0.07287734, -0.17525359, -0.0844985 , ...,  0.00575027,\n           0.01310534,  0.0294322 ],\n         ...,\n         [-0.11932868,  0.07481472,  0.09818116, ...,  0.02770809,\n           0.00372633, -0.00687399],\n         [ 0.09159832,  0.17031501, -0.18619418, ...,  0.04626286,\n          -0.01744314,  0.07969091],\n         [ 0.51540154,  0.18906866,  0.07322843, ...,  0.01877629,\n          -0.00865021,  0.02807046]]),\n  array([[ 0.35435499,  0.18952807,  0.0521938 , ...,  0.02130831,\n          -0.003861  , -0.00726706],\n         [ 0.05861867, -0.20627038,  0.01610541, ...,  0.02774822,\n          -0.0147005 ,  0.02692575],\n         [ 0.30071941, -0.03627409,  0.09865203, ...,  0.03162814,\n           0.02063437, -0.01746373],\n         ...,\n         [ 0.06761111,  0.03725269,  0.042627  , ...,  0.02982114,\n          -0.02569161, -0.01255272],\n         [ 0.14553303,  0.16727045, -0.12152161, ...,  0.00094646,\n           0.02357648,  0.01319848],\n         [-0.11781027,  0.03118317, -0.03845329, ..., -0.02707633,\n          -0.04831128,  0.03119572]]),\n  array([[ 0.09529602, -0.04811884, -0.01376854, ..., -0.05904311,\n          -0.0358609 , -0.02399296],\n         [ 0.08800763,  0.18083561, -0.05354871, ..., -0.00443724,\n          -0.04889987,  0.00621034],\n         [-0.00214632, -0.15293116,  0.00732098, ..., -0.0110359 ,\n          -0.00411143, -0.01476358],\n         ...,\n         [ 0.33108737,  0.24439312,  0.15594851, ..., -0.03048401,\n          -0.01337788,  0.03782634],\n         [ 0.05147973,  0.05133062, -0.02328434, ...,  0.0155306 ,\n           0.04861371, -0.01319355],\n         [ 0.08537502, -0.12033448, -0.05204537, ..., -0.02703678,\n          -0.06020824,  0.02002191]]),\n  array([[-0.15713895,  0.1629033 ,  0.02856795, ..., -0.00108895,\n           0.00348774, -0.02131382],\n         [ 0.51057405,  0.07136083,  0.20390466, ...,  0.01064401,\n          -0.00794195, -0.00721427],\n         [ 0.1781464 , -0.05422093, -0.02037077, ...,  0.03953636,\n          -0.0009756 ,  0.03721557],\n         ...,\n         [ 0.02867076,  0.18376819, -0.17998279, ...,  0.01210207,\n           0.02445995, -0.03547943],\n         [-0.03821302,  0.18921294, -0.11779424, ..., -0.06068977,\n           0.0230536 , -0.01822293],\n         [ 0.10820627, -0.09501749, -0.02832867, ...,  0.03718959,\n          -0.00985695, -0.00255919]]),\n  array([[ 0.35163479, -0.09545828, -0.03182212, ...,  0.03719322,\n          -0.07762674, -0.01355305],\n         [ 0.04723867, -0.08516124,  0.00125534, ..., -0.00996006,\n          -0.01649926,  0.0217293 ],\n         [ 0.16606219,  0.14966646, -0.18417494, ..., -0.00180196,\n          -0.03255265, -0.01700102],\n         ...,\n         [ 0.44644608,  0.21265846, -0.01797266, ...,  0.03048696,\n          -0.01499321,  0.00058349],\n         [-0.27040636,  0.11308834,  0.17384138, ..., -0.07102673,\n          -0.0418337 , -0.00358643],\n         [ 0.0762948 , -0.06536989,  0.17216896, ...,  0.06715966,\n          -0.05500113, -0.01419761]])],\n [&lt;3942x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 2605662 stored elements in Compressed Sparse Row format&gt;,\n  &lt;2794x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 1846834 stored elements in Compressed Sparse Row format&gt;,\n  &lt;1264x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 835504 stored elements in Compressed Sparse Row format&gt;,\n  &lt;633x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 418413 stored elements in Compressed Sparse Row format&gt;,\n  &lt;3666x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 2423226 stored elements in Compressed Sparse Row format&gt;,\n  &lt;4527x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 2992347 stored elements in Compressed Sparse Row format&gt;,\n  &lt;4762x661 sparse matrix of type '&lt;class 'numpy.float64'&gt;'\n    with 3147682 stored elements in Compressed Sparse Row format&gt;],\n array(['ENSG00000003436.TFPI', 'ENSG00000004799.PDK4',\n        'ENSG00000005483.KMT2E', 'ENSG00000007908.SELE',\n        'ENSG00000008083.JARID2', 'ENSG00000008294.SPAG9',\n        'ENSG00000008405.CRY1', 'ENSG00000008517.IL32',\n        'ENSG00000008988.RPS20', 'ENSG00000009413.REV3L',\n        'ENSG00000010278.CD9', 'ENSG00000010803.SCMH1',\n        'ENSG00000010818.HIVEP2', 'ENSG00000011114.BTBD7',\n        'ENSG00000011465.DCN', 'ENSG00000011600.TYROBP',\n        'ENSG00000013297.CLDN11', 'ENSG00000017427.IGF1',\n        'ENSG00000018408.WWTR1', 'ENSG00000019582.CD74',\n        'ENSG00000019991.HGF', 'ENSG00000020577.SAMD4A',\n        'ENSG00000021355.SERPINB1', 'ENSG00000021645.NRXN3',\n        'ENSG00000023445.BIRC3', 'ENSG00000026025.VIM',\n        'ENSG00000026508.CD44', 'ENSG00000033867.SLC4A7',\n        'ENSG00000034510.TMSB10', 'ENSG00000038295.TLL1',\n        'ENSG00000038382.TRIO', 'ENSG00000038945.MSR1',\n        'ENSG00000041982.TNC', 'ENSG00000043462.LCP2',\n        'ENSG00000047617.ANO2', 'ENSG00000048740.CELF2',\n        'ENSG00000049192.ADAMTS6', 'ENSG00000058085.LAMC2',\n        'ENSG00000059758.CDK17', 'ENSG00000059804.SLC2A3',\n        'ENSG00000060140.STYK1', 'ENSG00000063177.RPL18',\n        'ENSG00000064651.SLC12A2', 'ENSG00000064989.CALCRL',\n        'ENSG00000067082.KLF6', 'ENSG00000067113.PLPP1',\n        'ENSG00000067141.NEO1', 'ENSG00000067715.SYT1',\n        'ENSG00000067798.NAV3', 'ENSG00000069667.RORA',\n        'ENSG00000071205.ARHGAP10', 'ENSG00000073756.PTGS2',\n        'ENSG00000073921.PICALM', 'ENSG00000074181.NOTCH3',\n        'ENSG00000074527.NTN4', 'ENSG00000075213.SEMA3A',\n        'ENSG00000075391.RASAL2', 'ENSG00000075420.FNDC3B',\n        'ENSG00000075624.ACTB', 'ENSG00000076706.MCAM',\n        'ENSG00000077522.ACTN2', 'ENSG00000077942.FBLN1',\n        'ENSG00000078269.SYNJ2', 'ENSG00000078401.EDN1',\n        'ENSG00000080824.HSP90AA1', 'ENSG00000081041.CXCL2',\n        'ENSG00000084112.SSH1', 'ENSG00000085276.MECOM',\n        'ENSG00000086061.DNAJA1', 'ENSG00000086619.ERO1B',\n        'ENSG00000087086.FTL', 'ENSG00000089009.RPL6',\n        'ENSG00000090104.RGS1', 'ENSG00000090339.ICAM1',\n        'ENSG00000090905.TNRC6A', 'ENSG00000091879.ANGPT2',\n        'ENSG00000091986.CCDC80', 'ENSG00000092841.MYL6',\n        'ENSG00000092969.TGFB2', 'ENSG00000095637.SORBS1',\n        'ENSG00000095951.HIVEP1', 'ENSG00000096384.HSP90AB1',\n        'ENSG00000099250.NRP1', 'ENSG00000099260.PALMD',\n        'ENSG00000099860.GADD45B', 'ENSG00000100097.LGALS1',\n        'ENSG00000100191.SLC5A4', 'ENSG00000100234.TIMP3',\n        'ENSG00000100292.HMOX1', 'ENSG00000100311.PDGFB',\n        'ENSG00000100906.NFKBIA', 'ENSG00000101004.NINL',\n        'ENSG00000101096.NFATC2', 'ENSG00000101335.MYL9',\n        'ENSG00000101439.CST3', 'ENSG00000102003.SYP',\n        'ENSG00000102053.ZC3H12B', 'ENSG00000102265.TIMP1',\n        'ENSG00000102271.KLHL4', 'ENSG00000102547.CAB39L',\n        'ENSG00000102755.FLT1', 'ENSG00000102760.RGCC',\n        'ENSG00000102786.INTS6', 'ENSG00000102908.NFAT5',\n        'ENSG00000103196.CRISPLD2', 'ENSG00000103335.PIEZO1',\n        'ENSG00000104112.SCG3', 'ENSG00000104368.PLAT',\n        'ENSG00000105372.RPS19', 'ENSG00000105640.RPL18A',\n        'ENSG00000105697.HAMP', 'ENSG00000105810.CDK6',\n        'ENSG00000105835.NAMPT', 'ENSG00000105889.STEAP1B',\n        'ENSG00000105974.CAV1', 'ENSG00000106211.HSPB1',\n        'ENSG00000106305.AIMP2', 'ENSG00000106366.SERPINE1',\n        'ENSG00000106511.MEOX2', 'ENSG00000106665.CLIP2',\n        'ENSG00000107249.GLIS3', 'ENSG00000107317.PTGDS',\n        'ENSG00000107562.CXCL12', 'ENSG00000107796.ACTA2',\n        'ENSG00000108107.RPL28', 'ENSG00000108298.RPL19',\n        'ENSG00000108342.CSF3', 'ENSG00000108691.CCL2',\n        'ENSG00000109320.NFKB1', 'ENSG00000109321.AREG',\n        'ENSG00000109436.TBC1D9', 'ENSG00000109475.RPL34',\n        'ENSG00000109756.RAPGEF2', 'ENSG00000109846.CRYAB',\n        'ENSG00000110492.MDK', 'ENSG00000110700.RPS13',\n        'ENSG00000110841.PPFIBP1', 'ENSG00000110848.CD69',\n        'ENSG00000110852.CLEC2B', 'ENSG00000111057.KRT18',\n        'ENSG00000111341.MGP', 'ENSG00000111404.RERGL',\n        'ENSG00000111640.GAPDH', 'ENSG00000111885.MAN1A1',\n        'ENSG00000111962.UST', 'ENSG00000112306.RPS12',\n        'ENSG00000112531.QKI', 'ENSG00000112851.ERBIN',\n        'ENSG00000113273.ARSB', 'ENSG00000113448.PDE4D',\n        'ENSG00000113810.SMC4', 'ENSG00000114315.HES1',\n        'ENSG00000114423.CBLB', 'ENSG00000114480.GBE1',\n        'ENSG00000115252.PDE1A', 'ENSG00000115268.RPS15',\n        'ENSG00000115380.EFEMP1', 'ENSG00000115414.FN1',\n        'ENSG00000115419.GLS', 'ENSG00000115457.IGFBP2',\n        'ENSG00000115461.IGFBP5', 'ENSG00000115738.ID2',\n        'ENSG00000115758.ODC1', 'ENSG00000115963.RND3',\n        'ENSG00000116117.PARD3B', 'ENSG00000116132.PRRX1',\n        'ENSG00000116741.RGS2', 'ENSG00000117318.ID3',\n        'ENSG00000117461.PIK3R3', 'ENSG00000117707.PROX1',\n        'ENSG00000117724.CENPF', 'ENSG00000118217.ATF6',\n        'ENSG00000118473.SGIP1', 'ENSG00000118503.TNFAIP3',\n        'ENSG00000118515.SGK1', 'ENSG00000118523.CCN2',\n        'ENSG00000118596.SLC16A7', 'ENSG00000118689.FOXO3',\n        'ENSG00000118985.ELL2', 'ENSG00000119771.KLHL29',\n        'ENSG00000120129.DUSP1', 'ENSG00000120278.PLEKHG1',\n        'ENSG00000120594.PLXDC2', 'ENSG00000120658.ENOX1',\n        'ENSG00000120694.HSPH1', 'ENSG00000120738.EGR1',\n        'ENSG00000120885.CLU', 'ENSG00000121101.TEX14',\n        'ENSG00000121966.CXCR4', 'ENSG00000122026.RPL21',\n        'ENSG00000122254.HS3ST2', 'ENSG00000122591.FAM126A',\n        'ENSG00000122644.ARL4A', 'ENSG00000122691.TWIST1',\n        'ENSG00000122862.SRGN', 'ENSG00000123358.NR4A1',\n        'ENSG00000123416.TUBA1B', 'ENSG00000123610.TNFAIP6',\n        'ENSG00000123689.G0S2', 'ENSG00000123700.KCNJ2',\n        'ENSG00000124172.ATP5F1E', 'ENSG00000124762.CDKN1A',\n        'ENSG00000124766.SOX4', 'ENSG00000124935.SCGB1D2',\n        'ENSG00000125148.MT2A', 'ENSG00000125257.ABCC4',\n        'ENSG00000125347.IRF1', 'ENSG00000125691.RPL23',\n        'ENSG00000125730.C3', 'ENSG00000125740.FOSB',\n        'ENSG00000125868.DSTN', 'ENSG00000125968.ID1',\n        'ENSG00000126583.PRKCG', 'ENSG00000126709.IFI6',\n        'ENSG00000126785.RHOJ', 'ENSG00000127528.KLF2',\n        'ENSG00000127920.GNG11', 'ENSG00000127951.FGL2',\n        'ENSG00000127954.STEAP4', 'ENSG00000128016.ZFP36',\n        'ENSG00000128573.FOXP2', 'ENSG00000129048.ACKR4',\n        'ENSG00000129538.RNASE1', 'ENSG00000129682.FGF13',\n        'ENSG00000130066.SAT1', 'ENSG00000130203.APOE',\n        'ENSG00000130255.RPL36', 'ENSG00000130300.PLVAP',\n        'ENSG00000130303.BST2', 'ENSG00000130304.SLC27A1',\n        'ENSG00000130449.ZSWIM6', 'ENSG00000130513.GDF15',\n        'ENSG00000130522.JUND', 'ENSG00000131016.AKAP12',\n        'ENSG00000131018.SYNE1', 'ENSG00000131477.RAMP2',\n        'ENSG00000132002.DNAJB1', 'ENSG00000132003.ZSWIM4',\n        'ENSG00000132386.SERPINF1', 'ENSG00000132466.ANKRD17',\n        'ENSG00000132475.H3-3B', 'ENSG00000132965.ALOX5AP',\n        'ENSG00000133065.SLC41A1', 'ENSG00000133110.POSTN',\n        'ENSG00000133112.TPT1', 'ENSG00000133316.WDR74',\n        'ENSG00000133392.MYH11', 'ENSG00000133454.MYO18B',\n        'ENSG00000133636.NTS', 'ENSG00000133687.TMTC1',\n        'ENSG00000133800.LYVE1', 'ENSG00000133805.AMPD3',\n        'ENSG00000133962.CATSPERB', 'ENSG00000134215.VAV3',\n        'ENSG00000134245.WNT2B', 'ENSG00000134294.SLC38A2',\n        'ENSG00000134363.FST', 'ENSG00000134419.RPS15A',\n        'ENSG00000134443.GRP', 'ENSG00000134531.EMP1',\n        'ENSG00000134532.SOX5', 'ENSG00000134533.RERG',\n        'ENSG00000134539.KLRD1', 'ENSG00000135046.ANXA1',\n        'ENSG00000135048.CEMIP2', 'ENSG00000135218.CD36',\n        'ENSG00000135346.CGA', 'ENSG00000135480.KRT7',\n        'ENSG00000135540.NHSL1', 'ENSG00000135828.RNASEL',\n        'ENSG00000135862.LAMC1', 'ENSG00000135905.DOCK10',\n        'ENSG00000136011.STAB2', 'ENSG00000136156.ITM2B',\n        'ENSG00000136244.IL6', 'ENSG00000136810.TXN',\n        'ENSG00000136826.KLF4', 'ENSG00000136997.MYC',\n        'ENSG00000137075.RNF38', 'ENSG00000137077.CCL21',\n        'ENSG00000137154.RPS6', 'ENSG00000137331.IER3',\n        'ENSG00000137801.THBS1', 'ENSG00000137818.RPLP1',\n        'ENSG00000138081.FBXO11', 'ENSG00000138135.CH25H',\n        'ENSG00000138326.RPS24', 'ENSG00000138378.STAT4',\n        'ENSG00000138411.HECW2', 'ENSG00000138448.ITGAV',\n        'ENSG00000138639.ARHGAP24', 'ENSG00000138722.MMRN1',\n        'ENSG00000138780.GSTCD', 'ENSG00000138795.LEF1',\n        'ENSG00000139144.PIK3C2G', 'ENSG00000139160.ETFBKMT',\n        'ENSG00000139318.DUSP6', 'ENSG00000139329.LUM',\n        'ENSG00000139946.PELI2', 'ENSG00000140945.CDH13',\n        'ENSG00000140988.RPS2', 'ENSG00000141506.PIK3R5',\n        'ENSG00000142089.IFITM3', 'ENSG00000142207.URB1',\n        'ENSG00000142599.RERE', 'ENSG00000142676.RPL11',\n        'ENSG00000142871.CCN1', 'ENSG00000142937.RPS8',\n        'ENSG00000143196.DPT', 'ENSG00000143248.RGS5',\n        'ENSG00000143333.RGS16', 'ENSG00000143341.HMCN1',\n        'ENSG00000143947.RPS27A', 'ENSG00000144278.GALNT13',\n        'ENSG00000144476.ACKR3', 'ENSG00000144619.CNTN4',\n        'ENSG00000144642.RBMS3', 'ENSG00000144668.ITGA9',\n        'ENSG00000144713.RPL32', 'ENSG00000144724.PTPRG',\n        'ENSG00000144824.PHLDB2', 'ENSG00000145147.SLIT2',\n        'ENSG00000145425.RPS3A', 'ENSG00000145569.OTULINL',\n        'ENSG00000145592.RPL37', 'ENSG00000145687.SSBP2',\n        'ENSG00000145819.ARHGAP26', 'ENSG00000145824.CXCL14',\n        'ENSG00000146426.TIAM2', 'ENSG00000146592.CREB5',\n        'ENSG00000146648.EGFR', 'ENSG00000147403.RPL10',\n        'ENSG00000147459.DOCK5', 'ENSG00000148053.NTRK2',\n        'ENSG00000148498.PARD3', 'ENSG00000148516.ZEB1',\n        'ENSG00000148655.LRMDA', 'ENSG00000148671.ADIRF',\n        'ENSG00000148773.MKI67', 'ENSG00000148926.ADM',\n        'ENSG00000149100.EIF3M', 'ENSG00000149273.RPS3',\n        'ENSG00000149564.ESAM', 'ENSG00000149591.TAGLN',\n        'ENSG00000149806.FAU', 'ENSG00000150054.MPP7',\n        'ENSG00000150625.GPM6A', 'ENSG00000150672.DLG2',\n        'ENSG00000150907.FOXO1', 'ENSG00000150991.UBC',\n        'ENSG00000151276.MAGI1', 'ENSG00000151322.NPAS3',\n        'ENSG00000151468.CCDC3', 'ENSG00000151491.EPS8',\n        'ENSG00000151632.AKR1C2', 'ENSG00000151746.BICD1',\n        'ENSG00000151789.ZNF385D', 'ENSG00000151914.DST',\n        'ENSG00000152413.HOMER1', 'ENSG00000152518.ZFP36L2',\n        'ENSG00000152583.SPARCL1', 'ENSG00000152601.MBNL1',\n        'ENSG00000152818.UTRN', 'ENSG00000152894.PTPRK',\n        'ENSG00000152953.STK32B', 'ENSG00000153283.CD96',\n        'ENSG00000153317.ASAP1', 'ENSG00000153721.CNKSR3',\n        'ENSG00000153993.SEMA3D', 'ENSG00000154122.ANKH',\n        'ENSG00000154217.PITPNC1', 'ENSG00000154330.PGM5',\n        'ENSG00000154556.SORBS2', 'ENSG00000154645.CHODL',\n        'ENSG00000154734.ADAMTS1', 'ENSG00000154736.ADAMTS5',\n        'ENSG00000154864.PIEZO2', 'ENSG00000155657.TTN',\n        'ENSG00000155849.ELMO1', 'ENSG00000155886.SLC24A2',\n        'ENSG00000156049.GNA14', 'ENSG00000156140.ADAMTS3',\n        'ENSG00000156482.RPL30', 'ENSG00000156508.EEF1A1',\n        'ENSG00000156639.ZFAND3', 'ENSG00000157168.NRG1',\n        'ENSG00000157483.MYO1E', 'ENSG00000157540.DYRK1A',\n        'ENSG00000157654.PALM2AKAP2', 'ENSG00000157764.BRAF',\n        'ENSG00000157827.FMNL2', 'ENSG00000158050.DUSP2',\n        'ENSG00000158321.AUTS2', 'ENSG00000158859.ADAMTS4',\n        'ENSG00000158869.FCER1G', 'ENSG00000159167.STC1',\n        'ENSG00000159200.RCAN1', 'ENSG00000159713.TPPP3',\n        'ENSG00000160145.KALRN', 'ENSG00000160180.TFF3',\n        'ENSG00000160584.SIK3', 'ENSG00000160789.LMNA',\n        'ENSG00000160888.IER2', 'ENSG00000161011.SQSTM1',\n        'ENSG00000161016.RPL8', 'ENSG00000161970.RPL26',\n        'ENSG00000162244.RPL29', 'ENSG00000162267.ITIH3',\n        'ENSG00000162493.PDPN', 'ENSG00000162510.MATN1',\n        'ENSG00000162618.ADGRL4', 'ENSG00000162687.KCNT2',\n        'ENSG00000162772.ATF3', 'ENSG00000163191.S100A11',\n        'ENSG00000163273.NPPC', 'ENSG00000163359.COL6A3',\n        'ENSG00000163453.IGFBP7', 'ENSG00000163492.CCDC141',\n        'ENSG00000163638.ADAMTS9', 'ENSG00000163661.PTX3',\n        'ENSG00000163682.RPL9', 'ENSG00000163687.DNASE1L3',\n        'ENSG00000163734.CXCL3', 'ENSG00000163739.CXCL1',\n        'ENSG00000163815.CLEC3B', 'ENSG00000163964.PIGX',\n        'ENSG00000164032.H2AZ1', 'ENSG00000164056.SPRY1',\n        'ENSG00000164116.GUCY1A1', 'ENSG00000164176.EDIL3',\n        'ENSG00000164442.CITED2', 'ENSG00000164512.ANKRD55',\n        'ENSG00000164587.RPS14', 'ENSG00000164687.FABP5',\n        'ENSG00000164692.COL1A2', 'ENSG00000164736.SOX17',\n        'ENSG00000164949.GEM', 'ENSG00000165124.SVEP1',\n        'ENSG00000165309.ARMC3', 'ENSG00000165379.LRFN5',\n        'ENSG00000165507.DEPP1', 'ENSG00000165714.BORCS5',\n        'ENSG00000165810.BTNL9', 'ENSG00000165949.IFI27',\n        'ENSG00000166105.GLB1L3', 'ENSG00000166441.RPL27A',\n        'ENSG00000166482.MFAP4', 'ENSG00000166592.RRAD',\n        'ENSG00000166598.HSP90B1', 'ENSG00000166710.B2M',\n        'ENSG00000166741.NNMT', 'ENSG00000166833.NAV2',\n        'ENSG00000166974.MAPRE2', 'ENSG00000167081.PBX3',\n        'ENSG00000167244.IGF2', 'ENSG00000167526.RPL13',\n        'ENSG00000167552.TUBA1A', 'ENSG00000167693.NXN',\n        'ENSG00000167779.IGFBP6', 'ENSG00000167996.FTH1',\n        'ENSG00000168209.DDIT4', 'ENSG00000168386.FILIP1L',\n        'ENSG00000168497.CAVIN2', 'ENSG00000168509.HJV',\n        'ENSG00000168542.COL3A1', 'ENSG00000168675.LDLRAD4',\n        'ENSG00000169126.ODAD2', 'ENSG00000169282.KCNAB1',\n        'ENSG00000169429.CXCL8', 'ENSG00000169442.CD52',\n        'ENSG00000169508.GPR183', 'ENSG00000169554.ZEB2',\n        'ENSG00000169715.MT1E', 'ENSG00000169744.LDB2',\n        'ENSG00000169908.TM4SF1', 'ENSG00000169946.ZFPM2',\n        'ENSG00000170017.ALCAM', 'ENSG00000170323.FABP4',\n        'ENSG00000170345.FOS', 'ENSG00000170776.AKAP13',\n        'ENSG00000170921.TANC2', 'ENSG00000170961.HAS2',\n        'ENSG00000171132.PRKCE', 'ENSG00000171223.JUNB',\n        'ENSG00000171236.LRG1', 'ENSG00000171408.PDE7B',\n        'ENSG00000171848.RRM2', 'ENSG00000171858.RPS21',\n        'ENSG00000171863.RPS7', 'ENSG00000171988.JMJD1C',\n        'ENSG00000172260.NEGR1', 'ENSG00000172264.MACROD2',\n        'ENSG00000172554.SNTG2', 'ENSG00000172817.CYP7B1',\n        'ENSG00000173110.HSPA6', 'ENSG00000173227.SYT12',\n        'ENSG00000173262.SLC2A14', 'ENSG00000173267.SNCG',\n        'ENSG00000173320.STOX2', 'ENSG00000173482.PTPRM',\n        'ENSG00000173517.PEAK1', 'ENSG00000173812.EIF1',\n        'ENSG00000173926.MARCHF3', 'ENSG00000174327.SLC16A13',\n        'ENSG00000174485.DENND4A', 'ENSG00000175161.CADM2',\n        'ENSG00000175198.PCCA', 'ENSG00000175471.MCTP1',\n        'ENSG00000175745.NR2F1', 'ENSG00000176890.TYMS',\n        'ENSG00000177606.JUN', 'ENSG00000177694.NAALADL2',\n        'ENSG00000177954.RPS27', 'ENSG00000178175.ZNF366',\n        'ENSG00000178538.CA8', 'ENSG00000178573.MAF',\n        'ENSG00000178726.THBD', 'ENSG00000178878.APOLD1',\n        'ENSG00000178971.CTC1', 'ENSG00000179097.HTR1F',\n        'ENSG00000179144.GIMAP7', 'ENSG00000179344.HLA-DQB1',\n        'ENSG00000180509.KCNE1', 'ENSG00000181026.AEN',\n        'ENSG00000181195.PENK', 'ENSG00000181649.PHLDA2',\n        'ENSG00000181722.ZBTB20', 'ENSG00000182050.MGAT4C',\n        'ENSG00000182141.ZNF708', 'ENSG00000182197.EXT1',\n        'ENSG00000182463.TSHZ2', 'ENSG00000182732.RGS6',\n        'ENSG00000182866.LCK', 'ENSG00000182899.RPL35A',\n        'ENSG00000183153.GJD3', 'ENSG00000183486.MX2',\n        'ENSG00000183580.FBXL7', 'ENSG00000183722.LHFPL6',\n        'ENSG00000184005.ST6GALNAC3', 'ENSG00000184009.ACTG1',\n        'ENSG00000184113.CLDN5', 'ENSG00000184305.CCSER1',\n        'ENSG00000184347.SLIT3', 'ENSG00000184349.EFNA5',\n        'ENSG00000184384.MAML2', 'ENSG00000184454.NCMAP',\n        'ENSG00000184557.SOCS3', 'ENSG00000184635.ZNF93',\n        'ENSG00000184985.SORCS2', 'ENSG00000185008.ROBO2',\n        'ENSG00000185046.ANKS1B', 'ENSG00000185070.FLRT2',\n        'ENSG00000185305.ARL15', 'ENSG00000185352.HS6ST3',\n        'ENSG00000185532.PRKG1', 'ENSG00000185633.NDUFA4L2',\n        'ENSG00000185650.ZFP36L1', 'ENSG00000185737.NRG3',\n        'ENSG00000185880.TRIM69', 'ENSG00000185885.IFITM1',\n        'ENSG00000186094.AGBL4', 'ENSG00000186153.WWOX',\n        'ENSG00000186187.ZNRF1', 'ENSG00000186468.RPS23',\n        'ENSG00000186806.VSIG10L', 'ENSG00000187134.AKR1C1',\n        'ENSG00000187193.MT1X', 'ENSG00000187391.MAGI2',\n        'ENSG00000187479.C11orf96', 'ENSG00000187513.GJA4',\n        'ENSG00000187514.PTMA', 'ENSG00000187608.ISG15',\n        'ENSG00000187720.THSD4', 'ENSG00000188257.PLA2G2A',\n        'ENSG00000188517.COL25A1', 'ENSG00000188536.HBA2',\n        'ENSG00000188559.RALGAPA2', 'ENSG00000188897.ENSG00000188897',\n        'ENSG00000189056.RELN', 'ENSG00000189058.APOD',\n        'ENSG00000189090.FAM25G', 'ENSG00000189129.PLAC9',\n        'ENSG00000189283.FHIT', 'ENSG00000189292.ALKAL2',\n        'ENSG00000196126.HLA-DRB1', 'ENSG00000196154.S100A4',\n        'ENSG00000196189.SEMA4A', 'ENSG00000196428.TSC22D2',\n        'ENSG00000196569.LAMA2', 'ENSG00000196628.TCF4',\n        'ENSG00000196735.HLA-DQA1', 'ENSG00000197019.SERTAD1',\n        'ENSG00000197061.H4C3', 'ENSG00000197329.PELI1',\n        'ENSG00000197555.SIPA1L1', 'ENSG00000197728.RPS26',\n        'ENSG00000197747.S100A10', 'ENSG00000197756.RPL37A',\n        'ENSG00000197766.CFD', 'ENSG00000197943.PLCG2',\n        'ENSG00000197956.S100A6', 'ENSG00000197958.RPL12',\n        'ENSG00000198034.RPS4X', 'ENSG00000198108.CHSY3',\n        'ENSG00000198216.CACNA1E', 'ENSG00000198467.TPM2',\n        'ENSG00000198502.HLA-DRB5', 'ENSG00000198542.ITGBL1',\n        'ENSG00000198604.BAZ1A', 'ENSG00000198626.RYR2',\n        'ENSG00000198668.CALM1', 'ENSG00000198794.SCAMP5',\n        'ENSG00000198853.RUSC2', 'ENSG00000198918.RPL39',\n        'ENSG00000203727.SAMD5', 'ENSG00000203883.SOX18',\n        'ENSG00000204217.BMPR2', 'ENSG00000204287.HLA-DRA',\n        'ENSG00000204291.COL15A1', 'ENSG00000204311.PJVK',\n        'ENSG00000204388.HSPA1B', 'ENSG00000204389.HSPA1A',\n        'ENSG00000204442.NALF1', 'ENSG00000204472.AIF1',\n        'ENSG00000205038.PKHD1L1', 'ENSG00000205362.MT1A',\n        'ENSG00000205364.MT1M', 'ENSG00000205442.IZUMO3',\n        'ENSG00000205502.C2CD4B', 'ENSG00000205542.TMSB4X',\n        'ENSG00000206172.HBA1', 'ENSG00000211445.GPX3',\n        'ENSG00000211592.IGKC', 'ENSG00000213088.ACKR1',\n        'ENSG00000213145.CRIP1', 'ENSG00000213741.RPS29',\n        'ENSG00000215883.CYB5RL', 'ENSG00000221838.AP4M1',\n        'ENSG00000221869.CEBPD', 'ENSG00000223865.HLA-DPB1',\n        'ENSG00000227507.LTB', 'ENSG00000229117.RPL41',\n        'ENSG00000231389.HLA-DPA1', 'ENSG00000231500.RPS18',\n        'ENSG00000233927.RPS28', 'ENSG00000234745.HLA-B',\n        'ENSG00000239605.STPG4', 'ENSG00000240021.TEX35',\n        'ENSG00000240583.AQP1', 'ENSG00000241058.NSUN6',\n        'ENSG00000242265.PEG10', 'ENSG00000244694.PTCHD4',\n        'ENSG00000257987.TEX49', 'ENSG00000265972.TXNIP',\n        'ENSG00000266964.FXYD1', 'ENSG00000271503.CCL5',\n        'ENSG00000272398.CD24', 'ENSG00000276644.DACH1',\n        'ENSG00000284491.THSD8', 'ENSG00000288602.C8orf44-SGK3',\n        'ENSG00000291237.SOD2'], dtype='&lt;U31'))\n\n\n\n# store the integration in a temp df to sort the genes and the cells\n\n_scanorama_df = pd.DataFrame(\n    sparse.vstack(_out_scanorama[1]).toarray(),\n    columns=_out_scanorama[2],\n    index=np.concatenate([adata_hvgs[adata_hvgs.obs.donor==donor].copy().obs.index for donor in adata_hvgs.obs.donor.unique()])\n)\n_scanorama_df = _scanorama_df.loc[adata_hvgs.obs.index, adata_hvgs.var.index]\n_scanorama_df\n\n\n\n\n\n\n\n\nENSG00000187608.ISG15\nENSG00000142599.RERE\nENSG00000162493.PDPN\nENSG00000188257.PLA2G2A\nENSG00000117318.ID3\nENSG00000142676.RPL11\nENSG00000184454.NCMAP\nENSG00000169442.CD52\nENSG00000126709.IFI6\nENSG00000162510.MATN1\n...\nENSG00000205542.TMSB4X\nENSG00000130066.SAT1\nENSG00000102265.TIMP1\nENSG00000102003.SYP\nENSG00000102053.ZC3H12B\nENSG00000198034.RPS4X\nENSG00000102271.KLHL4\nENSG00000198918.RPL39\nENSG00000129682.FGF13\nENSG00000147403.RPL10\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\n0.023583\n-0.002586\n-0.016485\n-0.003179\n-0.023821\n-0.008579\n-0.001793\n-0.002536\n0.010911\n-0.006346\n...\n-0.009052\n-0.029501\n-0.005599\n0.018711\n-0.002576\n-0.008925\n0.041081\n0.005903\n0.005757\n-0.003299\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\n0.002132\n-0.024135\n-0.040220\n-0.003728\n-0.048700\n-0.011451\n-0.001601\n-0.002038\n0.121134\n0.000624\n...\n-0.064797\n-0.015737\n0.018278\n0.002689\n-0.000674\n0.035611\n-0.032614\n-0.009935\n-0.000318\n0.023515\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\n-0.004164\n-0.033796\n0.101305\n-0.003710\n0.009889\n0.019629\n-0.001690\n-0.002676\n-0.013008\n-0.000431\n...\n-0.014460\n-0.026077\n0.058380\n-0.003630\n-0.002396\n-0.001037\n-0.034941\n0.020651\n-0.000530\n0.005955\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\n-0.046052\n-0.040209\n-0.019079\n-0.004313\n-0.019216\n0.002073\n-0.001743\n-0.002364\n-0.011888\n-0.000646\n...\n0.063457\n-0.014290\n-0.064956\n0.000575\n-0.000960\n0.001015\n-0.009173\n-0.000387\n-0.001733\n-0.019071\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\n0.001571\n-0.029553\n-0.044063\n-0.003765\n-0.025331\n-0.000908\n-0.001273\n-0.002982\n-0.012937\n-0.000433\n...\n0.011196\n-0.020491\n0.046722\n-0.003636\n-0.001308\n0.001381\n-0.040433\n0.046904\n-0.000008\n0.021838\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\n0.004535\n-0.025117\n-0.026448\n-0.003503\n0.039049\n0.003347\n-0.001132\n-0.001443\n-0.014741\n0.000356\n...\n0.037419\n0.064046\n-0.047390\n0.002937\n0.000538\n0.059523\n-0.028602\n0.040662\n-0.000181\n0.029061\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\n0.003428\n-0.033261\n-0.023717\n-0.003449\n-0.020331\n0.043332\n-0.001314\n-0.001652\n0.188004\n0.000222\n...\n0.025254\n-0.025854\n-0.047238\n-0.001205\n0.000409\n-0.100988\n-0.027576\n0.021205\n-0.000445\n0.026364\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\n-0.005095\n-0.036264\n0.066045\n-0.001726\n-0.023987\n-0.038655\n-0.002289\n-0.001660\n-0.006253\n0.000633\n...\n-0.018624\n-0.037367\n-0.043669\n-0.008348\n0.000897\n-0.086843\n-0.014656\n-0.078321\n0.160810\n-0.075802\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\n0.002042\n-0.031914\n-0.026421\n-0.003509\n-0.014657\n0.030829\n-0.001336\n-0.000887\n-0.012903\n0.002270\n...\n-0.040158\n0.052507\n-0.002179\n0.001621\n-0.000805\n0.014169\n-0.029794\n0.015041\n-0.002628\n0.042965\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\n0.002154\n0.020513\n-0.027130\n-0.003485\n0.018931\n-0.023319\n-0.000131\n-0.001552\n-0.009600\n0.005904\n...\n-0.004841\n0.050670\n0.010598\n-0.000437\n-0.000596\n-0.007359\n-0.016838\n0.015945\n0.116254\n0.005931\n\n\n\n\n21588 rows × 661 columns\n\n\n\n\n# store the scanorama layer in the adata object\n\nadata_hvgs.layers[\"logcounts.scaled.scanorama\"] = _scanorama_df.values\ndel _scanorama_df, _out_scanorama\n\n\n# PCA, neighbors and UMAP\n\nadata_hvgs.obsm[\"logcounts.scaled.scanorama.pca\"] = sc.pp.pca(adata_hvgs.layers[\"logcounts.scaled.scanorama\"], svd_solver=\"arpack\", n_comps=100)\nsc.pp.neighbors(adata_hvgs, use_rep=\"logcounts.scaled.scanorama.pca\", n_pcs=100, n_neighbors=40, key_added=\"logcounts.scaled.scanorama.pca.neighbors\")\nadata_hvgs.obsm[\"logcounts.scaled.scanorama.pca.neighbors.umap\"] = sc.tl.umap(adata_hvgs, neighbors_key=\"logcounts.scaled.scanorama.pca.neighbors\", copy=True).obsm[\"X_umap\"]\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.scanorama.pca\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.scanorama.pca.neighbors.umap\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.scanorama.pca.neighbors.umap\", color=adata_hvgs.var.index.intersection(markers.gene_ID), norm=colors.LogNorm())\n\n\n\n\n\n# harmony integration\n# we're gonna use this one instead of scanorama\n\nsc.external.pp.harmony_integrate(\n    adata_hvgs, basis=\"logcounts.scaled.pca\", key=\"donor\",\n    adjusted_basis=\"logcounts.scaled.pca.harmony\", sigma=1. #hyperparameters: sigma.\n)\nadata_hvgs\n\n2023-07-17 15:13:32,899 - harmonypy - INFO - Iteration 1 of 10\n2023-07-17 15:13:37,541 - harmonypy - INFO - Iteration 2 of 10\n2023-07-17 15:13:40,047 - harmonypy - INFO - Iteration 3 of 10\n2023-07-17 15:13:42,499 - harmonypy - INFO - Converged after 3 iterations\n\n\nAnnData object with n_obs × n_vars = 21588 × 661\n    obs: 'Sample', 'Barcode', 'donor', 'tissue', 'tissue_origin', 'sequencing_run', 'sex', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes'\n    var: 'ID', 'Symbol', 'Type', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts', 'selected'\n    uns: 'X_name', 'donor_colors', 'sequencing_run_colors', 'tissue_origin_colors', 'tissue_colors', 'logcounts.scaled.pca.neighbors', 'logcounts.scaled.scanorama.pca.neighbors'\n    obsm: 'logcounts.scaled.pca', 'logcounts.scaled.pca.neighbors.umap', 'logcounts.scaled.scanorama.pca', 'logcounts.scaled.scanorama.pca.neighbors.umap', 'logcounts.scaled.pca.harmony'\n    layers: 'logcounts', 'logcounts.scaled', 'logcounts.scaled.scanorama'\n    obsp: 'logcounts.scaled.pca.neighbors_distances', 'logcounts.scaled.pca.neighbors_connectivities', 'logcounts.scaled.scanorama.pca.neighbors_distances', 'logcounts.scaled.scanorama.pca.neighbors_connectivities'\n\n\n\nsc.pp.neighbors(adata_hvgs, use_rep=\"logcounts.scaled.pca.harmony\", n_pcs=100, n_neighbors=40, key_added=\"logcounts.scaled.pca.harmony.neighbors\")\nadata_hvgs.obsm[\"logcounts.scaled.pca.harmony.neighbors.umap\"] = sc.tl.umap(adata_hvgs, neighbors_key=\"logcounts.scaled.pca.harmony.neighbors\", copy=True).obsm[\"X_umap\"]\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca.harmony\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca.harmony.neighbors.umap\", color=[\"donor\", \"sequencing_run\", \"tissue_origin\", \"tissue\"])\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n\n\n\n# laiden clustering at different resolutions on the scanorama integration layer\n\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=.025, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_0025res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=.05, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_005res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=.1, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_01res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=.25, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_025res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=.5, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_05res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.scanorama.pca.neighbors_connectivities\", resolution=1, key_added=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_1res\")\nadata_hvgs.obs\n\n\n\n\n\n\n\n\nSample\nBarcode\ndonor\ntissue\ntissue_origin\nsequencing_run\nsex\nn_genes_by_counts\nlog1p_n_genes_by_counts\ntotal_counts\n...\npct_counts_in_top_50_genes\npct_counts_in_top_100_genes\npct_counts_in_top_200_genes\npct_counts_in_top_500_genes\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_0025res\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_005res\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_01res\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_025res\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_05res\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_1res\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\nAAAGAACCACATACGT-1\n1.0\nfat\nabdomen\n1.0\nF\n252\n5.533389\n1317.0\n...\n61.655277\n81.624905\n96.051632\n100.0\n0\n0\n1\n1\n2\n3\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\nAAAGGTAGTCCGGTCA-1\n1.0\nfat\nabdomen\n1.0\nF\n139\n4.941642\n1479.0\n...\n80.459770\n97.363083\n100.000000\n100.0\n0\n0\n0\n3\n3\n5\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\nAAAGGTATCTCTCTTC-1\n1.0\nfat\nabdomen\n1.0\nF\n196\n5.283204\n1806.0\n...\n72.369878\n91.251384\n100.000000\n100.0\n0\n0\n0\n0\n3\n5\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\nAACCACACAGTGGCTC-1\n1.0\nfat\nabdomen\n1.0\nF\n254\n5.541264\n3110.0\n...\n66.495177\n88.938907\n98.263666\n100.0\n0\n0\n0\n3\n4\n1\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\nAACGGGATCTGCTGAA-1\n1.0\nfat\nabdomen\n1.0\nF\n171\n5.147494\n1448.0\n...\n73.273481\n93.784530\n100.000000\n100.0\n0\n0\n0\n3\n4\n1\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\nTTTGGTTTCGACCAAT-1\n5.0\nmixed\nabdomen\n4.0\n?\n163\n5.099866\n618.0\n...\n67.475728\n89.320388\n100.000000\n100.0\n0\n0\n0\n0\n3\n7\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\nTTTGTTGGTCCTACGG-1\n5.0\nmixed\nabdomen\n4.0\n?\n143\n4.969813\n305.0\n...\n63.934426\n85.901639\n100.000000\n100.0\n0\n0\n0\n0\n0\n0\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\nTTTGTTGGTCGCAGTC-1\n5.0\nmixed\nabdomen\n4.0\n?\n207\n5.337538\n471.0\n...\n53.715499\n76.433121\n98.513800\n100.0\n0\n0\n1\n1\n2\n8\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\nTTTGTTGGTGGCGTAA-1\n5.0\nmixed\nabdomen\n4.0\n?\n142\n4.962845\n813.0\n...\n77.121771\n94.833948\n100.000000\n100.0\n0\n0\n0\n4\n8\n12\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\nTTTGTTGTCGGCATTA-1\n5.0\nmixed\nabdomen\n4.0\n?\n216\n5.379897\n763.0\n...\n57.798165\n80.471822\n97.903014\n100.0\n0\n0\n2\n4\n6\n10\n\n\n\n\n21588 rows × 21 columns\n\n\n\n\n# number of clusters for each resolution\n#we're interested in selecting at least 10 clusters\n\nadata_hvgs.obs.loc[:,adata_hvgs.obs.columns.str.match(\"logcounts\\.scaled\\.scanorama\\.pca\\.neighbors_connectivities\\.leiden_[0-9]+res$\")].nunique()\n\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_0025res     1\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_005res      1\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_01res       4\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_025res      6\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_05res      10\nlogcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_1res       16\ndtype: int64\n\n\n\nsc.pl.heatmap(\n    adata_hvgs, var_names=markers.gene_ID.unique(),\n    groupby='logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_05res',\n    swap_axes=True, layer=\"logcounts\", standard_scale=\"var\"\n)\n\n\n\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.scanorama.pca.neighbors.umap\", color=\"logcounts.scaled.scanorama.pca.neighbors_connectivities.leiden_05res\")\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n# laiden clustering at different resolutions on the harmony integration layer\n\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.025, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_0025res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.05, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_005res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.1, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_01res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.15, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_015res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.2, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_02res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.25, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_025res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.3, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_03res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.4, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_04res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=.5, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res\")\nsc.tl.leiden(adata_hvgs, obsp=\"logcounts.scaled.pca.harmony.neighbors_connectivities\", resolution=1, key_added=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\")\nadata_hvgs.obs\n\n\n\n\n\n\n\n\nSample\nBarcode\ndonor\ntissue\ntissue_origin\nsequencing_run\nsex\nn_genes_by_counts\nlog1p_n_genes_by_counts\ntotal_counts\n...\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_0025res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_005res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_01res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_015res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_02res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_025res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_03res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_04res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res\n\n\n\n\ndonor1_fat.AAAGAACCACATACGT-1\ndonor1_fat\nAAAGAACCACATACGT-1\n1.0\nfat\nabdomen\n1.0\nF\n252\n5.533389\n1317.0\n...\n0\n0\n0\n0\n1\n1\n1\n1\n1\n7\n\n\ndonor1_fat.AAAGGTAGTCCGGTCA-1\ndonor1_fat\nAAAGGTAGTCCGGTCA-1\n1.0\nfat\nabdomen\n1.0\nF\n139\n4.941642\n1479.0\n...\n0\n0\n0\n0\n1\n1\n1\n1\n1\n1\n\n\ndonor1_fat.AAAGGTATCTCTCTTC-1\ndonor1_fat\nAAAGGTATCTCTCTTC-1\n1.0\nfat\nabdomen\n1.0\nF\n196\n5.283204\n1806.0\n...\n0\n0\n0\n0\n0\n0\n0\n0\n0\n0\n\n\ndonor1_fat.AACCACACAGTGGCTC-1\ndonor1_fat\nAACCACACAGTGGCTC-1\n1.0\nfat\nabdomen\n1.0\nF\n254\n5.541264\n3110.0\n...\n0\n0\n0\n0\n1\n1\n1\n1\n1\n2\n\n\ndonor1_fat.AACGGGATCTGCTGAA-1\ndonor1_fat\nAACGGGATCTGCTGAA-1\n1.0\nfat\nabdomen\n1.0\nF\n171\n5.147494\n1448.0\n...\n0\n0\n0\n0\n1\n1\n1\n1\n1\n1\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\ndonor5_recovery.TTTGGTTTCGACCAAT-1\ndonor5_recovery\nTTTGGTTTCGACCAAT-1\n5.0\nmixed\nabdomen\n4.0\n?\n163\n5.099866\n618.0\n...\n0\n0\n0\n0\n0\n0\n0\n0\n0\n0\n\n\ndonor5_recovery.TTTGTTGGTCCTACGG-1\ndonor5_recovery\nTTTGTTGGTCCTACGG-1\n5.0\nmixed\nabdomen\n4.0\n?\n143\n4.969813\n305.0\n...\n0\n0\n0\n0\n0\n0\n0\n1\n0\n1\n\n\ndonor5_recovery.TTTGTTGGTCGCAGTC-1\ndonor5_recovery\nTTTGTTGGTCGCAGTC-1\n5.0\nmixed\nabdomen\n4.0\n?\n207\n5.337538\n471.0\n...\n0\n0\n0\n0\n1\n4\n2\n4\n4\n7\n\n\ndonor5_recovery.TTTGTTGGTGGCGTAA-1\ndonor5_recovery\nTTTGTTGGTGGCGTAA-1\n5.0\nmixed\nabdomen\n4.0\n?\n142\n4.962845\n813.0\n...\n0\n0\n0\n0\n2\n3\n3\n3\n3\n9\n\n\ndonor5_recovery.TTTGTTGTCGGCATTA-1\ndonor5_recovery\nTTTGTTGTCGGCATTA-1\n5.0\nmixed\nabdomen\n4.0\n?\n216\n5.379897\n763.0\n...\n0\n0\n0\n0\n2\n3\n3\n3\n3\n8\n\n\n\n\n21588 rows × 31 columns\n\n\n\n\n# number of clusters for each resolution\n#we're interested in selecting at least 10 clusters\n\nadata_hvgs.obs.loc[:,adata_hvgs.obs.columns.str.match(\"logcounts\\.scaled\\.pca\\.harmony\\.neighbors_connectivities\\.leiden_[0-9]+res$\")].nunique()\n\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_0025res     1\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_005res      1\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_01res       1\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_015res      1\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_02res       3\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_025res      5\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_03res       5\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_04res       9\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res      11\nlogcounts.scaled.pca.harmony.neighbors_connectivities.leiden_1res       20\ndtype: int64\n\n\n\nsc.pl.heatmap(\n    adata_hvgs.copy(), var_names=markers.gene_ID.unique(), dendrogram=True,\n    groupby='logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res',\n    swap_axes=True, layer=\"logcounts\", standard_scale=\"var\", figsize=(20,5)\n)\n\nWARNING: dendrogram data not found (using key=dendrogram_logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res). Running `sc.tl.dendrogram` with default parameters. For fine tuning it is recommended to run `sc.tl.dendrogram` independently.\nWARNING: You’re trying to run this on 661 dimensions of `.X`, if you really want this, set `use_rep='X'`.\n         Falling back to preprocessing with `sc.pp.pca` and default params.\n\n\n\n\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca.harmony.neighbors.umap\", color=adata_hvgs.var.index.intersection(markers.gene_ID), norm=colors.LogNorm(vmin=1))\n\n\n\n\n\nsc.pl.embedding(adata_hvgs, basis=\"logcounts.scaled.pca.harmony.neighbors.umap\", color=\"logcounts.scaled.pca.harmony.neighbors_connectivities.leiden_05res\")\n\n/Users/daniele/miniconda3/envs/usefulenv/lib/python3.10/site-packages/scanpy/plotting/_tools/scatterplots.py:392: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n  cax = scatter(\n\n\n\n\n\n\n#save the adata object\nadata_hvgs.write_h5ad(\"../output/1.1-sce-after-contamination-removal-integration-clustering.h5ad\")"
  }
]